--- 
layout: post
name: r
title: "R\xE8\xAF\xAD\xE8\xA8\x80\xE7\xBC\x96\xE7\xA8\x8B\xE5\x85\xA5\xE9\x97\xA8\xE4\xB9\x8B\xE5\x85\xAD\xEF\xBC\x9A\xE5\xBE\xAA\xE7\x8E\xAF\xE4\xB8\x8E\xE6\x9D\xA1\xE4\xBB\xB6"
date: 2012-03-16 10:28:00 +08:00
categories: 
- "\xE7\xBC\x96\xE7\xA8\x8B"
- "\xE5\x85\xA5\xE9\x97\xA8\xE6\x95\x99\xE7\xA8\x8B"
permalink: /2012/03/r.html
---
<b><span style="font-size: large;">循环</span></b><br /><b>for (n in x) ｛expr}</b><br />R中最基本的是for循环，其中n为循环变量，x通常是一个序列。n在每次循环时从x中顺序取值，代入到后面的expr语句中进行运算。下面的例子即是以for循环计算30个<a href="http://en.wikipedia.org/wiki/Fibonacci_number">Fibonacci</a>数。<br />x &lt;- c(1,1)<br />for (i in 3:30) {<br />&nbsp; &nbsp; x[i] &lt;- x[i-1]+x[i-2]<br />}<br /><br /><b>while (condition) {expr}</b><br />当不能确定循环次数时，我们需要用while循环语句。在condition条件为真时，执行大括号内的expr语句。下面即是以while循环来计算30个Fibonacci数。<br />x &lt;- c(1,1)<br />i &lt;- 3<br />while (i &lt;= 30) {<br />&nbsp; &nbsp; x[i] &lt;- x[i-1]+x[i-2]<br />&nbsp; &nbsp; i &lt;- i +1<br />}<br /><br /><a name='more'></a><br /><br /><b><span style="font-size: large;">条件</span></b><br /><b>if (conditon) {expr1} else {expr2}</b><br />if语句用来进行条件控制，以执行不同的语句。若condition条件为真，则执行expr1，否则执行expr2。<b>ifesle()</b>函数也能以简洁的方式构成条件语句。下面的一个简单的例子是要找出100以内的质数。<br />x &lt;- 1:100<br />y &lt;- rep(T,100)<br />for (i in 3:100) {<br />&nbsp; &nbsp; if (all(i%%(2:(i-1))!=0)){<br />&nbsp; &nbsp; &nbsp; &nbsp; y[i] &lt;- TRUE<br />&nbsp; &nbsp; &nbsp; &nbsp; } else {y[i] &lt;- FALSE<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />}<br />print(x[y])<br /><br />在上面例子里，<b>all()</b>函数的作用是判断一个逻辑序列是否全为真，%%的作用是返回余数。在if/else语句中一个容易出现的错误就是else没有放在｝的后面，若你执行下面的示例就会出现错误。<br />logic = 3<br />x&lt;- c(2,3)<br />if (logic == 2){<br />&nbsp; &nbsp;&nbsp;y &lt;- x^2<br />}<br />else {<br />&nbsp; y&lt;-x^3<br />}<br />show(y)<br /><br /><b>一个例子</b><br />本例来自于"introduction to Scientific Programming and Simulatoin Using R"一书的习题。有这样一种赌博游戏，赌客首先将两个骰子随机抛掷第一次，如果点数和出现7或11，则赢得游戏，游戏结束。如果没有出现7或11，赌客继续抛掷，如果点数与第一次扔的点数一样，则赢得游戏，游戏结束，如果点数为7或11则输掉游戏，游戏结束。如果出现其它情况，则继续抛掷，直到赢或者输。用R编程来计算赌客赢的概率，以决定是否应该参加这个游戏。<br /><br />craps &lt;- function() {<br />&nbsp; &nbsp; #returns TRUE if you win, FALSE otherwise<br />&nbsp; &nbsp; initial.roll &lt;- sum(sample(1:6,2,replace=T))<br />&nbsp; &nbsp; if (initial.roll == 7 || initial.roll == 11) return(TRUE)<br />&nbsp; &nbsp; while (TRUE) {<br />&nbsp; &nbsp; &nbsp; &nbsp; current.roll &lt;- sum(sample(1:6,2,replace=T))<br />&nbsp; &nbsp; &nbsp; &nbsp; if (current.roll == 7 || current.roll == 11) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return(FALSE)<br />&nbsp; &nbsp; &nbsp; &nbsp; } else if (current.roll == initial.roll) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return(TRUE)<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }<br />}<br />mean(replicate(10000, craps()))<br /><br />从最终结果来看，赌客赢的概率为0.46，长期来看只会往外掏钱，显然不应该参加这个游戏了。最后要说的是，本题也可以用递归来做。
