--- 
layout: post
name: r
title: "R\xE8\xAF\xAD\xE8\xA8\x80\xE4\xB8\xAD\xE7\x9A\x84\xE6\x96\xB9\xE5\xB7\xAE\xE5\x88\x86\xE6\x9E\x90"
date: 2011-12-01 12:12:00 +08:00
categories: 
- "\xE6\x96\xB9\xE5\xB7\xAE\xE5\x88\x86\xE6\x9E\x90"
permalink: /2011/12/r.html
---
<b><span class="Apple-style-span" style="font-size: large;">1 单因子方差分析（one-way ANOVA）</span></b><br /><b>1)建模：</b><br />我们采用multcomp包中的cholesterol数据集作为例子，其中response为响应变量，trt为预测变量，这个处理中有五种水平。从下面的箱形图中可观察到处理的不同水平对于响应变量的影响。再用aov函数建立单因子方差模型，从结果的P值可看到各组均值有显著不同。<br /><blockquote class="tr_bq">aggregate(response, by=list(trt), FUN=mean)<br />bwplot(response~trt)<br />model=aov(response~trt)<br />summary(model)</blockquote><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-5ABoFaFUTxc/Ttb_Gmk6F0I/AAAAAAAAAjc/rsMTGwjB0uE/s1600/Rplot.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://4.bp.blogspot.com/-5ABoFaFUTxc/Ttb_Gmk6F0I/AAAAAAAAAjc/rsMTGwjB0uE/s320/Rplot.jpeg" width="320" /></a></div><a name='more'></a><br /><br /><b>2)多重比较：</b><br />方差分析只告诉我们这五组之间是不同的，但没有告诉我们哪两组之间有明显差别，此时需要使用TukeyHSD函数进行均值的多重比较分析，从结果中观察到有三个两两比较是不显著的。<br /><blockquote class="tr_bq">(result=TukeyHSD(model))<br />plot(result)</blockquote><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-pdm1nayXwG8/Ttb_TJUv4MI/AAAAAAAAAjk/0zLs0a8FUPk/s1600/Rplot2.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://2.bp.blogspot.com/-pdm1nayXwG8/Ttb_TJUv4MI/AAAAAAAAAjk/0zLs0a8FUPk/s320/Rplot2.jpeg" width="320" /></a></div><br /><b>3)假设检验：</b><br />方差分析需要一定的假设，即数据集应该符合正态和同方差，我们分别用下面的函数来进行检验，从P值观察到这两个假设是符合的。对于不符合假设的情况，我们就要用到非参数方法，例如Kruskal-Wallis秩和检验<br /><blockquote class="tr_bq">shapiro.test(response)<br />bartlett.test(response~trt)</blockquote><b><span class="Apple-style-span" style="font-size: large;">2 双因子方差分析（Two-way Factorial ANOVA）</span></b><br />我们用ToothGrowth数据集来举例双因子方差分析。其中supp和dose是预测变量，len是响应变量。我们仍然使用aov进行建模，然后使用HH包的绘图函数来展现双因子交互效果图<br /><blockquote class="tr_bq">fit &lt;- aov(len ~ supp*dose)<br />library(HH)<br />interaction2wt(len~supp*dose)</blockquote><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-ydOuz9WOpoY/Ttb_mjSYpzI/AAAAAAAAAjs/r9Njg9u8UzY/s1600/Rplot03.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://3.bp.blogspot.com/-ydOuz9WOpoY/Ttb_mjSYpzI/AAAAAAAAAjs/r9Njg9u8UzY/s400/Rplot03.jpeg" width="400" /></a></div><br />要注意在下面的情况下因子的先后顺序是有讲究的：<br /><br /><ul><li>第一种情况是多因子非平衡情况下，此时重要的因子应该放在前面，</li><li>第二是在在有协变量情况下，此时协变量放在前面，然后是主因子和交互因子</li></ul><br /><b><span class="Apple-style-span" style="font-size: large;">3 重复测量方差分析</span></b><br />在重复测量的方差分析中，实验对象被测量多次，所以会存在组内因子，组内因子要以下面的形式特别标明出来，其中B是组间因子，W是组内因子，subject是实验对象的ID，<br /><blockquote class="tr_bq">model=aov(Y ~ B * W + Error(Subject/W))</blockquote>上述方法的前提是对应组内因子不同水平的数据是等方差的，当传统方法的假设得不到满足时，则应用lme4包中lmer函数，利用混合效应模型来解决问题。
