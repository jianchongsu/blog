--- 
layout: post
name: qq
title: "\xE6\x9D\xA5\xE7\x8E\xA9\xE7\x8E\xA9QQ\xE7\xBE\xA4\xE7\x9A\x84\xE6\x95\xB0\xE6\x8D\xAE"
date: 2012-12-13 21:59:00 +08:00
categories: 
- "\xE6\x95\xB0\xE6\x8D\xAE\xE7\xA7\x91\xE5\xAD\xA6"
- "\xE6\x95\xB0\xE6\x8D\xAE\xE9\xA2\x84\xE5\xA4\x84\xE7\x90\x86"
permalink: /2012/12/qq.html
---
<div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-Slo-RAoEQaE/UMnaBhJrXlI/AAAAAAAABTs/qqrLyufw2ek/s1600/3_111017092132_1.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="277" src="http://2.bp.blogspot.com/-Slo-RAoEQaE/UMnaBhJrXlI/AAAAAAAABTs/qqrLyufw2ek/s400/3_111017092132_1.jpg" width="400" /></a></div>上周COS论坛上有位老兄发布了一个<a href="http://cos.name/cn/topic/108836">关于QQ群的数据</a>，正好拿来玩玩。这批数据并不复杂，只有两列，一列是用户名，一列是用户发言时间，不过从这批数据中仍然可以得出一些好玩的东西，且让本人一一道来。<br /><br /><br /><br /><a name='more'></a>先对数据进行整理，然后以时间维度进行数据汇集，观察各周的发言分布情况。可以看到周一和周日聊天不多，难道说是周一大家都比较安心上班？下图是对不同的时间段进行数据汇集，观察是白天上班的时间聊天比较多，下午4、5点下班前形成高峰。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-7P0Smlmtld0/UMna4gKDgsI/AAAAAAAABT0/lWf5myDbk6s/s1600/1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="464" src="http://4.bp.blogspot.com/-7P0Smlmtld0/UMna4gKDgsI/AAAAAAAABT0/lWf5myDbk6s/s640/1.png" width="640" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"></div>然后还可以根据用户名来汇集发言频数，获得发言最多前十大用户<br /><table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse; width: 144px;"> <colgroup><col span="2" style="width: 54pt;" width="72"></col> </colgroup><tbody><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt; width: 54pt;" width="72">用户</td>  <td style="width: 54pt;" width="72">频数</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">7cha18</td>  <td align="right">1498</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">6cha4376</td>  <td align="right">1209</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">4cha3875</td>  <td align="right">1079</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">8cha083</td>  <td align="right">691</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">4cha698</td>  <td align="right">528</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">1cha65314</td>  <td align="right">438</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">acha@vip.qq.com</td>  <td align="right">372</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">2cha1</td>  <td align="right">350</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">5cha80</td>  <td align="right">296</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">3cha4233</td>  <td align="right">294</td> </tr></tbody></table><br /><br />此外，若用户在一天之内有发言，则视为活跃，下面是计算出来的活跃天数的十大用户。<br /><table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse; width: 144px;"> <colgroup><col span="2" style="width: 54pt;" width="72"></col> </colgroup><tbody><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt; width: 54pt;" width="72"><br /></td>  <td style="width: 54pt;" width="72"><br /></td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">6cha4376</td>  <td align="right">160</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">4cha3875</td>  <td align="right">147</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">7cha18</td>  <td align="right">109</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">acha@vip.qq.com</td>  <td align="right">89</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">4cha698</td>  <td align="right">87</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">2cha1</td>  <td align="right">77</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">8cha083</td>  <td align="right">74</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">1cha457</td>  <td align="right">58</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">1cha59002</td>  <td align="right">53</td> </tr><tr height="18" style="height: 13.5pt;">  <td height="18" style="height: 13.5pt;">8cha08</td>  <td align="right">50</td> </tr></tbody></table><br /><br />再来观察每天的发言次数变化，可见QQ群在2012年初讨论热烈，而在最近几个月则趋于平淡，末日准备中？<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-V_F8x_5bMBA/UMncqzvZFHI/AAAAAAAABT8/XAmMvfUgpyU/s1600/2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="464" src="http://1.bp.blogspot.com/-V_F8x_5bMBA/UMncqzvZFHI/AAAAAAAABT8/XAmMvfUgpyU/s640/2.png" width="640" /></a></div>观察每天活跃用户变化，最多一次达到40人，而一般都是在10人左右。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-A-TnBd3xuI0/UMnc3lMIqaI/AAAAAAAABUE/HklE8suAB-E/s1600/3.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="464" src="http://2.bp.blogspot.com/-A-TnBd3xuI0/UMnc3lMIqaI/AAAAAAAABUE/HklE8suAB-E/s640/3.png" width="640" /></a></div>当某天活跃人数增加的话，发言数也会增加吗？ &nbsp;是的，是有这个情况。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-n1qcDdaCJUQ/UMndAP7W9eI/AAAAAAAABUM/9czfblu5mJo/s1600/4.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="464" src="http://3.bp.blogspot.com/-n1qcDdaCJUQ/UMndAP7W9eI/AAAAAAAABUM/9czfblu5mJo/s640/4.png" width="640" /></a></div>前十大发言最多用户我们暂称为十大话唠，这十大的日内发言情况如何？平行坐标图可以观察到他们的QQ群发言习性。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-rc4N1Y8uLeg/UMndH4aEfVI/AAAAAAAABUU/-gPPMMjd7zU/s1600/5.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="464" src="http://1.bp.blogspot.com/-rc4N1Y8uLeg/UMndH4aEfVI/AAAAAAAABUU/-gPPMMjd7zU/s640/5.png" width="640" /></a></div>之前的时间划分是按天来计算，下面将时间窗口划分得更细一些，如果两个发言间相隔30分钟，则认为一次群讨论结束，另一次新的群讨论开始（这个思路是听R会议上肖嘉敏说的）。下面按照群讨论来观察数据。将数据按讨论来分组，得到719次群讨论。然后可以根据一次群讨论为时间单位为观察发言次数和参与用户，这和前面的计算是差不多的，就不再重复。好玩的地方在于，可以根据用户是否参与同一次群讨论来建立他们之间的关联程度。从下面社交图可看到，6cha4376和4cha3875的关系最为密切，有基情？（我用igraph画图总是不如人家好看啊，唉，有没人教教我）<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-L9oYtx9eiC0/UMndelD2R8I/AAAAAAAABUc/uHq94NOD8qE/s1600/2012-12-13_21h19_57.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="370" src="http://2.bp.blogspot.com/-L9oYtx9eiC0/UMndelD2R8I/AAAAAAAABUc/uHq94NOD8qE/s400/2012-12-13_21h19_57.png" width="400" /></a></div>代码如下，请多批评<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><span style="color: #666666; font-style: italic;"># 数据读入</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a> &lt;- <a href="http://inside-r.org/r-doc/utils/read.csv"><span style="color: #003399; font-weight: bold;">read.csv</span></a><span style="color: #009900;">(</span><span style="color: blue;">'qq.csv'</span><span style="color: #339933;">,</span>T<span style="color: #339933;">,</span>stringsAsFactors=F<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a> &lt;- <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a><span style="color: #009900;">[</span>-<a href="http://inside-r.org/r-doc/base/nrow"><span style="color: #003399; font-weight: bold;">nrow</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a><span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span> <span style="color: #666666; font-style: italic;"># 最后一行有问题，删除</span><br />&nbsp;<br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/stringr">stringr</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/plyr">plyr</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span>lubridate<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span>reshape2<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/igraph">igraph</a><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 数据整理</span><br /><span style="color: #666666; font-style: italic;"># 将字符串中的日期和时间划分为不同变量</span><br />temp1 &lt;- str_split<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>$time<span style="color: #339933;">,</span><span style="color: blue;">' '</span><span style="color: #009900;">)</span><br />result1 &lt;- ldply<span style="color: #009900;">(</span>temp1<span style="color: #339933;">,</span>.fun=<span style="color: black; font-weight: bold;">NULL</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">(</span>result1<span style="color: #009900;">)</span> &lt;- <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">'date'</span><span style="color: #339933;">,</span><span style="color: blue;">'clock'</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;">#分离年月日</span><br />temp2 &lt;- str_split<span style="color: #009900;">(</span>result1$date<span style="color: #339933;">,</span><span style="color: blue;">'/'</span><span style="color: #009900;">)</span><br />result2 &lt;- ldply<span style="color: #009900;">(</span>temp2<span style="color: #339933;">,</span>.fun=<span style="color: black; font-weight: bold;">NULL</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">(</span>result2<span style="color: #009900;">)</span> &lt;- <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">'year'</span><span style="color: #339933;">,</span><span style="color: blue;">'month'</span><span style="color: #339933;">,</span><span style="color: blue;">'day'</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 分离小时分钟</span><br />temp3 &lt;- str_split<span style="color: #009900;">(</span>result1$clock<span style="color: #339933;">,</span><span style="color: blue;">':'</span><span style="color: #009900;">)</span><br />result3 &lt;- ldply<span style="color: #009900;">(</span>temp3<span style="color: #339933;">,</span>.fun=<span style="color: black; font-weight: bold;">NULL</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">(</span>result3<span style="color: #009900;">)</span> &lt;- <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">'hour'</span><span style="color: #339933;">,</span><span style="color: blue;">'minutes'</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 合并数据</span><br />newdata &lt;- <a href="http://inside-r.org/r-doc/base/cbind"><span style="color: #003399; font-weight: bold;">cbind</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a><span style="color: #339933;">,</span>result1<span style="color: #339933;">,</span>result2<span style="color: #339933;">,</span>result3<span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 转换日期为时间格式</span><br />newdata$date &lt;- ymd<span style="color: #009900;">(</span>newdata$date<span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 提取星期数据</span><br />newdata$wday &lt;- wday<span style="color: #009900;">(</span>newdata$date<span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 转换数据格式</span><br />newdata$month &lt;- <a href="http://inside-r.org/r-doc/base/ordered"><span style="color: #003399; font-weight: bold;">ordered</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399; font-weight: bold;">as.numeric</span></a><span style="color: #009900;">(</span>newdata$month<span style="color: #009900;">)</span> <span style="color: #009900;">)</span><br />newdata$year &lt;- <a href="http://inside-r.org/r-doc/base/ordered"><span style="color: #003399; font-weight: bold;">ordered</span></a><span style="color: #009900;">(</span>newdata$year<span style="color: #009900;">)</span><br />newdata$day &lt;- <a href="http://inside-r.org/r-doc/base/ordered"><span style="color: #003399; font-weight: bold;">ordered</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399; font-weight: bold;">as.numeric</span></a><span style="color: #009900;">(</span>newdata$day<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />newdata$hour &lt;- <a href="http://inside-r.org/r-doc/base/ordered"><span style="color: #003399; font-weight: bold;">ordered</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399; font-weight: bold;">as.numeric</span></a><span style="color: #009900;">(</span>newdata$hour<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />newdata$wday &lt;- <a href="http://inside-r.org/r-doc/base/ordered"><span style="color: #003399; font-weight: bold;">ordered</span></a><span style="color: #009900;">(</span>newdata$wday<span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 关于时间的一元描述</span><br /><span style="color: #666666; font-style: italic;"># 观察时间相关各变量的频数分布</span><br /><span style="color: #666666; font-style: italic;"># 周一和周日聊天不多，难道说是周一要安心上班？</span><br />qplot<span style="color: #009900;">(</span>wday<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=newdata<span style="color: #339933;">,</span>geom=<span style="color: blue;">'bar'</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 白天上班的时间聊天比较多嘛，下午形成高峰。</span><br />qplot<span style="color: #009900;">(</span>hour<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=newdata<span style="color: #339933;">,</span>geom=<span style="color: blue;">'bar'</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 关于用户的频度描述</span><br /><span style="color: #666666; font-style: italic;"># 前十大发言最多用户</span><br />user &lt;- <a href="http://inside-r.org/r-doc/base/as.data.frame"><span style="color: #003399; font-weight: bold;">as.data.frame</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/table"><span style="color: #003399; font-weight: bold;">table</span></a><span style="color: #009900;">(</span>newdata$id<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />user &lt;- user<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/order"><span style="color: #003399; font-weight: bold;">order</span></a><span style="color: #009900;">(</span>user$Freq<span style="color: #339933;">,</span>decreasing=T<span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><br />user<span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><br />topuser &lt;- user<span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span>$Var1<br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 活跃天数计算</span><br /><span style="color: #666666; font-style: italic;"># 将数据展开为宽表，每一行为用户，每一列为日期，对应数值为发言次数</span><br />flat.day &lt;- dcast<span style="color: #009900;">(</span>newdata<span style="color: #339933;">,</span>id~<a href="http://inside-r.org/r-doc/base/date"><span style="color: #003399; font-weight: bold;">date</span></a><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #339933;">,</span>value.var=<span style="color: blue;">'date'</span><span style="color: #009900;">)</span><br />flat.mat &lt;- <a href="http://inside-r.org/r-doc/base/as.matrix"><span style="color: #003399; font-weight: bold;">as.matrix</span></a><span style="color: #009900;">(</span>flat.day<span style="color: #009900;">[</span>-<span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span> <span style="color: #666666; font-style: italic;">#转为矩阵</span><br /><span style="color: #666666; font-style: italic;"># 转为0-1值，以观察是否活跃</span><br />flat.mat &lt;- <a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">(</span>flat.mat&gt;<span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 根据上线天数求和</span><br />topday &lt;- <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>flat.day<span style="color: #009900;">[</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">(</span>flat.mat<span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">(</span>topday<span style="color: #009900;">)</span> &lt;- <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">'id'</span><span style="color: #339933;">,</span><span style="color: blue;">'days'</span><span style="color: #009900;">)</span><br />topday &lt;- topday<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/order"><span style="color: #003399; font-weight: bold;">order</span></a><span style="color: #009900;">(</span>topday$days<span style="color: #339933;">,</span>decreasing=T<span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><br /><span style="color: #666666; font-style: italic;"># 获得前十大活跃用户</span><br />topday<span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 观察每天的发言次数</span><br /><span style="color: #666666; font-style: italic;"># online.day为每天的发言次数</span><br />online.day &lt;- <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">(</span>flat.day<span style="color: #009900;">[</span><span style="color: #339933;">,</span>-<span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">)</span><br />tempdf &lt;- <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/time"><span style="color: #003399; font-weight: bold;">time</span></a>=ymd<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">(</span>online.day <span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>online.day <span style="color: #009900;">)</span><br />qplot<span style="color: #009900;">(</span>x=<a href="http://inside-r.org/r-doc/stats/time"><span style="color: #003399; font-weight: bold;">time</span></a><span style="color: #339933;">,</span>y=online.day <span style="color: #339933;">,</span>ymin=<span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>ymax=online.day <span style="color: #339933;">,</span><br />      <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=tempdf<span style="color: #339933;">,</span>geom=<span style="color: blue;">'linerange'</span><span style="color: #009900;">)</span><br />ggsave<span style="color: #009900;">(</span><span style="color: blue;">'2.png'</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 观察到有少数峰值日，看超过200次发言以上是哪几天</span><br /><a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/which"><span style="color: #003399; font-weight: bold;">which</span></a><span style="color: #009900;">(</span>online.day&gt;<span style="color: #cc66cc;">200</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;">#根据flat.day数据观察每天活跃用户变化</span><br /><span style="color: #666666; font-style: italic;"># numday为每天发言人数</span><br />numday &lt;- <a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">(</span>flat.mat<span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">)</span><br />tempdf &lt;- <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/time"><span style="color: #003399; font-weight: bold;">time</span></a>=ymd<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">(</span>numday<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>numday<span style="color: #009900;">)</span><br />qplot<span style="color: #009900;">(</span>x=<a href="http://inside-r.org/r-doc/stats/time"><span style="color: #003399; font-weight: bold;">time</span></a><span style="color: #339933;">,</span>y=numday<span style="color: #339933;">,</span>ymin=<span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>ymax=numday<span style="color: #339933;">,</span><br />      <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=tempdf<span style="color: #339933;">,</span>geom=<span style="color: blue;">'linerange'</span><span style="color: #009900;">)</span><br />ggsave<span style="color: #009900;">(</span><span style="color: blue;">'3.png'</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#直方图观察</span><br />qplot<span style="color: #009900;">(</span>x=numday<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=tempdf<span style="color: #339933;">,</span>geom=<span style="color: blue;">'histogram'</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 当某天登录人数增加的话，发言数也会增加吗？   </span><br />tempdf &lt;- <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/time"><span style="color: #003399; font-weight: bold;">time</span></a>=ymd<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">(</span>online.day <span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>people=numday<span style="color: #339933;">,</span><br />                     speech=online.day<span style="color: #009900;">)</span><br />&nbsp;<br />qplot<span style="color: #009900;">(</span>x=people<span style="color: #339933;">,</span>y=speech <span style="color: #339933;">,</span><br />      <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=tempdf<span style="color: #339933;">,</span>geom=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">'point'</span><span style="color: #339933;">,</span><span style="color: blue;">'smooth'</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 再观察十强选手的日内情况</span><br />flat.hour &lt;- dcast<span style="color: #009900;">(</span>newdata<span style="color: #339933;">,</span>id~hour<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #339933;">,</span>value.var=<span style="color: blue;">'hour'</span><span style="color: #339933;">,</span><br />      <a href="http://inside-r.org/r-doc/base/subset"><span style="color: #003399; font-weight: bold;">subset</span></a>=.<span style="color: #009900;">(</span>id %in% topuser<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 平行坐标图</span><br />hour.melt &lt;- melt<span style="color: #009900;">(</span>flat.hour<span style="color: #009900;">)</span><br />p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=hour.melt<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x=variable<span style="color: #339933;">,</span>y=value<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p + geom_line<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/grDevices/group"><span style="color: #003399; font-weight: bold;">group</span></a>=id<span style="color: #339933;">,</span>color=id<span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />    theme_bw<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+<br />    opts<span style="color: #009900;">(</span>legend.position = <span style="color: blue;">"none"</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 连续对话的次数，以三十分钟为间隔</span><br />newdata$realtime &lt;- strptime<span style="color: #009900;">(</span>newdata$time<span style="color: #339933;">,</span><span style="color: blue;">'%Y/%m/%d %H:%M'</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 时间排序有问题，按时间重排数据</span><br />newdata2 &lt;- newdata<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/order"><span style="color: #003399; font-weight: bold;">order</span></a><span style="color: #009900;">(</span>newdata$realtime<span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><br /><span style="color: #666666; font-style: italic;"># 将数据按讨论来分组</span><br /><a href="http://inside-r.org/r-doc/grDevices/group"><span style="color: #003399; font-weight: bold;">group</span></a> &lt;- <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">11279</span><span style="color: #009900;">)</span><br /><span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span>i <span style="color: black; font-weight: bold;">in</span> <span style="color: #cc66cc;">2</span>:<span style="color: #cc66cc;">11279</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    d &lt;- <a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399; font-weight: bold;">as.numeric</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/difftime"><span style="color: #003399; font-weight: bold;">difftime</span></a><span style="color: #009900;">(</span>newdata2$realtime<span style="color: #009900;">[</span>i<span style="color: #009900;">]</span><span style="color: #339933;">,</span><br />                             newdata2$realtime<span style="color: #009900;">[</span>i-<span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span><br />                             <a href="http://inside-r.org/r-doc/base/units"><span style="color: #003399; font-weight: bold;">units</span></a>=<span style="color: blue;">'mins'</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span> d &lt;<span style="color: #cc66cc;">30</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />        <a href="http://inside-r.org/r-doc/grDevices/group"><span style="color: #003399; font-weight: bold;">group</span></a><span style="color: #009900;">[</span>i<span style="color: #009900;">]</span> &lt;- <a href="http://inside-r.org/r-doc/grDevices/group"><span style="color: #003399; font-weight: bold;">group</span></a><span style="color: #009900;">[</span>i-<span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><br />    <span style="color: #009900;">}</span> <span style="color: black; font-weight: bold;">else</span> <span style="color: #009900;">{</span><a href="http://inside-r.org/r-doc/grDevices/group"><span style="color: #003399; font-weight: bold;">group</span></a><span style="color: #009900;">[</span>i<span style="color: #009900;">]</span> &lt;- <a href="http://inside-r.org/r-doc/grDevices/group"><span style="color: #003399; font-weight: bold;">group</span></a><span style="color: #009900;">[</span>i-<span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span>+<span style="color: #cc66cc;">1</span><span style="color: #009900;">}</span><br /><span style="color: #009900;">}</span><br /><a href="http://inside-r.org/r-doc/graphics/barplot"><span style="color: #003399; font-weight: bold;">barplot</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/table"><span style="color: #003399; font-weight: bold;">table</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/grDevices/group"><span style="color: #003399; font-weight: bold;">group</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 得到719多组对话</span><br />newdata2$group &lt;- <a href="http://inside-r.org/r-doc/grDevices/group"><span style="color: #003399; font-weight: bold;">group</span></a><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># igraph进行十强之间的网络分析</span><br /><span style="color: #666666; font-style: italic;"># 建立关系矩阵，如果两个用户同时在一次群讨论中出现，则计数+1</span><br />newdata3 &lt;- dcast<span style="color: #009900;">(</span>newdata2<span style="color: #339933;">,</span> id~<a href="http://inside-r.org/r-doc/grDevices/group"><span style="color: #003399; font-weight: bold;">group</span></a><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #339933;">,</span> <br />                  value.var=<span style="color: blue;">'group'</span><span style="color: #339933;">,</span><br />                  <a href="http://inside-r.org/r-doc/base/subset"><span style="color: #003399; font-weight: bold;">subset</span></a>=.<span style="color: #009900;">(</span>id %in% topuser<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />newdata4 &lt;- <a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399; font-weight: bold;">ifelse</span></a><span style="color: #009900;">(</span>newdata3<span style="color: #009900;">[</span><span style="color: #339933;">,</span>-<span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span> &gt; <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>newdata4<span style="color: #009900;">)</span> &lt;- newdata3<span style="color: #009900;">[</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><br />relmatrix &lt;- newdata4 %*% <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">(</span>newdata4<span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 很容易看出哪两个人聊得最多，6cha4376和4cha3875，有基情？</span><br />deldiag &lt;- relmatrix-<a href="http://inside-r.org/r-doc/base/diag"><span style="color: #003399; font-weight: bold;">diag</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/diag"><span style="color: #003399; font-weight: bold;">diag</span></a><span style="color: #009900;">(</span>relmatrix<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/which"><span style="color: #003399; font-weight: bold;">which</span></a><span style="color: #009900;">(</span>deldiag==<a href="http://inside-r.org/r-doc/base/max"><span style="color: #003399; font-weight: bold;">max</span></a><span style="color: #009900;">(</span>deldiag<span style="color: #009900;">)</span><span style="color: #339933;">,</span>arr.ind=T<span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 根据关系矩阵画社交网络画</span><br />g &lt;- graph.adjacency<span style="color: #009900;">(</span>relmatrix<span style="color: #339933;">,</span>weighted=T<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/mode"><span style="color: #003399; font-weight: bold;">mode</span></a>=<span style="color: blue;">'undirected'</span><span style="color: #009900;">)</span><br />g &lt;-simplify<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span><br />V<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span>$label&lt;-<a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>relmatrix<span style="color: #009900;">)</span><br />V<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span>$degree&lt;- degree<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span><br />layout1 &lt;- layout.fruchterman.reingold<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span><br />egam &lt;- <span style="color: #cc66cc;">10</span>*E<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span>$weight/max<span style="color: #009900;">(</span>E<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span>$weight<span style="color: #009900;">)</span><br />egam &lt;- <span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">(</span>E<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span>$weight<span style="color: #009900;">)</span>+<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span> / <a href="http://inside-r.org/r-doc/base/max"><span style="color: #003399; font-weight: bold;">max</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/log"><span style="color: #003399; font-weight: bold;">log</span></a><span style="color: #009900;">(</span>E<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span>$weight<span style="color: #009900;">)</span>+<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span><br />V<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span>$label.cex &lt;- V<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span>$degree / <a href="http://inside-r.org/r-doc/base/max"><span style="color: #003399; font-weight: bold;">max</span></a><span style="color: #009900;">(</span>V<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span>$degree<span style="color: #009900;">)</span>+ <span style="color: #cc66cc;">.2</span><br />V<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span>$label.color &lt;- <a href="http://inside-r.org/r-doc/grDevices/rgb"><span style="color: #003399; font-weight: bold;">rgb</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.2</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">.8</span><span style="color: #009900;">)</span><br />V<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span>$frame.color &lt;- <span style="color: black; font-weight: bold;">NA</span><br />E<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span>$width &lt;- egam<br />E<span style="color: #009900;">(</span>g<span style="color: #009900;">)</span>$color &lt;- <a href="http://inside-r.org/r-doc/grDevices/rgb"><span style="color: #003399; font-weight: bold;">rgb</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> egam<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399; font-weight: bold;">plot</span></a><span style="color: #009900;">(</span>g<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/graphics/layout"><span style="color: #003399; font-weight: bold;">layout</span></a>=layout1<span style="color: #009900;">)</span></pre></div></div>
