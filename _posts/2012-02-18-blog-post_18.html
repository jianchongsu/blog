--- 
layout: post
name: blog-post_18
title: "\xE6\x95\xB0\xE5\xAD\x97\xE6\x98\xBE\xE5\xBE\xAE\xE9\x95\x9C\xE4\xB8\x8B\xE7\x9A\x84\xE6\x9E\x97\xE4\xB9\xA6\xE8\xB1\xAA"
date: 2012-02-18 16:17:00 +08:00
categories: 
- ggplot2
- "\xE5\xA4\x9A\xE5\x85\x83\xE5\x88\x86\xE6\x9E\x90"
permalink: /2012/02/blog-post_18.html
---
<div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/IFjVlCY3.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="176" src="http://thumbsnap.com/i/IFjVlCY3.jpg" width="200" /></a></div>现在网络上最为炙手可热的人物恐怕就是NBA新星<b>林书豪（Jeremy Lin）</b>了，但是俗话说：不怕不识货，就怕货比货。这位初生牛犊与其它NBA巨星相比，到底有多么优秀？还有多少差距？还是让数字来说话吧。首先从<a href="http://www.basketball-reference.com/leagues/NBA_2012_stats.html">这里</a>下载2011-2012NBA赛季的球员数据，该数据中共有四百位球员，取得分最多的前一百位球员，将其数据拷贝到Excel中，并将林同学的数据添加在最后，删除了所属球队和排名之后我们得到了一个<a href="http://www.box.com/s/fzo21t9uyzahrzyf208r">CSV数据文件</a>。数据中的变量说明附后。<br /><br /><b>第一步：</b>我们先画出这些变量的<b>相关系数图</b>，以剔除一些冗余的变量，从下图可看到深兰色方块即表示两组数据间有较强正相关，那么我们只需取其中一组数据即可，例如TRB（篮板总数）就可以代替ORB/DRB/BUK。由此我们提取MP/FGA/FGP/X3PP/FT/FTP/TRB/AST/STL/PF/TOV/PTS这12个变量作进一步处理。<br /><a name='more'></a><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/kN3fSPUn.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://thumbsnap.com/i/kN3fSPUn.jpg" /></a></div><b>第二步：</b>分别绘制这些变量的<b>箱线图</b>，并观察林同学在一百位NBA球员中的位置。但需要注意的是，林同学作为崭露头角的新星，上场时间较少。为了公平的比较在单位时间内的各项指标，需要将一些指标按上场时间进行平均化处理。例如将总得分数除以出场时间，但其它一些指标如进球率则保留不变。<br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/Ttgb0vum.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://thumbsnap.com/i/Ttgb0vum.jpg" /></a></div>上面的箱线图中红色的点即代表林书豪，可观察到他在助攻(AST.MP)和得分能力(PTS.MP)方面表现优秀，在得球机会(FGA&gt;MP)和命中率(FTP)方面亦属上佳，三分球命中率(X3PP)和罚球命中率(FGP)则属下乘，而且失误(TOV.MP)数字也相当的多。那么蓝色的点，你知道是代表哪一位球员吗？那就是目前的得分王科比。仔细比较一下吧。<br /><br /><b>第三步：</b>上面对各指标分别进行了一维的比较，下面用<a href="http://www.blogger.com/"><b><span id="goog_676853953"></span>多维标度分析方法</b><span id="goog_676853954"></span></a>，将多维空间的对象简化到低维空间进行定位和分析。提取前两维绘制成散点图如下。其中红色点表示是林同学的位置，而蓝色点则是总得分排名前十位的球员。从图上似乎可以得到令人吃惊的结论，那就是林同学几乎可与这十位巨星球员归为一类了。<br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/WihPNckY.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://thumbsnap.com/i/WihPNckY.jpg" /></a></div><b>结语：</b>对篮球和数字感兴趣的同学可以作进一步的研究。但有几点需要注意的是：1、表面的数字不一定代表球员能力，原因正如笔者在<a href="http://xccds1977.blogspot.com/2012/01/moneyball.html">体育数据挖掘</a>一文中提到过的；2、林同学上场时间还不多，样本太少，不一定具有代表性；3、上面是将林同学和一百位NBA球员进行比较，合适的作法还应该将他与打同一位置的球员加以比对。但这个数据中并未包含此信息。<br /><br /><b>R代码：</b><br /><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;">#读取CSV数据文件</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a> &lt;- <a href="http://inside-r.org/r-doc/utils/read.csv"><span style="color: #003399;">read.csv</span></a><span style="color: #009900;">(</span><span style="color: blue;">'d:/nba.csv'</span><span style="color: #339933;">,</span>sep=<span style="color: blue;">','</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399;">summary</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#绘制变量间的相关系数图</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/corrgram">corrgram</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/packages/cran/corrgram">corrgram</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">[</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span>-<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span>-<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#将几个指标除以上场时间，再合成为新的数据</span><br />temple.data &lt;- <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399;">sapply</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">'FGA'</span><span style="color: #339933;">,</span><span style="color: blue;">'FT'</span><span style="color: #339933;">,</span><span style="color: blue;">'TRB'</span><span style="color: #339933;">,</span><span style="color: blue;">'AST'</span><span style="color: #339933;">,</span><span style="color: blue;">'STL'</span><span style="color: #339933;">,</span><span style="color: blue;">'PF'</span><span style="color: #339933;">,</span><span style="color: blue;">'TOV'</span><span style="color: #339933;">,</span><span style="color: blue;">'PTS'</span><span style="color: #009900;">)</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span> x/data<span style="color: #009900;">[</span><span style="color: blue;">'MP'</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />newdata1 &lt;- <a href="http://inside-r.org/r-doc/base/cbind"><span style="color: #003399;">cbind</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">'FGP'</span><span style="color: #339933;">,</span><span style="color: blue;">'X3PP'</span><span style="color: #339933;">,</span><span style="color: blue;">'FTP'</span><span style="color: #009900;">)</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/as.data.frame"><span style="color: #003399;">as.data.frame</span></a><span style="color: #009900;">(</span>temple.data<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#对数据进行融合以方便ggplot2绘图</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/reshape"><span style="color: #003399;">reshape</span></a><span style="color: #009900;">)</span><br />newdata2 &lt;- melt<span style="color: #009900;">(</span>newdata1<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#提取林书豪与科比的数据</span><br />lindata&lt;-melt<span style="color: #009900;">(</span>newdata1<span style="color: #009900;">[</span><span style="color: #cc66cc;">101</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />kobedata &lt;-melt<span style="color: #009900;">(</span>newdata1<span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#构建ggplot图层的基本数据层</span><br />p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=newdata2<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x=variable<span style="color: #339933;">,</span>y=value<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#添加箱线图和点图</span><br />p + geom_boxplot<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+<br />  geom_point<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=lindata<span style="color: #339933;">,</span>colour=<span style="color: blue;">'red'</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">3</span><span style="color: #009900;">)</span>+<br />  geom_point<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=kobedata<span style="color: #339933;">,</span>colour=<span style="color: blue;">'blue'</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">3</span><span style="color: #009900;">)</span>+<br />  coord_flip<span style="color: #009900;">(</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#加载MASS包进行MDS分析</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/MASS">MASS</a><span style="color: #009900;">)</span><br />nba.mds &lt;- <a href="http://inside-r.org/r-doc/MASS/isoMDS"><span style="color: #003399;">isoMDS</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/dist"><span style="color: #003399;">dist</span></a><span style="color: #009900;">(</span>newdata1<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#提取前两维数据</span><br />x = nba.mds$points<span style="color: #009900;">[</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><br />y = nba.mds$points<span style="color: #009900;">[</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">]</span><br />mds.data &lt;-<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399;">data.frame</span></a><span style="color: #009900;">(</span>x<span style="color: #339933;">,</span>y<span style="color: #339933;">,</span>player=<a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>$Player<span style="color: #009900;">)</span><br />lin.data &lt;- mds.data<span style="color: #009900;">[</span><span style="color: #cc66cc;">101</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><br />topten.data &lt;- mds.data<span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><br /><span style="color: #666666; font-style: italic;">#绘制散点图</span><br />g &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=mds.data<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x<span style="color: #339933;">,</span>y<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />g + geom_point<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+<br />  geom_point<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=lin.data<span style="color: #339933;">,</span>color=<span style="color: blue;">'red'</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">4</span><span style="color: #009900;">)</span>+<br />  geom_point<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=topten.data<span style="color: #339933;">,</span>color=<span style="color: blue;">'blue'</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">3</span><span style="color: #009900;">)</span>+<br />  geom_text<span style="color: #009900;">(</span>size=<span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=topten.data<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>label=player<span style="color: #009900;">)</span><span style="color: #339933;">,</span>hjust=<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span>vjust=<span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>alpha=<span style="color: #cc66cc;">0.5</span><span style="color: #009900;">)</span></span></pre></div><br /><b>变量说明：</b><br />G：出场次数<br />GS：先发次数<br />MP：上场时间<br />FG：投中次数<br />FGA：投篮次数<br />FGP：命中率<br />3P：3分命中次数<br />3PA：3分投篮次数<br />3PP：3分命中率<br />FT：罚球命中次数<br />FTA：罚球次数<br />FTP：罚球命中率<br />ORB：进攻篮板<br />DRB：防守篮板<br />TRB：总篮板<br />AST：助攻<br />STL：盗球<br />BLK：封盖<br />TOV：失误<br />PF：个人犯规<br />PTS：总得分<br />变量名后加.MP的表示以上场时间进行了平均处理。
