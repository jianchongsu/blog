--- 
layout: post
name: r_28
title: "\xE5\x9C\xA8R\xE8\xAF\xAD\xE8\xA8\x80\xE4\xB8\xAD\xE5\xAF\xB9\xE5\x9B\x9E\xE5\xBD\x92\xE6\xA0\x91\xE6\xA8\xA1\xE5\x9E\x8B\xE3\x80\x81\xE8\xA3\x85\xE8\xA2\x8B\xE7\xAE\x97\xE6\xB3\x95\xE4\xB8\x8E\xE9\x9A\x8F\xE6\x9C\xBA\xE6\xA3\xAE\xE6\x9E\x97\xE4\xB9\x8B\xE9\x97\xB4\xE7\x9A\x84\xE7\xAE\x80\xE5\x8D\x95\xE6\xAF\x94\xE8\xBE\x83"
date: 2011-07-28 15:45:00 +08:00
categories: 
- "\xE5\x86\xB3\xE7\xAD\x96\xE6\xA0\x91"
- "\xE8\xA3\x85\xE8\xA2\x8B"
- "\xE9\x9A\x8F\xE6\x9C\xBA\xE6\xA3\xAE\xE6\x9E\x97"
permalink: /2011/07/r_28.html
---
回归树模型在之前的<a href="http://xccds1977.blogspot.com/2011/06/cartr.html">博客文章</a>中已有介绍。而<b>装袋算法与随机森林</b>相对而言会生成多个树模型，再进行组合预测，其效果远大于单个树模型。装袋算法（bagging）采取自助法的思路，从样本中随机抽样，形成多个训练样本，生成多个树模型。然后以多数投票的方式来预测结果。随机森林则(randomForest)更进一步，不仅对样本进行抽样，还对变量进行抽样。下面来横向对比一下各算法。<br /><br />首先读入必要的程序包<br />library(DMwR)<br />library(rpart)<br />library(ipred)<br />library(randomForest)<br /><br />前二种算法可以计算缺失数据，但随机森林不行，所以还需将数据进行清洗整理<br /><a name='more'></a><br />data(algae)<br />algae &lt;- algae[-manyNAs(algae), ]<br />clean.algae &lt;- knnImputation(algae,k=10)<br /><br />回归树模型计算<br />model.tree=rpart(a1 ~ ., data = clean.algae[, 1:12])<br />pre.tree &lt;- predict(model.tree, clean.algae)<br />plot(pre.tree~clean.algae$a1)<br />nmse1 &lt;- mean((pre.tree- clean.algae[,'a1'])^2)/<br />mean((mean(clean.algae[,'a1'])- clean.algae[,'a1'])^2)<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-JlOKhKe-u7I/TjEU_FcnqmI/AAAAAAAAAWM/oHttv6eMMMQ/s1600/1.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="313" src="http://1.bp.blogspot.com/-JlOKhKe-u7I/TjEU_FcnqmI/AAAAAAAAAWM/oHttv6eMMMQ/s400/1.jpeg" width="400" /></a></div><br />装袋算法计算<br />model.bagging &lt;- bagging(<br />a1 ~ ., data = clean.algae[, 1:12], nbagg=1000)<br />pre.bagging=predict(model.bagging,clean.algae)<br />plot(pre.bagging~clean.algae$a1)<br />nmse2 &lt;- mean((pre.bagging- clean.algae[,'a1'])^2)/<br />mean((mean(clean.algae[,'a1'])- clean.algae[,'a1'])^2)<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-Zkj87saWfQg/TjEVC5jhu9I/AAAAAAAAAWQ/I6yUUeHWmY0/s1600/2.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="313" src="http://3.bp.blogspot.com/-Zkj87saWfQg/TjEVC5jhu9I/AAAAAAAAAWQ/I6yUUeHWmY0/s400/2.jpeg" width="400" /></a></div><br />随机森林计算<br />model.forest &lt;-randomForest(a1 ~ ., data = clean.algae)<br />#若有缺失数据需加入： na.action=na.omit<br />pre.forest=predict(model.forest, clean.algae)<br />plot(pre.forest~ clean.algae$a1)<br />(nmse3 &lt;- mean((pre.forest- clean.algae[,'a1'])^2)/<br />mean((mean( clean.algae[,'a1'])- clean.algae[,'a1'])^2)<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-UcAzklJ3G_U/TjEVGb3nJAI/AAAAAAAAAWU/u138BCF3iW4/s1600/3.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="313" src="http://3.bp.blogspot.com/-UcAzklJ3G_U/TjEVGb3nJAI/AAAAAAAAAWU/u138BCF3iW4/s400/3.jpeg" width="400" /></a></div><br />print(c(nmse1,nmse2,nmse3))<br />用预测值与真值之间的相对离差平方和来作为测量误差的指标，其结果分别为：<span class="Apple-style-span" style="font-family: 'DejaVu Sans Mono'; font-size: 13px; line-height: 17px; white-space: pre-wrap;">0.3541180 0.3103366 0.1002235 </span>可以看出随机森林是最有效的。<br /><br />再来看看处理分类数据的表现，利用iris数据来判断花的种类<br /><br />library(randomForest)<br />model.forest &lt;-randomForest(Species ~ ., data = iris)<br />pre.forest=predict(model.forest, iris)<br />table(pre.forest,iris$Species)<br /><span class="Apple-style-span" style="font-family: 'DejaVu Sans Mono'; font-size: 13px; line-height: 17px; white-space: pre-wrap;"></span><br /><pre class="GD40030CLR" style="border-bottom-style: none; border-color: initial; border-left-style: none; border-right-style: none; border-top-style: none; border-width: initial; font-family: 'DejaVu Sans Mono'; font-size: 10pt !important; line-height: 1.3; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: none; outline-width: initial; white-space: pre-wrap !important;" tabindex="0">pre.forest   setosa versicolor virginica<br />  setosa         50          0         0<br />  versicolor      0         50         0<br />  virginica       0          0        50</pre><br />library(rpart)<br />model.tree=rpart(Species ~ ., data = iris,method='class')<br />pre.tree=predict(model.tree, data = iris,type='class')<br />table(pre.tree,iris$Species)<br /><br /><span class="Apple-style-span" style="font-family: 'DejaVu Sans Mono'; font-size: 13px; line-height: 17px; white-space: pre-wrap;"></span><br /><pre class="GD40030CLR" style="border-bottom-style: none; border-color: initial; border-left-style: none; border-right-style: none; border-top-style: none; border-width: initial; font-family: 'DejaVu Sans Mono'; font-size: 10pt !important; line-height: 1.3; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: none; outline-width: initial; white-space: pre-wrap !important;" tabindex="0">pre.tree     setosa versicolor virginica<br />  setosa         50          0         0<br />  versicolor      0         49         5<br />  virginica       0          1        45</pre><pre class="GD40030CLR" style="border-bottom-style: none; border-color: initial; border-left-style: none; border-right-style: none; border-top-style: none; border-width: initial; font-family: 'DejaVu Sans Mono'; font-size: 10pt !important; line-height: 1.3; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: none; outline-width: initial; white-space: pre-wrap !important;" tabindex="0"></pre><br />随机森林算法预测全对，而分类树模型则有六处错误。
