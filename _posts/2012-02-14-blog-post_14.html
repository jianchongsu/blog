--- 
layout: post
name: blog-post_14
title: "\xE5\xA6\x82\xE4\xBD\x95\xE7\xBB\x98\xE5\x88\xB6\xE8\x9C\xA1\xE7\x83\x9B\xE5\x9B\xBE\xE5\xB9\xB6\xE6\xB7\xBB\xE5\x8A\xA0\xE8\x87\xAA\xE5\xAE\x9A\xE4\xB9\x89\xE6\x8C\x87\xE6\xA0\x87"
date: 2012-02-14 20:03:00 +08:00
categories: 
- "\xE9\x87\x91\xE8\x9E\x8D\xE8\xAE\xA1\xE7\xAE\x97"
permalink: /2012/02/blog-post_14.html
---
股票分析中的蜡烛图和技术指标并非什么神奇的东西。指标只不过是过去历史数据的一种函数。再复杂的函数，其输入变量都是过去已经发生的事情。而过去发生的事情，未来不一定重复。所以在学术界，对于股票价格的走势大多是以带漂移项的随机过程来建模。其中重要的因素就是随机因子对于价格的冲击。<br /><br />如果你用一个蒙特卡罗仿真构建一个虚拟的股票趋势，那些迷信技术分析的人看到了或许就会跑过来问你这支股票的代码。技术指标虽然没什么预测的能力，但技术指标可以告诉我们已经发生的事情，所以有时候需要绘制蜡烛图，可能还需要添加一些自定义的指标。R语言中的quantmod包是一个非常强悍的金融计算包，它可以帮助股票分析人员进行定量化交易的研发、测试和部署。有兴趣的同学可以参见它的<a href="http://www.quantmod.com/">官方网站</a>，不过作者似乎很长时间没有更新了。另外，邓一硕在其博客中也对quantmod包作了很完整的<a href="http://yishuo.org/2012/02/notes-on-quantmod-2/">总结</a>，除了关键的交易系统建模部分。<br /><a name='more'></a><br />本例希望讲解如何绘制蜡烛图，并添加股价变动的“偏度”指标，这里所谓股价的变动定义为收盘价与开盘价之差。在很多情况下股价变动呈一个钟形的分布，本例的自定义指标就是考虑该分布的偏度数值。<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;">#首先加载必要的扩展包</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/quantmod">quantmod</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/e1071">e1071</a><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#读取2010年到2012年间的上证指数</span><br />getSymbols<span style="color: #009900;">(</span><span style="color: blue;">'^SSEC'</span><span style="color: #339933;">,</span>from = <span style="color: blue;">'2010-01-01'</span><span style="color: #339933;">,</span>to=<span style="color: blue;">'2012-02-14'</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#建立自定义指标函数来计算价格变化的偏度</span><br />skew.ind &lt;- <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399;">function</span></a><span style="color: #009900;">(</span>quotes<span style="color: #339933;">,</span>n.days=<span style="color: #cc66cc;">20</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span><br />    <a href="http://inside-r.org/r-doc/base/diff"><span style="color: #003399;">diff</span></a> &lt;- Cl<span style="color: #009900;">(</span>quotes<span style="color: #009900;">)</span>-Op<span style="color: #009900;">(</span>quotes<span style="color: #009900;">)</span><br />    r &lt;- <a href="http://inside-r.org/r-doc/base/matrix"><span style="color: #003399;">matrix</span></a><span style="color: #009900;">(</span><span style="color: black;">NA</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/ncol"><span style="color: #003399;">ncol</span></a>=n.days<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/nrow"><span style="color: #003399;">nrow</span></a> = <a href="http://inside-r.org/r-doc/base/NROW"><span style="color: #003399;">NROW</span></a><span style="color: #009900;">(</span>quotes<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />    <span style="color: black;">for</span> <span style="color: #009900;">(</span>x <span style="color: black;">in</span> <span style="color: #cc66cc;">1</span>:n.days<span style="color: #009900;">)</span> r<span style="color: #009900;">[</span> <span style="color: #339933;">,</span>x<span style="color: #009900;">]</span> &lt;- Lag<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/diff"><span style="color: #003399;">diff</span></a><span style="color: #339933;">,</span>x-<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span><br />    x &lt;- <a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399;">apply</span></a> <span style="color: #009900;">(</span>r<span style="color: #339933;">,</span> <span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span> skewness<span style="color: #009900;">)</span><br />    <span style="color: black;">if</span> <span style="color: #009900;">(</span>is.xts<span style="color: #009900;">(</span>quotes<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />        <a href="http://inside-r.org/packages/cran/xts">xts</a><span style="color: #009900;">(</span>x<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/time"><span style="color: #003399;">time</span></a><span style="color: #009900;">(</span>quotes<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />    <span style="color: black;">else</span> x<br /><span style="color: #009900;">}</span><br /><span style="color: #666666; font-style: italic;">#绘制最近6个月的蜡烛图并添加偏度指标</span><br />candleChart<span style="color: #009900;">(</span>last<span style="color: #009900;">(</span>SSEC<span style="color: #339933;">,</span><span style="color: blue;">'6 months'</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>theme=<span style="color: blue;">'white'</span><span style="color: #339933;">,</span>TA=<span style="color: black;">NULL</span><span style="color: #009900;">)</span><br />addT1.ind&lt;-newTA<span style="color: #009900;">(</span>FUN=skew.ind<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399;">col</span></a>=<span style="color: blue;">'red'</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/graphics/legend"><span style="color: #003399;">legend</span></a>=<span style="color: blue;">'偏度'</span><span style="color: #009900;">)</span><br />addT1.ind<span style="color: #009900;">(</span><span style="color: #009900;">)</span></span></pre></div></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-5zwDNI4NHhM/TzpNTt838fI/AAAAAAAAAuU/oKa1vEc90WA/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-5zwDNI4NHhM/TzpNTt838fI/AAAAAAAAAuU/oKa1vEc90WA/s1600/Rplot01.jpeg" /></a></div><br />
