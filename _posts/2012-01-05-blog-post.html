--- 
layout: post
name: blog-post
title: "\xE5\x86\x8D\xE8\xB0\x88\xE5\xB9\xBF\xE4\xB9\x89\xE7\xBA\xBF\xE6\x80\xA7\xE6\xA8\xA1\xE5\x9E\x8B"
date: 2012-01-05 16:23:00 +08:00
categories: 
- "Poisson\xE5\x9B\x9E\xE5\xBD\x92"
- "logistic\xE5\x9B\x9E\xE5\xBD\x92"
- "\xE5\xB9\xBF\xE4\xB9\x89\xE7\xBA\xBF\xE6\x80\xA7\xE6\xA8\xA1\xE5\x9E\x8B"
permalink: /2012/01/blog-post.html
---
<b>广义线性模型</b>（generalized linear model, GLM)是简单最小二乘回归（OLS)的扩展，在OLS的假设中，响应变量是连续数值数据且服从正态分布，而且响应变量期望值与预测变量之间的关系是线性关系。而广义线性模型则放宽其假设，首先响应变量可以是正整数或分类数据，其分布为某指数分布族。其次响应变量期望值的函数（连接函数）与预测变量之间的关系为线性关系。因此在进行GLM建模时，需要指定分布类型和连接函数。<br /><br />在R中通常使用glm函数构造广义线性模型，其中分布参数包括了binomaial（两项分布）、gaussian（正态分布）、gamma（伽马分布）、poisson(泊松分布)等。和lm函数类似，glm的建模结果可以通过下述的泛型函数进行二次处理，如summary()、coef()、confint()、residuals()、anova()、plot()、predict()<br /><a name='more'></a><br /><br /><b><span style="font-size: large;">一、Logistic回归</span></b><br />Logistic回归中假设响应变量服从二项分布，参数family设置为binomial，连接函数link设置为logit，我们以AER包中的Affairs数据集作为例子。该数据集是关于婚姻出轨，其中affairs变量表示出轨次数，数据集中还包括结婚时间、教育、宗教等其它变量。由于affairs为正整数，为了进行Logistic回归先要将其转化为二元变量。<br /><span style="font-family: 'Courier New', Courier, monospace;"><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">(</span>Affairs<span style="color: #339933;">,</span> package=<span style="color: blue;">'AER'</span><span style="color: #009900;">)</span></span><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;">Affairs$ynaffair<span style="color: #009900;">[</span>Affairs$affairs &gt; <span style="color: #cc66cc;">0</span><span style="color: #009900;">]</span> &lt;- <span style="color: #cc66cc;">1</span><br />Affairs$ynaffair<span style="color: #009900;">[</span>Affairs$affairs &gt; <span style="color: #cc66cc;">0</span><span style="color: #009900;">]</span> &lt;- <span style="color: #cc66cc;">0</span><br />Affairs$ynaffair &lt;- <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399;">factor</span></a><span style="color: #009900;">(</span>Affairs$ynaffair<span style="color: #339933;">,</span> <br />                             <a href="http://inside-r.org/r-doc/base/levels"><span style="color: #003399;">levels</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span> <br />                             <a href="http://inside-r.org/r-doc/base/labels"><span style="color: #003399;">labels</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">"No"</span><span style="color: #339933;">,</span><span style="color: blue;">"Yes"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />model.L &lt;- <a href="http://inside-r.org/r-doc/stats/glm"><span style="color: #003399;">glm</span></a><span style="color: #009900;">(</span>ynaffair ~ age + yearsmarried + religiousness +rating<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=Affairs<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/stats/family"><span style="color: #003399;">family</span></a>=<a href="http://inside-r.org/r-doc/stats/binomial"><span style="color: #003399;">binomial</span></a><span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399;">summary</span></a><span style="color: #009900;">(</span>model.L<span style="color: #009900;">)</span><br /></span><span style="font-family: inherit;">若样本观测值变异性过大，即出现了过度离散现象，此时仍使用二项分布假设就会影响系数检测的显著性。那么补救的方法是使用准二项分布（quasibinomial）。首先要检测样本是否存在过度离散现象，方法是用残差除以残差自由度，若超过1则意味着过度离散。那么将family参数改为quasibinomial。</span></pre></div></div>其它和Logistic回归相关的函数还包括：robust包中的glmRob函数实施稳健GLM；mlogit包中的mlogit函数对多分类变量进行logistic回归；rms包中的lrm函数对顺序变量进行Logistic回归。之前的这篇<a href="http://xccds1977.blogspot.com/2011/11/rlogistic.html" target="_blank">博文</a>对Logistic回归亦有一定的涉及。<br /><br /><b><span style="font-size: large;">二、Poisson回归</span></b><br />泊松回归假设响应变量服从泊松分布，而连接函数为log函数。仍以前面未转化的Affairs数据集为例。建立模型后通过coef函数来提取模型系数，因为泊松回归中响应变量经过了log函数变换，所以对系数进行指数变换可更好的对结果进行解释。从中观察到，在其它变量不变前提下，结婚时间增长1年，那么出轨次数期望值则变为之前的1.11倍。<br /><span style="font-family: 'Courier New', Courier, monospace;">model.P &lt;- </span><a href="http://inside-r.org/r-doc/stats/glm" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">glm</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">affairs ~ age + yearsmarried + religiousness +</span><span style="font-family: 'Courier New', Courier, monospace;">rating</span><span style="color: #339933; font-family: 'Courier New', Courier, monospace;">,</span><span style="font-family: 'Courier New', Courier, monospace;"> </span><a href="http://inside-r.org/r-doc/utils/data" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">data</span></a><span style="font-family: 'Courier New', Courier, monospace;">=Affairs</span><span style="color: #339933; font-family: 'Courier New', Courier, monospace;">,</span><span style="font-family: 'Courier New', Courier, monospace;"> </span><a href="http://inside-r.org/r-doc/stats/family" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">family</span></a><span style="font-family: 'Courier New', Courier, monospace;">=</span><a href="http://inside-r.org/r-doc/stats/poisson" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">poisson</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><br /><a href="http://inside-r.org/r-doc/base/exp" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">exp</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><a href="http://inside-r.org/r-doc/stats/coef" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">coef</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">model.P</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><br />(Intercept) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; age &nbsp;yearsmarried religiousness &nbsp; &nbsp; &nbsp; &nbsp;rating<br />&nbsp;15.6175253 &nbsp; &nbsp; 0.9733061 &nbsp; &nbsp; 1.1163656 &nbsp; &nbsp; 0.6971279 &nbsp; &nbsp; 0.6691823<br />同样，在进行泊松分布也要考虑过度离散现象。其检测方法同样是残差除以其自由度。若确定过度离散存在，则要将family参数设置为准泊松分布(quasipoisson)。
