--- 
layout: post
name: "500"
title: "\xE6\x9D\xA5\xE7\x8E\xA9\xE4\xB8\x80\xE7\x8E\xA9\xE5\x85\xA8\xE7\x90\x83500\xE5\xBC\xBA\xE6\x8E\x92\xE8\xA1\x8C\xE6\xA6\x9C\xE6\x95\xB0\xE6\x8D\xAE"
date: 2012-07-23 10:25:00 +08:00
categories: 
- "\xE7\xBB\x98\xE5\x9B\xBE"
- "\xE5\x85\xAC\xE5\xBC\x80\xE6\x95\xB0\xE6\x8D\xAE"
permalink: /2012/07/500.html
---
<span style="background-color: white;">金融时报在7月20日公布了</span><a href="http://www.ftchinese.com/story/001045598" style="background-color: white;">全球500强排行榜</a><span style="background-color: white;">。</span><span style="background-color: white;">根据这个数据尝试回答下面的一些问题。</span><br /><br /><b>1. 哪个行业的上榜公司最多？</b><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-RLfsyZCUiZg/UAyyFiL5xvI/AAAAAAAABDI/_7JLUUsFmsI/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-RLfsyZCUiZg/UAyyFiL5xvI/AAAAAAAABDI/_7JLUUsFmsI/s1600/Rplot01.jpeg" /></a></div><span style="background-color: white;">看得出来，银行、石油、制药是前三强。</span><br /><br /><b></b><br /><a name='more'></a><b>2. 哪个国家的上榜公司最多？</b><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-ESSC-yFUs9Y/UAyyUjr1BSI/AAAAAAAABDQ/r6XHoEu5iuw/s1600/Rplot02.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-ESSC-yFUs9Y/UAyyUjr1BSI/AAAAAAAABDQ/r6XHoEu5iuw/s1600/Rplot02.jpeg" /></a></div><span style="background-color: white;">美国公司占据了大部分，日本和英国则位居其后。</span><br /><br /><b>3. 哪个行业最赚钱？</b><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-bdrAsMKJBsA/UAyymeQXu5I/AAAAAAAABDY/KKiob6inFdM/s1600/Rplot03.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-bdrAsMKJBsA/UAyymeQXu5I/AAAAAAAABDY/KKiob6inFdM/s1600/Rplot03.jpeg" /></a></div><span style="background-color: white;">根据各行业公司的净利润中位数进行排序，</span>地产、采矿、石油这三个行业公司利润不错。<br /><br /><b>4. 公司的排名变化如何？</b><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-UasyvK5oEaY/UAyy8YoRqHI/AAAAAAAABDg/aY7k8Rc8Jz8/s1600/Rplot.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-UasyvK5oEaY/UAyy8YoRqHI/AAAAAAAABDg/aY7k8Rc8Jz8/s1600/Rplot.jpeg" /></a></div><br />根据2011年和2012年的排位之差，计算各公司的排名变化，对于2011年未上榜公司假设为501名。大致上正态分布，在退步前十名中有知名的Nokia、Sony、Philips。<br /><br /><b>5. 哪个行业的排名进步最大？</b><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-myAHQXQs1yQ/UAyzRbfRgSI/AAAAAAAABDo/wLHtOkoFkbo/s1600/Rplot04.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-myAHQXQs1yQ/UAyzRbfRgSI/AAAAAAAABDo/wLHtOkoFkbo/s1600/Rplot04.jpeg" /></a></div><span style="background-color: white;">取其行业公司排名变化的中位数，</span><span style="background-color: white;">旅游、地产、烟草公司排名有进步。</span><br /><br /><span style="background-color: white;"><b>5. 中国的上榜公司排名总体变化如何？</b></span><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-Jv85fkSgGfM/UAyze3BNllI/AAAAAAAABDw/WJ8wLBV1i6c/s1600/Rplot05.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-Jv85fkSgGfM/UAyze3BNllI/AAAAAAAABDw/WJ8wLBV1i6c/s1600/Rplot05.jpeg" /></a></div><span style="background-color: white;"><br /></span><br /><span style="background-color: white;">和上面的一样，取各国公司排名变化的中位数，看得出中国上榜公司的排名</span><span style="background-color: white;">略有下降。东南亚新兴市场的公司有很大进步。</span><br /><br />需要说明的是FT只提供了排名的PDF文档，如果各位数据爱好者要折腾的话需要先将其转为Excel格式，或者下载我已经整理好的<a href="https://www.box.com/s/5b174db5d39ae7c3a228">CSV文档</a>。<br /><br />R代码如下：<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;">mydata &lt;- <a href="http://inside-r.org/r-doc/utils/read.csv"><span style="color: #003399;">read.csv</span></a><span style="color: #009900;">(</span><span style="color: blue;">'d:<span style="color: #000099;">\\</span>ft500.csv'</span><span style="color: #339933;">,</span>T<span style="color: #339933;">,</span>stringsAsFactors = F<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>  &lt;- <a href="http://inside-r.org/r-doc/base/transform"><span style="color: #003399;">transform</span></a><span style="color: #009900;">(</span>mydata<span style="color: #339933;">,</span><br />          Country = <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399;">factor</span></a><span style="color: #009900;">(</span>Country<span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />          Sector = <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399;">factor</span></a><span style="color: #009900;">(</span>Sector<span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />          value = <a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399;">as.numeric</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/gsub"><span style="color: #003399;">gsub</span></a><span style="color: #009900;">(</span><span style="color: blue;">','</span><span style="color: #339933;">,</span><span style="color: blue;">''</span><span style="color: #339933;">,</span>value<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />          netincome = <a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399;">as.numeric</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/gsub"><span style="color: #003399;">gsub</span></a><span style="color: #009900;">(</span><span style="color: blue;">','</span><span style="color: #339933;">,</span><span style="color: blue;">''</span><span style="color: #339933;">,</span>netincome<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />          employees = <a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399;">as.numeric</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/gsub"><span style="color: #003399;">gsub</span></a><span style="color: #009900;">(</span><span style="color: blue;">','</span><span style="color: #339933;">,</span><span style="color: blue;">''</span><span style="color: #339933;">,</span>employees<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />          totalasset = <a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399;">as.numeric</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/gsub"><span style="color: #003399;">gsub</span></a><span style="color: #009900;">(</span><span style="color: blue;">','</span><span style="color: #339933;">,</span><span style="color: blue;">''</span><span style="color: #339933;">,</span>totalasset<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />          turnover = <a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399;">as.numeric</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/gsub"><span style="color: #003399;">gsub</span></a><span style="color: #009900;">(</span><span style="color: blue;">','</span><span style="color: #339933;">,</span><span style="color: blue;">''</span><span style="color: #339933;">,</span>turnover<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />           price = <a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399;">as.numeric</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/gsub"><span style="color: #003399;">gsub</span></a><span style="color: #009900;">(</span><span style="color: blue;">','</span><span style="color: #339933;">,</span><span style="color: blue;">''</span><span style="color: #339933;">,</span>price<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 哪个行业的上榜公司最多</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>$Sector &lt;- <a href="http://inside-r.org/r-doc/base/with"><span style="color: #003399;">with</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/reorder"><span style="color: #003399;">reorder</span></a><span style="color: #009900;">(</span>Sector<span style="color: #339933;">,</span>Sector<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399;">length</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=<a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">)</span><br />p + geom_bar<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>x=Sector<span style="color: #339933;">,</span>y=..count..<span style="color: #009900;">)</span><span style="color: #339933;">,</span>fill=<span style="color: blue;">'deepskyblue'</span><span style="color: #009900;">)</span> + coord_flip<span style="color: #009900;">(</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 哪个国家的上榜公司最多？</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>$Country &lt;- <a href="http://inside-r.org/r-doc/base/with"><span style="color: #003399;">with</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/reorder"><span style="color: #003399;">reorder</span></a><span style="color: #009900;">(</span>Country<span style="color: #339933;">,</span>Country<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399;">length</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p + geom_bar<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>x=Country<span style="color: #339933;">,</span>y=..count..<span style="color: #009900;">)</span><span style="color: #339933;">,</span>fill=<span style="color: blue;">'deepskyblue'</span><span style="color: #009900;">)</span> + coord_flip<span style="color: #009900;">(</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 哪个行业最赚钱</span><br />isna &lt;- <a href="http://inside-r.org/r-doc/base/is.na"><span style="color: #003399;">is.na</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>$employees<span style="color: #009900;">)</span> |is.na<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>$netincome<span style="color: #009900;">)</span> <br />data2 &lt;- <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">[</span>!isna<span style="color: #339933;">,</span><span style="color: #009900;">]</span><br />data2$Sector &lt;- <a href="http://inside-r.org/r-doc/base/with"><span style="color: #003399;">with</span></a><span style="color: #009900;">(</span>data2<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/reorder"><span style="color: #003399;">reorder</span></a><span style="color: #009900;">(</span>Sector<span style="color: #339933;">,</span>netincome<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/median"><span style="color: #003399;">median</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p2 &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=data2<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x=Sector<span style="color: #339933;">,</span>y=netincome<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p2 + stat_summary<span style="color: #009900;">(</span>fun.y=<a href="http://inside-r.org/r-doc/stats/median"><span style="color: #003399;">median</span></a><span style="color: #339933;">,</span>geom=<span style="color: blue;">'bar'</span><span style="color: #339933;">,</span>fill=<span style="color: blue;">'deepskyblue'</span><span style="color: #009900;">)</span> + coord_flip<span style="color: #009900;">(</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 排名变化情况</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>$X2011<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/is.na"><span style="color: #003399;">is.na</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>$X2011<span style="color: #009900;">)</span><span style="color: #009900;">]</span> &lt;- <span style="color: #cc66cc;">501</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>$change &lt;- <a href="http://inside-r.org/r-doc/base/with"><span style="color: #003399;">with</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #339933;">,</span>X2011-X2012<span style="color: #009900;">)</span><br />p + geom_histogram<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>x=change<span style="color: #339933;">,</span>y=..density..<span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />                   fill=<span style="color: blue;">'deepskyblue'</span><span style="color: #339933;">,</span>color=<span style="color: blue;">'white'</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 进步前十名</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/order"><span style="color: #003399;">order</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>$change<span style="color: #339933;">,</span>decreasing=T<span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><br /><span style="color: #666666; font-style: italic;"># 退步前十名</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/order"><span style="color: #003399;">order</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>$change<span style="color: #339933;">,</span>decreasing=F<span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 行业的进退</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>$Sector &lt;- <a href="http://inside-r.org/r-doc/base/with"><span style="color: #003399;">with</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/reorder"><span style="color: #003399;">reorder</span></a><span style="color: #009900;">(</span>Sector<span style="color: #339933;">,</span>change<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/median"><span style="color: #003399;">median</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p3 &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=<a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x=Sector<span style="color: #339933;">,</span>y=change<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p3 + stat_summary<span style="color: #009900;">(</span>fun.y=<a href="http://inside-r.org/r-doc/stats/median"><span style="color: #003399;">median</span></a><span style="color: #339933;">,</span>geom=<span style="color: blue;">'bar'</span><span style="color: #339933;">,</span>fill=<span style="color: blue;">'deepskyblue'</span><span style="color: #009900;">)</span> + coord_flip<span style="color: #009900;">(</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 国家的进退</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>$Country &lt;- <a href="http://inside-r.org/r-doc/base/with"><span style="color: #003399;">with</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/reorder"><span style="color: #003399;">reorder</span></a><span style="color: #009900;">(</span>Country<span style="color: #339933;">,</span>change<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/median"><span style="color: #003399;">median</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p4 &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=<a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x=Country<span style="color: #339933;">,</span>y=change<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p4 + stat_summary<span style="color: #009900;">(</span>fun.y=<a href="http://inside-r.org/r-doc/stats/median"><span style="color: #003399;">median</span></a><span style="color: #339933;">,</span>geom=<span style="color: blue;">'bar'</span><span style="color: #339933;">,</span>fill=<span style="color: blue;">'deepskyblue'</span><span style="color: #009900;">)</span> + coord_flip<span style="color: #009900;">(</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 各变量之间的相关性</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/corrgram">corrgram</a><span style="color: #009900;">)</span><br />data3 &lt;- <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">[</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">6</span>:<span style="color: #cc66cc;">13</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">15</span><span style="color: #009900;">)</span><span style="color: #009900;">]</span><br /><a href="http://inside-r.org/packages/cran/corrgram">corrgram</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/order"><span style="color: #003399;">order</span></a> = T<span style="color: #339933;">,</span> data3<span style="color: #339933;">,</span> lower.panel = panel.shade<span style="color: #339933;">,</span> upper.panel = panel.pie<span style="color: #009900;">)</span></span></pre></div></div><br />
