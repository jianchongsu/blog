--- 
layout: post
name: shinyr
title: "\xE7\x94\xA8Shiny\xE5\x8C\x85\xE5\xBF\xAB\xE9\x80\x9F\xE6\x90\xAD\xE5\xBB\xBA\xE5\x9F\xBA\xE4\xBA\x8ER\xE7\x9A\x84\xE4\xBA\xA4\xE4\xBA\x92\xE7\xBD\x91\xE9\xA1\xB5\xE5\xBA\x94\xE7\x94\xA8"
date: 2012-11-12 18:43:00 +08:00
categories: 
- "R\xE5\x8C\x85"
- web
permalink: /2012/11/shinyr.html
---
<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-MaoADl32YZY/UKDSWDPdRfI/AAAAAAAABQE/rfLKRt3spH0/s1600/diagram_server.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-MaoADl32YZY/UKDSWDPdRfI/AAAAAAAABQE/rfLKRt3spH0/s1600/diagram_server.png" /></a></div>RStudio是我最喜欢用的R语言IDE，其开发团队最近又推出了一个新的产品，即Shiny包。它的作用是快速搭建基于R的交互网页应用。使得那些对代码不熟悉的人士在工作中也可以应用统计模型。对于R和web的交互，之前已经有一些相关的包，例如：rApache,&nbsp;Rhttpd, Rack, Rook。不过这些工具都需要开发者不仅要熟悉R，还要熟悉网页编程语言（html,CSS,JS）。而Shiny包的特点在于不需要了解网页语言，可以用纯R来搭建。生成的网页应用是动态交互，而且是即时更新的。Shiny还提供了现成组件方便快速在网页上展示数据、图表和模型，的确是非常的炫。本例将用ggplot2包来绘制iris数据集的散点图，并将图形放到网页中。<br /><br />首先安装Shiny包：<br />options(repos=c(RStudio='http://rstudio.org/_packages', getOption('repos')))<br />install.packages('shiny')<br /><br /><br /><a name='more'></a>再写两个R代码文件：<br />一个是负责前端的ui.R，另一个是负责后端的server.R。<br /><br /><b>ui.R的代码如下：</b><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span>shiny<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br />&nbsp;<br />dataset &lt;- <a href="http://inside-r.org/r-doc/datasets/iris"><span style="color: #003399; font-weight: bold;">iris</span></a><br />&nbsp;<br />shinyUI<span style="color: #009900;">(</span>pageWithSidebar<span style="color: #009900;">(</span><br />&nbsp;<br />  headerPanel<span style="color: #009900;">(</span><span style="color: blue;">"鸢尾花的数据展示"</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />  sidebarPanel<span style="color: #009900;">(</span><br />&nbsp;<br />    selectInput<span style="color: #009900;">(</span><span style="color: blue;">'x'</span><span style="color: #339933;">,</span> <span style="color: blue;">'X'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">(</span>dataset<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />    selectInput<span style="color: #009900;">(</span><span style="color: blue;">'y'</span><span style="color: #339933;">,</span> <span style="color: blue;">'Y'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">(</span>dataset<span style="color: #009900;">)</span><span style="color: #009900;">[</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />    selectInput<span style="color: #009900;">(</span><span style="color: blue;">'color'</span><span style="color: #339933;">,</span> <span style="color: blue;">'Color'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">'None'</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">(</span>dataset<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />&nbsp;<br />    checkboxInput<span style="color: #009900;">(</span><span style="color: blue;">'smooth'</span><span style="color: #339933;">,</span> <span style="color: blue;">'Smooth'</span><span style="color: #009900;">)</span><br />    <span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />&nbsp;<br />  mainPanel<span style="color: #009900;">(</span><br />    plotOutput<span style="color: #009900;">(</span><span style="color: blue;">'plot'</span><span style="color: #009900;">)</span><br />  <span style="color: #009900;">)</span><br /><span style="color: #009900;">)</span><span style="color: #009900;">)</span></pre></div></div><br /><b>server.R的代码如下：</b><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span>shiny<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br />&nbsp;<br />shinyServer<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>input<span style="color: #339933;">,</span> output<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />&nbsp;<br />  output$plot &lt;- reactivePlot<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />&nbsp;<br />    p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>dataset<span style="color: #339933;">,</span> aes_string<span style="color: #009900;">(</span>x=input$x<span style="color: #339933;">,</span> y=input$y<span style="color: #009900;">)</span><span style="color: #009900;">)</span> + geom_point<span style="color: #009900;">(</span><span style="color: #009900;">)</span><br />&nbsp;<br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>input$color != <span style="color: blue;">'None'</span><span style="color: #009900;">)</span><br />      p &lt;- p + <br />        aes_string<span style="color: #009900;">(</span>color=input$color<span style="color: #009900;">)</span> + <br />        theme<span style="color: #009900;">(</span>legend.position=<span style="color: blue;">"top"</span><span style="color: #009900;">)</span><br />&nbsp;<br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>input$smooth<span style="color: #009900;">)</span><br />      p &lt;- p + <br />        geom_smooth<span style="color: #009900;">(</span><span style="color: #009900;">)</span> + <br />        theme<span style="color: #009900;">(</span>legend.position=<span style="color: blue;">"top"</span><span style="color: #009900;">)</span><br />&nbsp;<br />    <a href="http://inside-r.org/r-doc/base/print"><span style="color: #003399; font-weight: bold;">print</span></a><span style="color: #009900;">(</span>p<span style="color: #009900;">)</span><br />&nbsp;<br />  <span style="color: #009900;">}</span><span style="color: #339933;">,</span> height=<span style="color: #cc66cc;">400</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #009900;">}</span><span style="color: #009900;">)</span></pre></div></div><br />将这两个代码文件存放到同一个文件夹下，例如我是放在在"d:/rspace/shinyapp"。<br /><br />最后在控制台下运行：<br /><br />library(shiny)<br />runApp("d:/rspace/shinyapp")<br /><br />之后R会自动打开系统默认的浏览器，并展示出如下的界面。<br /><br /><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-ZICUnLy2W9Y/UKDRopofz0I/AAAAAAAABP8/iGSvV8vb_8E/s1600/plot.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="396" src="http://2.bp.blogspot.com/-ZICUnLy2W9Y/UKDRopofz0I/AAAAAAAABP8/iGSvV8vb_8E/s640/plot.png" width="640" /></a></div><br />Shiny包的缺点：<br />在部署分享方面，Shiny包只能在本地浏览器展示应用。如果要分享给其它人的话，需要将R代码传到网盘或打包分发，而对方也需要使用runApp命令来进行本地展示。RStudio团队正在开发Shiny服务器构架，让使用者仅需要一个浏览器和网址就可以运行网页应用。不过这将是一个收费的服务。<br /><br />更多示例和帮助信息，请参看：http://www.rstudio.com/shiny/<br /><!-----><!-----><!-----><!-----><!-----><!-----><!-----><!-----><!-----><!-----><!-----><!-----><!----->
