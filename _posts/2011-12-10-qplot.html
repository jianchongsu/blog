--- 
layout: post
name: qplot
title: "qplot\xE7\xBB\x98\xE5\x9B\xBE\xE5\x87\xBD\xE6\x95\xB0\xE5\xBF\xAB\xE9\x80\x9F\xE5\x85\xA5\xE9\x97\xA8"
date: 2011-12-10 11:45:00 +08:00
categories: 
- "\xE7\xBB\x98\xE5\x9B\xBE"
- "\xE5\x8F\xAF\xE8\xA7\x86\xE5\x8C\x96"
permalink: /2011/12/qplot.html
---
绘图是进行数据探索分析的重要方法，也是数据报告中的必备元素。但进行多元数据绘图时，R语言中的基本绘图工具往往很不给力，使用lattice包又要记一大堆命令。在你痛苦不堪的时候，需要ggplot2包来拯救你。虽然在刚开始学习这种绘图方法时会有少许难度，但跨过这道坎后你会感觉到它的简洁和力量。<br /><div><br /></div><div>对于初学者ggplot2提供了qplot函数，可以方便的绘制多种图形，下面来看看它是如何作的。首先加载ggplot2包，然后读取diamonds数据，运行?diamonds可以得到关于数据的更多信息。由于该数据集非常大，所以为了举例方便从中抽取了500个样本。<br /><a name='more'></a></div><div>----------------------</div><div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">library(ggplot2)</span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">data(diamonds)</span></div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">dsmall=diamonds[sample(nrow(diamonds),500),]</span></div></div><div>----------------------</div><div><b><span class="Apple-style-span" style="font-size: large;">1 直方图</span></b></div><div>直方图是描述一维数值数据的分布，下述函数中的price是钻石价格变量，data表示了数据集的名字，geom表示绘图的几何对象，此处为histogram即直方图，用colour表示描边颜色，fill表示填充颜色，此外你还可以用binwidth指定划分宽度。</div><div>----------------------</div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">qplot(price,data=diamonds,geom=c('histogram'),colour = I("darkgreen"), fill = I("white"))</span></div><div>----------------------</div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-XXfq0h0LUEM/TuLZOfjsrCI/AAAAAAAAAlM/TUD_9WUGL0k/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-XXfq0h0LUEM/TuLZOfjsrCI/AAAAAAAAAlM/TUD_9WUGL0k/s1600/Rplot01.jpeg" /></a></div><div><br /></div><div><b><span class="Apple-style-span" style="font-size: large;">2 条形图</span></b></div><div>条形图是针对一维分类数据进行汇总计数，下面我们指定的分类变量为钻石的切工水准即cut变量。绘图函数仍是qplot，但geom参数设为bar</div><div>----------------------</div><div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">qplot(cut,data=diamonds,geom='bar',fill=cut)</span></div><div>----------------------</div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-eS7AFAY9v1o/TuLhJeonQMI/AAAAAAAAAl0/yATonheWt00/s1600/Rplot04.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-eS7AFAY9v1o/TuLhJeonQMI/AAAAAAAAAl0/yATonheWt00/s1600/Rplot04.jpeg" /></a></div><div><br /></div></div><div><b><span class="Apple-style-span" style="font-size: large;">3 箱线图</span></b></div><div>箱线图是根据分类变量将数值数据进行分组，下面我们想知道，不同的切工对于钻石价格有何影响，但为了同时考虑钻石重量，所以用price/carat做为变量，geom参数设为boxplot，然后加上jitter显示散点，alpha设置透明度。</div><div>----------------------</div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">qplot(cut,price/carat,data=dsmall,geom=c('jitter','boxplot'),alpha=I(0.5),colour=cut)</span></div><div>----------------------</div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-4iyRAnk-h4s/TuLbpnAmlMI/AAAAAAAAAlc/is-uGSPPYVo/s1600/Rplot02.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-4iyRAnk-h4s/TuLbpnAmlMI/AAAAAAAAAlc/is-uGSPPYVo/s1600/Rplot02.jpeg" /></a></div><div><br /></div><div><b><span class="Apple-style-span" style="font-size: large;">4 散点图</span></b></div><div>散点图是描述两个数值数据间的关第，对于多元数据，通常可以用散点颜色和大小来反映不同的属性，下面对钻石的重量和价格进行绘图，其中colour参数指定不同的切工所显示点的颜色，图形横轴和纵轴均为对数坐标，相当于对两个变量都进行了变换。然后针对不同切工的数据加上了线性回归线</div><div>----------------------</div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">qplot(carat,price,data=dsmall,geom=c('point','smooth'),alpha=I(0.3),colour=cut,log='xy',method='lm',se=F)</span></div><div><div>----------------------</div><div class="separator" style="clear: both; text-align: center;"></div><div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-RuOP1wvXV5g/TuL6OgrGgCI/AAAAAAAAAl8/zbflcS6oZdA/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-RuOP1wvXV5g/TuL6OgrGgCI/AAAAAAAAAl8/zbflcS6oZdA/s1600/Rplot01.jpeg" /></a></div><br /></div><div>下图则是根据不同的切工将数据分别绘制散点图并进行loess平滑，其中facets参数指定了子图划分方法。</div><div>----------------------</div><div><span class="Apple-style-span" style="font-family: 'Courier New', Courier, monospace;">qplot(carat,price,data=diamonds,geom=c('point','smooth') &nbsp; &nbsp;,alpha=I(0.1),facets=cut~.)</span></div><div>----------------------</div><div class="separator" style="clear: both; text-align: center;"></div><div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-6HaUgMRjrH4/TuL6xBPhXYI/AAAAAAAAAmM/wqjEeJKtL5E/s1600/Rplot02.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-6HaUgMRjrH4/TuL6xBPhXYI/AAAAAAAAAmM/wqjEeJKtL5E/s1600/Rplot02.jpeg" /></a></div><br /></div><div>由此可见，简单的qplot函数就有如些强大的威力，如果想发挥出ggplot2包的全部能量，还需要掌握更多的语法。</div></div><div><br /></div><div>参数资料：</div><div>ggplot2 Elegant Graphics for Data Analysis (use R)</div>
