--- 
layout: post
name: r
title: "\xE4\xBD\xBF\xE7\x94\xA8R\xE8\xAF\xAD\xE8\xA8\x80\xE5\xA4\x84\xE7\x90\x86\xE7\xBB\x93\xE6\x9E\x84\xE6\x96\xB9\xE7\xA8\x8B\xE6\xA8\xA1\xE5\x9E\x8B"
date: 2011-07-07 19:15:00 +08:00
categories: 
- "\xE7\xBB\x93\xE6\x9E\x84\xE6\x96\xB9\xE7\xA8\x8B\xE6\xA8\xA1\xE5\x9E\x8B"
permalink: /2011/07/r.html
---
在回归问题中，我们有时候需要同时估计多个相互依赖的方程，这种就称为<b>联立方程组</b>。联立方程组在减化为一个方程后称为约简型方程。在这种情况下不能使用普通最小二乘来估计方程系数，因为有的自变量与干扰项存在相关，由此会造成估计量的有偏和不一致。这种自变量称为问题变量。<br /><br />解决这个问题的方法是采用工具变量方法，即找到一个变量，其特征是它与问题变量相关，而与干扰项无关。用工具变量法得到的自变量系数是一致的。与工具变量法等价的是两阶段最小二乘法，首先用最小二乘从模型的约简型方程中构造出所有问题变量的拟合值，之后，用上一步得出的拟合值来代替问题变量，再用最小二乘对结构方程直接进行回归，就可得到一致估计量。在R语言中为联立方程建模的工具包是systemfit。<br /><br />下面的算例来自Michael P.Murry的现代计量经济学一书下册。研究人员想对鳕鱼市场的供给与需求建立联立方程模型。供给方程形式为：<br /><a name='more'></a>PRICE = c+QTY+WINDSPD+RAINY+COLD+STORMY+MIXED+WINDSPD2<br />需求方程形式为：QTY=c+PRICE+DAY1+DAY2+DAY3+DAY4<br />其中价格和销量为内生变量，其它和天气和日期有关的为外生变量。所有的外生变量均用来作工具变量。<br /><br />#首先载入扩展包<br />library(systemfit)<br />#读入数据再建立方程<br />demand &lt;- QTY ~ PRICE+DAY1+DAY2+DAY3+DAY4<br />supply &lt;- PRICE ~ QTY+WINDSPD+RAINY+COLD+STORMY+MIXED+WINDSPD2<br />system &lt;- list(demand,supply)<br />#明确工具变量名称<br />inst &lt;- ~WINDSPD+WINDSPD2+COLD+RAINY+MIXED+STORMY+DAY1+DAY2+DAY3+DAY4<br />#利用systemfit命令来获得结果<br />result2sls &lt;- systemfit(method="2SLS",formula=system,inst=inst)<br />summary(result2sls)<br /><br />systemfit results<br />method: 2SLS<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;N &nbsp;DF &nbsp; &nbsp; SSR &nbsp;detRCov &nbsp; OLS-R2 McElroy-R2<br />system 222 208 62.2896 0.057822 0.186339 &nbsp; 0.236081<br /><br />&nbsp; &nbsp; &nbsp; N &nbsp;DF &nbsp; &nbsp; SSR &nbsp; &nbsp; &nbsp;MSE &nbsp; &nbsp; RMSE &nbsp; &nbsp; &nbsp; R2 &nbsp; Adj R2<br />eq1 111 105 49.3550 0.470047 0.685600 0.184330 0.145489<br />eq2 111 103 12.9346 0.125579 0.354371 0.193912 0.139129<br /><br />The covariance matrix of the residuals<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; eq1 &nbsp; &nbsp; &nbsp; eq2<br />eq1 0.4700473 0.0347262<br />eq2 0.0347262 0.1255787<br /><br />The correlations of the residuals<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;eq1 &nbsp; &nbsp; &nbsp;eq2<br />eq1 1.000000 0.142932<br />eq2 0.142932 1.000000<br /><br /><br />2SLS estimates for 'eq1' (equation 1)<br />Model Formula: QTY ~ PRICE + DAY1 + DAY2 + DAY3 + DAY4<br />Instruments: ~WINDSPD + WINDSPD2 + COLD + RAINY + MIXED + STORMY + DAY1 +<br />&nbsp; &nbsp; DAY2 + DAY3 + DAY4<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Estimate Std. Error &nbsp;t value &nbsp; Pr(&gt;|t|) &nbsp; <br />(Intercept) &nbsp;8.5395767 &nbsp;0.1560670 54.71736 &lt; 2.22e-16 ***<br />PRICE &nbsp; &nbsp; &nbsp; -0.9337678 &nbsp;0.3452685 -2.70447 &nbsp;0.0079832 **<br />DAY1 &nbsp; &nbsp; &nbsp; &nbsp;-0.0121607 &nbsp;0.2083902 -0.05836 &nbsp;0.9535764 &nbsp; <br />DAY2 &nbsp; &nbsp; &nbsp; &nbsp;-0.5259261 &nbsp;0.2023729 -2.59880 &nbsp;0.0106999 * <br />DAY3 &nbsp; &nbsp; &nbsp; &nbsp;-0.5626912 &nbsp;0.2070420 -2.71776 &nbsp;0.0076899 **<br />DAY4 &nbsp; &nbsp; &nbsp; &nbsp; 0.1000506 &nbsp;0.2028977 &nbsp;0.49311 &nbsp;0.6229655 &nbsp; <br />---<br />Signif. codes: &nbsp;0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1<br /><br />Residual standard error: 0.6856 on 105 degrees of freedom<br />Number of observations: 111 Degrees of Freedom: 105<br />SSR: 49.354962 MSE: 0.470047 Root MSE: 0.6856<br />Multiple R-Squared: 0.18433 Adjusted R-Squared: 0.145489<br /><br /><br />2SLS estimates for 'eq2' (equation 2)<br />Model Formula: PRICE ~ QTY + WINDSPD + RAINY + COLD + STORMY + MIXED + WINDSPD2<br />Instruments: ~WINDSPD + WINDSPD2 + COLD + RAINY + MIXED + STORMY + DAY1 +<br />&nbsp; &nbsp; DAY2 + DAY3 + DAY4<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Estimate &nbsp;Std. Error &nbsp;t value &nbsp;Pr(&gt;|t|) <br />(Intercept) -3.08018739 &nbsp;5.87202508 -0.52455 0.6010212 <br />QTY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0.05056356 &nbsp;0.12470245 &nbsp;0.40547 0.6859704 <br />WINDSPD &nbsp; &nbsp; &nbsp;1.44654086 &nbsp;4.06741515 &nbsp;0.35564 0.7228365 <br />RAINY &nbsp; &nbsp; &nbsp; -0.00366122 &nbsp;0.09328092 -0.03925 0.9687676 <br />COLD &nbsp; &nbsp; &nbsp; &nbsp; 0.04688691 &nbsp;0.07791593 &nbsp;0.60176 0.5486544 <br />STORMY &nbsp; &nbsp; &nbsp; 0.38896484 &nbsp;0.14312697 &nbsp;2.71762 0.0077155 **<br />MIXED &nbsp; &nbsp; &nbsp; &nbsp;0.21230097 &nbsp;0.09611835 &nbsp;2.20875 0.0294083 *<br />WINDSPD2 &nbsp; &nbsp;-0.22889804 &nbsp;0.70527628 -0.32455 0.7461792 <br />---<br />Signif. codes: &nbsp;0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1<br /><br />Residual standard error: 0.354371 on 103 degrees of freedom<br />Number of observations: 111 Degrees of Freedom: 103<br />SSR: 12.934605 MSE: 0.125579 Root MSE: 0.354371<br />Multiple R-Squared: 0.193912 Adjusted R-Squared: 0.139129<br /><div><br /></div>
