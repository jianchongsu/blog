--- 
layout: post
name: r5
title: "\xE7\xAC\xA8\xE5\x8A\x9E\xE6\xB3\x95\xE5\xAD\xA6R\xE7\xBC\x96\xE7\xA8\x8B\xEF\xBC\x885\xEF\xBC\x89"
date: 2012-08-25 15:29:00 +08:00
categories: 
- "\xE7\xBC\x96\xE7\xA8\x8B"
- "\xE5\x85\xA5\xE9\x97\xA8\xE6\x95\x99\xE7\xA8\x8B"
permalink: /2012/08/r5.html
---
<div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-um7kwFAd5rY/UDh-OZhC1iI/AAAAAAAABJM/ZhF0erHgr-U/s1600/images.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-um7kwFAd5rY/UDh-OZhC1iI/AAAAAAAABJM/ZhF0erHgr-U/s1600/images.jpg" /></a></div><br />随着教程推进，基本的语法都接触得差不多了。当要解决某个具体问题时，只需要考虑用什么样的算法来整合运用这些函数和表达式。今天来解决Project Euler的<a href="http://projecteuler.net/problem=5">第五个问题</a>，该问题可以用很笨的暴力搜索法子来作，但是更聪明的作法是采用<a href="http://en.wikipedia.org/wiki/Prime_factor">质因子分解</a>的思路。即任何一个合数都可以分解为质数的乘积。为了完成这个题目，还需要学习一点点矩阵，以及和sapply函数相似的另一个函数apply。 <br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><span style="color: #666666; font-style: italic;"># 预备练习</span><br />mat &lt;- <a href="http://inside-r.org/r-doc/base/matrix"><span style="color: #003399; font-weight: bold;">matrix</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">12</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/ncol"><span style="color: #003399; font-weight: bold;">ncol</span></a>=<span style="color: #cc66cc;">4</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/print"><span style="color: #003399; font-weight: bold;">print</span></a><span style="color: #009900;">(</span>mat<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">(</span>mat<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/colnames"><span style="color: #003399; font-weight: bold;">colnames</span></a><span style="color: #009900;">(</span>mat<span style="color: #009900;">)</span> &lt;- <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">'one'</span><span style="color: #339933;">,</span><span style="color: blue;">'two'</span><span style="color: #339933;">,</span><span style="color: blue;">'three'</span><span style="color: #339933;">,</span><span style="color: blue;">'four'</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>mat<span style="color: #009900;">)</span> &lt;- <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">'a'</span><span style="color: #339933;">,</span><span style="color: blue;">'b'</span><span style="color: #339933;">,</span><span style="color: blue;">'c'</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/print"><span style="color: #003399; font-weight: bold;">print</span></a><span style="color: #009900;">(</span>mat<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">(</span>mat<span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">(</span>mat<span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">(</span>mat<span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/prod"><span style="color: #003399; font-weight: bold;">prod</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">(</span>mat<span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)<a name='more'></a></span>&nbsp;<br /><span style="color: #666666; font-style: italic;"># 之前建立的判断是否为质数的函数</span><br />findprime  &lt;- <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />  <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>x %in% <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">5</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">7</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/return"><span style="color: #003399; font-weight: bold;">return</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">TRUE</span><span style="color: #009900;">)</span><br />  <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>x%%2 == <span style="color: #cc66cc;">0</span> | x==<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/return"><span style="color: #003399; font-weight: bold;">return</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">FALSE</span><span style="color: #009900;">)</span><br />  xsqrt &lt;- <a href="http://inside-r.org/r-doc/base/round"><span style="color: #003399; font-weight: bold;">round</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />  xseq &lt;- <a href="http://inside-r.org/r-doc/base/seq"><span style="color: #003399; font-weight: bold;">seq</span></a><span style="color: #009900;">(</span>from=<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span>to=xsqrt<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/by"><span style="color: #003399; font-weight: bold;">by</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><br />  <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/all"><span style="color: #003399; font-weight: bold;">all</span></a><span style="color: #009900;">(</span>x %% xseq !=<span style="color: #cc66cc;">0</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/return"><span style="color: #003399; font-weight: bold;">return</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">TRUE</span><span style="color: #009900;">)</span><br />  <span style="color: black; font-weight: bold;">else</span> <a href="http://inside-r.org/r-doc/base/return"><span style="color: #003399; font-weight: bold;">return</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">FALSE</span><span style="color: #009900;">)</span><br /><span style="color: #009900;">}</span><br />x = <span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">20</span><br />prime &lt;- x<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">(</span>x<span style="color: #339933;">,</span>findprime<span style="color: #009900;">)</span><span style="color: #009900;">]</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;">#&nbsp; 欧拉问题五，寻找最小的能被1到20所整除的数。</span></pre><pre class="r geshifilter-R" style="font-family: monospace;"><span style="color: #666666; font-style: italic;"># 建立分解质因子的函数</span><br />primefactor &lt;- <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #339933;">,</span>prime<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />  m &lt;- <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399; font-weight: bold;">length</span></a><span style="color: #009900;">(</span>prime<span style="color: #009900;">)</span><br />  fac.count &lt;- <a href="http://inside-r.org/r-doc/base/numeric"><span style="color: #003399; font-weight: bold;">numeric</span></a><span style="color: #009900;">(</span>m<span style="color: #009900;">)</span><br />  <a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399; font-weight: bold;">names</span></a><span style="color: #009900;">(</span>fac.count<span style="color: #009900;">)</span> &lt;- prime<br />  <span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span>i <span style="color: black; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span>:m<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    prime.num &lt;- prime<span style="color: #009900;">[</span>i<span style="color: #009900;">]</span><br />    <span style="color: black; font-weight: bold;">while</span> <span style="color: #009900;">(</span>x %% prime.num == <span style="color: #cc66cc;">0</span> &amp; x !=<span style="color: #cc66cc;">1</span> <span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />      fac.count<span style="color: #009900;">[</span>i<span style="color: #009900;">]</span> &lt;- fac.count<span style="color: #009900;">[</span>i<span style="color: #009900;">]</span> + <span style="color: #cc66cc;">1</span><br />      x = x / prime.num<br />    <span style="color: #009900;">}</span>  <br />  <span style="color: #009900;">}</span><br />  <a href="http://inside-r.org/r-doc/base/return"><span style="color: #003399; font-weight: bold;">return</span></a><span style="color: #009900;">(</span>fac.count<span style="color: #009900;">)</span><br /><span style="color: #009900;">}</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 上面的函数负责对一个20以下的数分解为多个质数之积</span><br /><span style="color: #666666; font-style: italic;"># 返回每个质因子对应的自乘次数</span><br />primefactor<span style="color: #009900;">(</span><span style="color: #cc66cc;">18</span><span style="color: #339933;">,</span>prime<span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;"># 对1到20每个数进行质因子分解，形成一个表格</span><br />result &lt;- <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">20</span><span style="color: #339933;">,</span>primefactor<span style="color: #339933;">,</span>prime<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 求每列的极大值</span><br />prime.power &lt;- <a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">(</span>result<span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/max"><span style="color: #003399; font-weight: bold;">max</span></a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/prod"><span style="color: #003399; font-weight: bold;">prod</span></a><span style="color: #009900;">(</span>prime^prime.power<span style="color: #009900;">)</span></pre></div></div><br />最终结果是232792560
