--- 
layout: post
name: caret_9105
title: "caret\xE5\x8C\x85\xE5\xBA\x94\xE7\x94\xA8\xE4\xB9\x8B\xE5\x9B\x9B\xEF\xBC\x9A\xE6\xA8\xA1\xE5\x9E\x8B\xE9\xA2\x84\xE6\xB5\x8B\xE4\xB8\x8E\xE6\xA3\x80\xE9\xAA\x8C"
date: 2011-09-25 13:20:00 +08:00
categories: 
- "ROC\xE5\x9B\xBE"
- "\xE6\xA8\xA1\xE5\x9E\x8B\xE6\xA3\x80\xE9\xAA\x8C"
permalink: /2011/09/caret_9105.html
---
模型建立好后，我们可以利用predict函数进行预测，例如预测检测样本的前五个<br /><blockquote>predict(gbmFit1, newdata = testx)[1:5]</blockquote>为了比较不同的模型，还可用装袋决策树建立第二个模型，命名为gbmFit2<br /><blockquote>gbmFit2= train(trainx, trainy,method = "treebag",trControl = fitControl)<br />models = list(gbmFit1, gbmFit2)</blockquote>另一种得到预测结果的方法是使用extractPrediction函数，得到的部分结果如下显示<br /><a name='more'></a><br /><blockquote>predValues = extractPrediction(models,testX = testx, testY = testy)<br />head(predValues)</blockquote><span class="Apple-style-span" style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; border-collapse: separate; font-family: Arial;"><span class="Apple-style-span" style="font-family: 'Lucida Console'; font-size: 13px; line-height: 17px; text-align: -webkit-left; white-space: pre-wrap;"></span></span><br /><pre class="GD40030CKR" style="border-bottom-style: none; border-color: initial; border-left-style: none; border-right-style: none; border-top-style: none; border-width: initial; font-family: 'Lucida Console'; font-size: 10pt !important; line-height: 1.3; outline-color: initial; outline-style: none; outline-width: initial; white-space: pre-wrap !important;" tabindex="0"><span class="Apple-style-span" style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; border-collapse: separate; font-family: Arial;"><span class="Apple-style-span" style="font-family: 'Lucida Console'; font-size: 13px; line-height: 17px; text-align: -webkit-left; white-space: pre-wrap;">     obs     pred model dataType  object<br />1 Active   Active   gbm Training Object1<br />2 Active   Active   gbm Training Object1<br />3 Active Inactive   gbm Training Object1<br />4 Active   Active   gbm Training Object1<br />5 Active   Active   gbm Training Object1&nbsp;</span></span></pre><span class="Apple-style-span" style="font-family: 'Lucida Console'; font-size: 13px; line-height: 17px; white-space: pre-wrap;">6 Active   Active   gbm Training Object1</span><br /><br />从中可提取检验样本的预测结果<br /><blockquote>testValues = subset(predValues, dataType == "Test")</blockquote>如果要得到预测概率，则使用extractProb函数<br /><blockquote>probValues = extractProb(models,testX = testx, testY = testy)<br />testProbs = subset(probValues, dataType == "Test")</blockquote>对于分类问题的效能检验，最重要的是观察预测结果的混淆矩阵<br /><blockquote>Pred1 = subset(testValues, model == "gbm")<br />Pred2 = subset(testValues, model == "treebag")<br />confusionMatrix(Pred1$pred, Pred1$obs)<br />confusionMatrix(Pred2$pred, Pred2$obs)</blockquote>结果如下，可见第一个模型在准确率要比第二个模型略好一些<br /><span class="Apple-style-span" style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; border-collapse: separate; font-family: Arial;"><span class="Apple-style-span" style="font-family: 'Lucida Console'; font-size: 13px; line-height: 17px; text-align: -webkit-left; white-space: pre-wrap;"></span></span><br /><pre class="GD40030CKR" style="border-bottom-style: none; border-color: initial; border-left-style: none; border-right-style: none; border-top-style: none; border-width: initial; font-family: 'Lucida Console'; font-size: 10pt !important; line-height: 1.3; outline-color: initial; outline-style: none; outline-width: initial; white-space: pre-wrap !important;" tabindex="0">          Reference<br />Prediction Active Inactive<br />  Active       65       12<br />  Inactive      9       45<br />                                      <br />               Accuracy : 0.8397          </pre><span class="Apple-style-span" style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; border-collapse: separate; font-family: Arial;"><span class="Apple-style-span" style="font-family: 'Lucida Console'; font-size: 13px; line-height: 17px; text-align: -webkit-left; white-space: pre-wrap;"></span></span><br /><pre class="GD40030CKR" style="border-bottom-style: none; border-color: initial; border-left-style: none; border-right-style: none; border-top-style: none; border-width: initial; font-family: 'Lucida Console'; font-size: 10pt !important; line-height: 1.3; outline-color: initial; outline-style: none; outline-width: initial; white-space: pre-wrap !important;" tabindex="0"></pre><span class="Apple-style-span" style="font-family: 'Lucida Console'; font-size: 13px; line-height: 17px; white-space: pre-wrap;">          Reference</span><br /><pre class="GD40030CKR" style="border-bottom-style: none; border-color: initial; border-left-style: none; border-right-style: none; border-top-style: none; border-width: initial; font-family: 'Lucida Console'; font-size: 10pt !important; line-height: 1.3; outline-color: initial; outline-style: none; outline-width: initial; white-space: pre-wrap !important;" tabindex="0"><span class="Apple-style-span" style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; border-collapse: separate; font-family: Arial;"><span class="Apple-style-span" style="font-family: 'Lucida Console'; font-size: 13px; line-height: 17px; text-align: -webkit-left; white-space: pre-wrap;">Prediction Active Inactive<br />  Active       63       12<br />  Inactive     11       45<br />                                          <br />               Accuracy : 0.8244          </span></span></pre><span class="Apple-style-span" style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; border-collapse: separate; font-family: Arial;"><span class="Apple-style-span" style="font-family: 'Lucida Console'; font-size: 13px; line-height: 17px; text-align: -webkit-left; white-space: pre-wrap;"></span></span><br />最后是利用ROCR包来绘制ROC图<br /><blockquote>prob1 = subset(testProbs, model == "gbm")<br />prob2 = subset(testProbs, model == "treebag")<br />library(ROCR)<br />prob1$lable=ifelse(prob1$obs=='Active',yes=1,0)<br />pred1 = prediction(prob1$Active,prob1$lable)<br />perf1 = performance(pred1, measure="tpr", x.measure="fpr" )<br />plot( perf1 )</blockquote><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-BFXOIDr8rF4/Tn65wzNcLHI/AAAAAAAAAcI/mJcfjeC_9qM/s1600/Rplot03.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://2.bp.blogspot.com/-BFXOIDr8rF4/Tn65wzNcLHI/AAAAAAAAAcI/mJcfjeC_9qM/s400/Rplot03.jpeg" width="400" /></a></div><br /><div><br /></div>
