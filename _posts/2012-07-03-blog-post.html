--- 
layout: post
name: blog-post
title: "\xE6\x9C\xB4\xE7\xB4\xA0\xE8\xB4\x9D\xE5\x8F\xB6\xE6\x96\xAF\xE5\x88\x86\xE7\xB1\xBB\xE4\xB8\x8E\xE8\xB4\x9D\xE5\x8F\xB6\xE6\x96\xAF\xE7\xBD\x91\xE7\xBB\x9C"
date: 2012-07-03 18:49:00 +08:00
categories: 
- "\xE8\xB4\x9D\xE5\x8F\xB6\xE6\x96\xAF\xE6\x96\xB9\xE6\xB3\x95"
- "\xE6\x95\xB0\xE6\x8D\xAE\xE6\x8C\x96\xE6\x8E\x98"
permalink: /2012/07/blog-post.html
---
<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-V0KviiLs-uI/T_LJfzJzOmI/AAAAAAAABAo/M2TQ6LQFfqE/s1600/Bayes.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="200" src="http://3.bp.blogspot.com/-V0KviiLs-uI/T_LJfzJzOmI/AAAAAAAABAo/M2TQ6LQFfqE/s200/Bayes.jpg" width="171" /></a></div><span style="background-color: white;"><b>朴素贝叶斯分类（Naive Bayes Classifier）</b>是一种简单而容易理解的分类方法，看起来很Naive，但用起来却很有效。其原理就是贝叶斯定理，从数据中得到新的信息，然后对先验概率进行更新，从而得到后验概率。好比说我们判断一个人的品质好坏，对于陌生人我们对他的判断是五五开，如果说他做了一件好事，那么这个新的信息使我们判断他是好人的概率增加了。朴素贝叶斯分类的优势在于不怕噪声和无关变量，其Naive之处在于它假设各特征属性是无关的。而<b>贝叶斯网络（Bayesian Network）</b>则放宽了变量无关的假设，将贝叶斯原理和图论相结合，建立起一种基于概率推理的数学模型,对于解决复杂的不确定性和关联性问题有很强的优势。下面我们用mlbench包中的一个数据集来看看如何用这两种方法进行学习训练。</span><br /><br />PimaIndiansDiabetes2是美国一个疾病研究机构所拥有的一个数据集，其中包括了9个变量，共有768个样本。响应变量即是对糖尿病的判断，它是一个二元变量。其它各解释变量是个体的若干特征，如年龄和其它医学指标，均为数值变量。其中有一些缺失值的存在，虽然朴素贝叶斯分类对于缺失值并不敏感，我们还是先将其进行插补，再进行建模以观察准确率。R语言中的<b>e1071包</b>中就有可以实施朴素贝叶斯分类的函数，但在本例我们使用<b>klaR包</b>中的NaiveBayes函数，因为该函数较之前者增加了两个功能，一个是可以输入先验概率，另一个是在正态分布基础上增加了核平滑密度函数。为了避免过度拟合，在训练时还要将数据分割进行多重检验，所以我们还使用了caret包的一些函数进行配合。<br /><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;"># 加载扩展包和数据</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/caret">caret</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">(</span>PimaIndiansDiabetes2<span style="color: #339933;">,</span>package=<span style="color: blue;">'mlbench'</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 对缺失值使用装袋方法进行插补</span><br />preproc &lt;- preProcess<span style="color: #009900;">(</span>PimaIndiansDiabetes2<span style="color: #009900;">[</span>-<span style="color: #cc66cc;">9</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span>method=<span style="color: blue;">"bagImpute"</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a> &lt;- <a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399;">predict</span></a><span style="color: #009900;">(</span>preproc<span style="color: #339933;">,</span>PimaIndiansDiabetes2<span style="color: #009900;">[</span>-<span style="color: #cc66cc;">9</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>$Class &lt;- PimaIndiansDiabetes2<span style="color: #009900;">[</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">9</span><span style="color: #009900;">]</span><br /><span style="color: #666666; font-style: italic;"># 使用朴素贝叶斯建模，这里使用了三次10折交叉检验得到30个结果</span><br />fitControl &lt;- trainControl<span style="color: #009900;">(</span>method = <span style="color: blue;">"repeatedcv"</span><span style="color: #339933;">,</span> number = <span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span> repeats = <span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span>returnResamp = <span style="color: blue;">"all"</span><span style="color: #009900;">)</span><br />model1 &lt;- train<span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/class">Class</a>~.<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=<a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #339933;">,</span>method=<span style="color: blue;">'nb'</span><span style="color: #339933;">,</span>trControl = fitControl<span style="color: #339933;">,</span>tuneGrid = <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399;">data.frame</span></a><span style="color: #009900;">(</span>.fL=<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span>.usekernel=F<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 观察30次检验结果，发现准确率在0.75左右</span><br />resampleHist<span style="color: #009900;">(</span>model1<span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 返回训练数据的混淆矩阵</span><br />pre &lt;- <a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399;">predict</span></a><span style="color: #009900;">(</span>model1<span style="color: #009900;">)</span><br />confusionMatrix<span style="color: #009900;">(</span>pre<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>$Class<span style="color: #009900;">)</span><br /></span></pre></div></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-zlJ0kkMsBJE/T_LL77KXhhI/AAAAAAAABA0/ZF0W_OIwnUY/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-zlJ0kkMsBJE/T_LL77KXhhI/AAAAAAAABA0/ZF0W_OIwnUY/s1600/Rplot01.jpeg" /></a></div><span style="background-color: white;"></span><br /><a name='more'></a>贝叶斯网络的建立可以根据主观知识或是客观数据。建模分为两个步骤，第一个步骤是结构学习，也就是创建网络拓扑结构。第二个步骤是参数学习，即估计出各节点的条件概率表。训练完成之后就可以利用贝叶斯网络来进行推断和预测。R语言中可以使用<b style="background-color: white;">bnlearn包</b><span style="background-color: white;">来完成上述这些工作。但要注意的是，bnlearn包不能处理混合数据，所以先将连续数据进行离散化，再进行建模训练。</span><br /><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;"># 加载包</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/bnlearn">bnlearn</a><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 数据离散化</span><br />data2 &lt;- discretize<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">[</span>-<span style="color: #cc66cc;">9</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span>method=<span style="color: blue;">'quantile'</span><span style="color: #009900;">)</span><br />data2$class &lt;- <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">[</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">9</span><span style="color: #009900;">]</span><br /><span style="color: #666666; font-style: italic;"># 使用爬山算法进行结构学习</span><br />bayesnet &lt;- hc<span style="color: #009900;">(</span>data2<span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 显示网络图</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399;">plot</span></a><span style="color: #009900;">(</span>bayesnet<span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 修改网络图中的箭头指向</span><br />bayesnet&lt;- set.arc<span style="color: #009900;">(</span>bayesnet<span style="color: #339933;">,</span><span style="color: blue;">'age'</span><span style="color: #339933;">,</span><span style="color: blue;">'pregnant'</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 参数学习</span><br /><a href="http://inside-r.org/r-doc/stats/fitted"><span style="color: #003399;">fitted</span></a> &lt;- bn.fit<span style="color: #009900;">(</span>bayesnet<span style="color: #339933;">,</span> data2<span style="color: #339933;">,</span>method=<span style="color: blue;">'mle'</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 训练样本预测并提取混淆矩阵</span><br />pre &lt;- <a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399;">predict</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/fitted"><span style="color: #003399;">fitted</span></a><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=data2<span style="color: #339933;">,</span>node=<span style="color: blue;">'class'</span><span style="color: #009900;">)</span><br />confusionMatrix<span style="color: #009900;">(</span>pre<span style="color: #339933;">,</span>data2$class<span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 进行条件推理</span><br />cpquery<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/fitted"><span style="color: #003399;">fitted</span></a><span style="color: #339933;">,</span><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/class"><span style="color: #003399;">class</span></a>==<span style="color: blue;">'pos'</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: #009900;">(</span>age==<span style="color: blue;">'(36,81]'</span>&amp;mass==<span style="color: blue;">'(34.8,67.1]'</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span></span></pre><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-FSuxy8rqYeA/T_LMKP6tbVI/AAAAAAAABA8/U0_MZL5M7fs/s1600/Rplot.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-FSuxy8rqYeA/T_LMKP6tbVI/AAAAAAAABA8/U0_MZL5M7fs/s1600/Rplot.jpeg" /></a></div>从最后的预测精度来看，两种学习方法的效果差不多，但贝叶斯网络的优势在于：<br /><br /><ul><li><span style="background-color: white;">对缺失数据不敏感</span></li><li><span style="background-color: white;">可以学习因果关系，加深对数据的理解</span></li><li><span style="background-color: white;">能将先验知识融入建模</span></li><li><span style="background-color: white;">避免了过度拟合问题，不需要保留数据进行检验</span></li></ul><br /><span style="background-color: white;">参考资料：</span><br /><a href="http://mindhacks.cn/2008/09/21/the-magical-bayesian-method/">http://mindhacks.cn/2008/09/21/the-magical-bayesian-method/</a><br /><a href="http://www.cnblogs.com/leoo2sk/archive/2010/09/17/naive-bayesian-classifier.html">http://www.cnblogs.com/leoo2sk/archive/2010/09/17/naive-bayesian-classifier.html</a><br /><a href="http://www.cnblogs.com/leoo2sk/archive/2010/09/18/bayes-network.html">http://www.cnblogs.com/leoo2sk/archive/2010/09/18/bayes-network.html</a><br /><a href="http://baike.baidu.com/view/943316.htm">http://baike.baidu.com/view/943316.htm</a><br /><a href="http://www.autonlab.org/tutorials/bayesnet09.pdf">http://www.autonlab.org/tutorials/bayesnet09.pdf</a><br /><span style="background-color: white;"><a href="http://arxiv.org/pdf/0908.3817v2.pdf">http://arxiv.org/pdf/0908.3817v2.pdf</a></span><br /><a href="http://research.microsoft.com/apps/pubs/default.aspx?id=69588">http://research.microsoft.com/apps/pubs/default.aspx?id=69588</a><br /><a href="http://www.jstatsoft.org/v35/i03/paper">http://www.jstatsoft.org/v35/i03/paper</a>
