--- 
layout: post
name: r
title: "\xE5\xB1\x82\xE6\xAC\xA1\xE5\x88\x86\xE6\x9E\x90\xE6\xB3\x95\xE5\x9C\xA8R\xE8\xAF\xAD\xE8\xA8\x80\xE4\xB8\xAD\xE7\x9A\x84\xE5\xAE\x9E\xE7\x8E\xB0"
date: 2011-04-14 18:40:00 +08:00
categories: 
- "\xE5\xB1\x82\xE6\xAC\xA1\xE5\x88\x86\xE6\x9E\x90\xE6\xB3\x95"
permalink: /2011/04/r.html
---
<div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;"></span></div><div class="MsoNormal"><span style="font-family: 宋体;"><b>层次分析法</b>（The analytic hierarchy process）简称AHP，在20世纪70年代中期由美国运筹学家托马斯·塞蒂（T.L.Saaty）正式提出。它是一种定性和定量相结合的、系统化、层次化的分析方法。由于它在处理复杂的决策问题上的实用性和有效性，很快在世界范围得到重视。它的应用已遍及经济计划和管理、能源政策和分配、行为科学、军事指挥、运输、农业、教育、人才、医疗和环境等领域。</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;"><br /></span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">层次分析法的基本思路与人对一个复杂的决策问题的思维、判断过程大体上是一样的。不妨用假期旅游为例：假如有3个旅游胜地A、B、C供你选择，你会根据诸如景色、费用和居住、饮食、旅途条件等一些准则去反复比较这3个候选地点．首先，你会确定这些准则在你的心目中各占多大比重，如果你经济宽绰、醉心旅游，自然分别看重景色条件，而平素俭朴或手头拮据的人则会优先考虑费用，中老年旅游者还会对居住、饮食等条件寄以较大关注。其次，你会就每一个准则将3个地点进行对比，譬如A景色最好，B次之；B费用最低，C次之；C居住等条件较好等等。最后，你要将这两个层次的比较判断进行综合，在A、B、C中确定哪个作为最佳地点。</span><br /><a name='more'></a></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;"><br /></span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">层次分析法的基本步骤</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">　　1、建立层次结构模型。在深入分析实际问题的基础上，将有关的各个因素按照不同属性自上而下地分解成若干层次，同一层的诸因素从属于上一层的因素或对上层因素有影响，同时又支配下一层的因素或受到下层因素的作用。最上层为目标层，通常只有1个因素，最下层通常为方案或对象层，中间可以有一个或几个层次，通常为准则或指标层。当准则过多时(譬如多于9个)应进一步分解出子准则层。</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;"><br /></span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">　　2、构造成对比较阵。从层次结构模型的第2层开始，对于从属于(或影响)上一层每个因素的同一层诸因素，用成对比较法和1—9比较尺度构造成对比较阵，直到最下层。</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;"><br /></span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">　　3、计算权向量并做一致性检验。对于每一个成对比较阵计算最大特征根及对应特征向量，利用一致性指标、随机一致性指标和一致性比率做一致性检验。若检验通过，特征向量(归一化后)即为权向量：若不通过，需重新构造成对比较阵。</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;"><br /></span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">　　4、计算组合权向量并做组合一致性检验。计算最下层对目标的组合权向量，并根据公式做组合一致性检验，若检验通过，则可按照组合权向量表示的结果进行决策，否则需要重新考虑模型或重新构造那些一致性比率较大的成对比较阵。</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;"><br /></span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">其中关键的部分是从成对比较阵中算出权向量并做一致性检验。其R代码如下：</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;"><br /></span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">代码1：计算权重向量的函数weight</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;"><br /></span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">function (B)&nbsp;</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">{</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp;A = matrix(B, nrow = sqrt(length(B)), ncol = sqrt(length(B)),&nbsp;</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;byrow = TRUE)</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp;n = ncol(A)</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp;mul_collect = c(1:n)</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp;for (i in 1:n) mul_collect[i] = prod(A[i, ])</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp;weight = mul_collect^(1/n)</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp;weight_one = weight/sum(weight)</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp;round(weight_one, 4)</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">}</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;"><br /></span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">代码2：计算一致性检验的函数CI_CR</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;"><br /></span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">function (B)&nbsp;</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">{</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp;RI = c(0, 0, 0.58, 0.9, 1.12, 1.24, 1.32, 1.41, 1.45, 1.49,&nbsp;</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;1.51)</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp;Wi = weight(B)</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp;n = length(Wi)</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp;if (n &gt; 2) {</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;W = matrix(Wi, ncol = 1)</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;A = matrix(B, nrow = sqrt(length(B)), ncol = sqrt(length(B)),&nbsp;</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;byrow = TRUE)</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;AW = A %*% W</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;aw = as.vector(AW)</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;la_max = sum(aw/Wi)/n</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;CI = (la_max - n)/(n - 1)</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;CR = CI/RI[n]</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;cat("\n CI=", round(CI, 4), "\n")</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;cat("\n CR=", round(CR, 4), "\n")</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;cat("\n la_max=", round(la_max, 4), "\n\n")</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;if (CR &lt;= 0.1) {</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cat(" 通过一致性检验！\n")</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cat("\n Wi: ", round(Wi, 4), "\n")</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;}</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;else {</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cat(" 请调整判断矩阵！\n")</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Wi = null</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;break</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;}</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp;}</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp;else if (n &lt;= 2) {</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;return(Wi)</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">&nbsp;&nbsp; &nbsp;}</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">}</span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;"><br /></span></div><div class="MsoNormal"><span class="Apple-style-span" style="font-family: 宋体;">注：本代码由《多元统计分析及R语言建模》作者王斌会老师编写</span></div><div><span class="Apple-style-span" style="font-family: 宋体;"><br /></span></div>
