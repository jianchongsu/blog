--- 
layout: post
name: r_05
title: "\xE7\x94\xA8R\xE8\xAF\xAD\xE8\xA8\x80\xE8\xAE\xA1\xE7\xAE\x97\xE5\xBE\xAE\xE7\xA7\xAF\xE5\x88\x86"
date: 2012-02-05 16:10:00 +08:00
categories: 
- "\xE5\xBE\xAE\xE7\xA7\xAF\xE5\x88\x86"
permalink: /2012/02/r_05.html
---
R语言是一个优秀的统计计算环境，但它能计算微积分吗？回答是：这个可以有。虽然在这方面R比不上Mathmatica或是Matlab，不太复杂的问题仍然能解决。以下图为例，我们希望计算两个简单问题，一个是sin函数在x=4处的导数。另一个问题是计算sin(x)在0到pi之间的曲线下面积。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-iKTaybg2qo0/Ty43iW9aDLI/AAAAAAAAAsQ/4jaRB_RUC0Y/s1600/Rplot.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-iKTaybg2qo0/Ty43iW9aDLI/AAAAAAAAAsQ/4jaRB_RUC0Y/s1600/Rplot.jpeg" /></a></div><br /><a name='more'></a>第一个问题用D运算子得到符号运算结果，然后代入数值即可得到最后结果<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;">dx &lt;- <a href="http://inside-r.org/r-doc/stats/D"><span style="color: #003399;">D</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/expression"><span style="color: #003399;">expression</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/sin"><span style="color: #003399;">sin</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: blue;">'x'</span><span style="color: #009900;">)</span><br />x &lt;- <span style="color: #cc66cc;">4</span><br />slope &lt;- <a href="http://inside-r.org/r-doc/base/eval"><span style="color: #003399;">eval</span></a><span style="color: #009900;">(</span>dx<span style="color: #009900;">)</span><br /><br /></span>第二个问题可以用integrate函数直接求出数值积分</pre><pre class="r geshifilter-R"><a href="http://inside-r.org/r-doc/stats/integrate" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">integrate</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><a href="http://inside-r.org/r-doc/base/function" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">function</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">x</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="font-family: 'Courier New', Courier, monospace;"> </span><a href="http://inside-r.org/r-doc/base/sin" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">sin</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">x</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="color: #339933; font-family: 'Courier New', Courier, monospace;">,</span><span style="color: #cc66cc; font-family: 'Courier New', Courier, monospace;">0</span><span style="color: #339933; font-family: 'Courier New', Courier, monospace;">,</span><span style="color: black; font-family: 'Courier New', Courier, monospace;">pi</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span></pre></div></div>数值积分的另一种算法是蒙特卡罗仿真，得到的结果相当接近<br /><span style="font-family: 'Courier New', Courier, monospace;">x </span><span style="font-family: 'Courier New', Courier, monospace;">&lt;-</span><span style="font-family: 'Courier New', Courier, monospace;"> </span><a href="http://inside-r.org/r-doc/stats/runif" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">runif</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="color: #cc66cc; font-family: 'Courier New', Courier, monospace;">100000</span><span style="color: #339933; font-family: 'Courier New', Courier, monospace;">,</span><a href="http://inside-r.org/r-doc/base/min" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">min</span></a><span style="font-family: 'Courier New', Courier, monospace;">=</span><span style="color: #cc66cc; font-family: 'Courier New', Courier, monospace;">0</span><span style="color: #339933; font-family: 'Courier New', Courier, monospace;">,</span><a href="http://inside-r.org/r-doc/base/max" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">max</span></a><span style="font-family: 'Courier New', Courier, monospace;">=</span><span style="color: black; font-family: 'Courier New', Courier, monospace;">pi</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><br /><span style="font-family: 'Courier New', Courier, monospace;">y &lt;- </span><a href="http://inside-r.org/r-doc/stats/runif" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">runif</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="color: #cc66cc; font-family: 'Courier New', Courier, monospace;">100000</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><br /><span style="color: black; font-family: 'Courier New', Courier, monospace;">pi</span><span style="font-family: 'Courier New', Courier, monospace;">*</span><a href="http://inside-r.org/r-doc/base/sum" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">sum</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">y&lt;sin</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">x</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="font-family: 'Courier New', Courier, monospace;">/</span><span style="color: #cc66cc; font-family: 'Courier New', Courier, monospace;">100000</span><br />上面的图形是用ggplot2扩展包绘制的，用到的代码如下：<br /><a href="http://inside-r.org/r-doc/base/library" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">library</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><a href="http://inside-r.org/packages/cran/ggplot2" style="font-family: 'Courier New', Courier, monospace;">ggplot2</a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;">intercept &lt;- <a href="http://inside-r.org/r-doc/base/sin"><span style="color: #003399;">sin</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">)</span>-slope*<span style="color: #cc66cc;">4</span><br />x &lt;- <a href="http://inside-r.org/r-doc/base/seq"><span style="color: #003399;">seq</span></a><span style="color: #009900;">(</span>from=<span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>to=<span style="color: #cc66cc;">2</span>*<span style="color: black;">pi</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/by"><span style="color: #003399;">by</span></a>=<span style="color: #cc66cc;">0.01</span><span style="color: #009900;">)</span><br />y &lt;- <a href="http://inside-r.org/r-doc/base/sin"><span style="color: #003399;">sin</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><br />p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399;">data.frame</span></a><span style="color: #009900;">(</span>x<span style="color: #339933;">,</span>y<span style="color: #009900;">)</span><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x<span style="color: #339933;">,</span>y<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p + geom_area<span style="color: #009900;">(</span>fill=alpha<span style="color: #009900;">(</span><span style="color: blue;">'blue'</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0.3</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />    geom_abline<span style="color: #009900;">(</span>intercept=intercept<span style="color: #339933;">,</span>slope=slope<span style="color: #339933;">,</span>linetype=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span>+<br />    scale_x_continuous<span style="color: #009900;">(</span>breaks=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: black;">pi</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span>*<span style="color: black;">pi</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/labels"><span style="color: #003399;">labels</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">'0'</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/expression"><span style="color: #003399;">expression</span></a><span style="color: #009900;">(</span><span style="color: black;">pi</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/expression"><span style="color: #003399;">expression</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">2</span>*<span style="color: black;">pi</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />    geom_text<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/parse"><span style="color: #003399;">parse</span></a>=T<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x=pi/<span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span>y=<span style="color: #cc66cc;">0.3</span><span style="color: #339933;">,</span>label=<span style="color: blue;">'integral(sin(x)*dx, 0, pi)'</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />    geom_line<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+<br />    geom_point<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>x=<span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span>y=<a href="http://inside-r.org/r-doc/base/sin"><span style="color: #003399;">sin</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">5</span><span style="color: #339933;">,</span>colour=alpha<span style="color: #009900;">(</span><span style="color: blue;">'red'</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0.5</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span></span></pre>
