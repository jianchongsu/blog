--- 
layout: post
name: r_27
title: "\xE5\xA6\x82\xE4\xBD\x95\xE7\x94\xA8R\xE6\x9D\xA5\xE5\xA4\x84\xE7\x90\x86\xE5\x9B\xBE\xE7\x89\x87"
date: 2012-06-27 11:56:00 +08:00
categories: 
- "\xE5\x9B\xBE\xE7\x89\x87\xE5\xA4\x84\xE7\x90\x86"
permalink: /2012/06/r_27.html
---
<br /><span style="background-color: white;">做为“会电脑”的人，除了“友情”帮别人装系统杀杀毒之外，时常会承担一些图片处理的活。也就是对一些照片施加缩放、旋转、裁剪之类的事情。这类小事自然无需动用photoshop这种庞然大物了。在R语言中就有一个很好玩的<b>biOps包，</b>它可以很方便的进行各类图片处理操作。而且用程序来处理图片有一个天然的优势，就是很容易进行批量处理和自动化处理。下面以本人的头像</span><span style="background-color: white;">机器人</span><span style="background-color: white;">瓦利来做一些简单的示范。</span><br /><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;"># 加载扩展包</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/biOps">biOps</a><span style="color: #009900;">)</span> <br /><span style="color: #666666; font-style: italic;"># 读取本地的图像文件，观察到此图像是399*399像素的rgb图片</span><br />x &lt;-  readJpeg<span style="color: #009900;">(</span><span style="color: blue;">"d:<span style="color: #000099;">\\</span>xccds.jpg"</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/print"><span style="color: #003399;">print</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 先尝试缩放操作，后面的参数是缩放的比例，可以采用四种方式进行插值，这里用的是最近邻法</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399;">plot</span></a><span style="color: #009900;">(</span>imgScale<span style="color: #009900;">(</span>x<span style="color: #339933;">,</span><span style="color: #cc66cc;">1.3</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1.3</span><span style="color: #339933;">,</span>interpolation=<span style="color: blue;">'nearestneighbor'</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#之后进行柔化降噪，此处采用的是中位数滤镜</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399;">plot</span></a><span style="color: #009900;">(</span>imgBlockMedianFilter<span style="color: #009900;">(</span>x<span style="color: #339933;">,</span><span style="color: #cc66cc;">5</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span></span></pre><br /><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-f3gtoemSJvQ/T-qBZPsJLiI/AAAAAAAAA_E/2xkXZFItBQQ/s1600/Rplot02.jpeg" imageanchor="1" style="background-color: white; clear: left; display: inline !important; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="320" src="http://3.bp.blogspot.com/-f3gtoemSJvQ/T-qBZPsJLiI/AAAAAAAAA_E/2xkXZFItBQQ/s320/Rplot02.jpeg" width="320" /></a></div><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;"><a name='more'></a># 也很方便进行图片裁剪，先设定好左上角的坐标像素，再设定好图片的宽度和高度即可</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399;">plot</span></a><span style="color: #009900;">(</span>imgCrop<span style="color: #009900;">(</span>x<span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">399</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">200</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 修改后的结果可以用writeJpeg函数存到本地磁盘中</span><br />y &lt;- imgCrop<span style="color: #009900;">(</span>x<span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">399</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">200</span><span style="color: #009900;">)</span><br />writeJpeg<span style="color: #009900;">(</span>filename=<span style="color: blue;">'d:<span style="color: #000099;">\\</span>test.jpg'</span><span style="color: #339933;">,</span>imgdata=y<span style="color: #009900;">)</span></span></pre><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-Lit7s-yRQVQ/T-qBXICH4lI/AAAAAAAAA-0/uAMVbKXlLjs/s1600/Rplot.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://1.bp.blogspot.com/-Lit7s-yRQVQ/T-qBXICH4lI/AAAAAAAAA-0/uAMVbKXlLjs/s320/Rplot.jpeg" width="320" /></a></div><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;"># 另外还有一些有用的处理函数</span><br /><span style="color: #666666; font-style: italic;"># 图像聚类以进行颜色的压缩</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399;">plot</span></a><span style="color: #009900;">(</span>imgKMeans<span style="color: #009900;">(</span>x<span style="color: #339933;">,</span><span style="color: #cc66cc;">8</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span></span></pre><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-wIKYHNsgegw/T-qBYMITihI/AAAAAAAAA-8/ztdCnBNO-BA/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://3.bp.blogspot.com/-wIKYHNsgegw/T-qBYMITihI/AAAAAAAAA-8/ztdCnBNO-BA/s320/Rplot01.jpeg" width="320" /></a></div><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;"># 翻转图像</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399;">plot</span></a><span style="color: #009900;">(</span>imgHorizontalMirroring<span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 负片效果</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399;">plot</span></a><span style="color: #009900;">(</span>imgNegative<span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 转灰度效果</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399;">plot</span></a><span style="color: #009900;">(</span>imgRGB2Grey<span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><span style="color: #009900;">)</span></span></pre><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-lNKwZCZIdAI/T-qBaIIdpWI/AAAAAAAAA_M/KyRd4lWyM_A/s1600/Rplot03.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://2.bp.blogspot.com/-lNKwZCZIdAI/T-qBaIIdpWI/AAAAAAAAA_M/KyRd4lWyM_A/s320/Rplot03.jpeg" width="320" /></a></div><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;"># 最后来个复杂点的例子，给图片的白色背景换成灰色背景</span><br /><span style="color: #666666; font-style: italic;"># rgb图像文件本质上是一个三维数组，它是由红、绿、兰三个矩阵所构成。将这三个矩阵的数值进行修改即是修改图片的颜色</span><br />y &lt;- <a href="http://inside-r.org/r-doc/base/unclass"><span style="color: #003399;">unclass</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><br />y1 &lt;- y<span style="color: #009900;">[</span><span style="color: #339933;">,,</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><br />y2 &lt;- y<span style="color: #009900;">[</span><span style="color: #339933;">,,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">]</span><br />y3 &lt;- y<span style="color: #009900;">[</span><span style="color: #339933;">,,</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">]</span><br />z &lt;- y1&gt;<span style="color: #cc66cc;">220</span>&amp;y2&gt;<span style="color: #cc66cc;">220</span>&amp;y3&gt;<span style="color: #cc66cc;">220</span> <br />y1<span style="color: #009900;">[</span>z<span style="color: #009900;">]</span> &lt;- y2<span style="color: #009900;">[</span>z<span style="color: #009900;">]</span> &lt;- y3<span style="color: #009900;">[</span>z<span style="color: #009900;">]</span>&lt;- <span style="color: #cc66cc;">77</span><br /><span style="color: #666666; font-style: italic;"># 修改后的矩阵再重新组合为图片格式</span><br />y &lt;- imagedata<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/array"><span style="color: #003399;">array</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span>y1<span style="color: #339933;">,</span>y2<span style="color: #339933;">,</span>y3<span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/dim"><span style="color: #003399;">dim</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">399</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">399</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399;">plot</span></a><span style="color: #009900;">(</span>y<span style="color: #009900;">)</span></span></pre></div></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-Is6rbbxD6Fc/T-qBbKiyHaI/AAAAAAAAA_U/YENltHs4wik/s1600/Rplot04.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://2.bp.blogspot.com/-Is6rbbxD6Fc/T-qBbKiyHaI/AAAAAAAAA_U/YENltHs4wik/s320/Rplot04.jpeg" width="320" /></a></div>
