--- 
layout: post
name: winr
title: "\xE5\xA6\x82\xE4\xBD\x95\xE5\x9C\xA8WIN\xE4\xB8\x8B\xE5\x86\x99\xE4\xB8\x80\xE4\xB8\xAA\xE7\xAE\x80\xE5\x8D\x95\xE7\x9A\x84R\xE5\x8C\x85"
date: 2012-09-19 12:04:00 +08:00
categories: 
- "R\xE5\x8C\x85"
permalink: /2012/09/winr.html
---
<div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-BVT0UKkLzjE/UFlCZS9KcSI/AAAAAAAABKk/l8dL28o1dx0/s1600/Complete-SEO-Packages.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="319" src="http://2.bp.blogspot.com/-BVT0UKkLzjE/UFlCZS9KcSI/AAAAAAAABKk/l8dL28o1dx0/s320/Complete-SEO-Packages.jpg" width="320" /></a></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: justify;">虽然玩了一段时间的R，但很惭愧的是一直没有学着自己编写一个R包。一个是觉得R本身的包已经是浩如烟海了，另一个感觉好象写包非常麻烦。在参加完北京的这次<a href="http://supstat.com/cn/2012/07/16/summer-of-supstat/">统计夏令营</a>后，看太云讲写包也不是太难。于是回来找了些资料尝试了一下，于是就形成了这篇笔记。</div><div class="separator" style="clear: both; text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: justify;">在WIN下面除了要安装好R之外，还要安装Rtools，这个在官网上可以找到。如果不写复杂的帮助文档和Vignette的话也不需要装MikTeX。此外在WIN中还要确保PATH的设置正确，这些可以在后面的参考文献中得到详细说明。在编写R包时还要知道自己的工作目录在哪，可以用getwd()函数来了解。</div><a name='more'></a><br /><div class="separator" style="clear: both; text-align: justify;">在上面准备工作都做好之后，可以开始在R中编写自定义函数了。例如在前面文章中提到的判断质数的函数。在包里面我们还可以内置一些数据。也一起读到内存中来。</div><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;">findprime  &lt;- <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>x %in% <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">5</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">7</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/return"><span style="color: #003399; font-weight: bold;">return</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">TRUE</span><span style="color: #009900;">)</span><br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span>x%%2 == <span style="color: #cc66cc;">0</span> | x==<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/return"><span style="color: #003399; font-weight: bold;">return</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">FALSE</span><span style="color: #009900;">)</span><br />    xsqrt &lt;- <a href="http://inside-r.org/r-doc/base/round"><span style="color: #003399; font-weight: bold;">round</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/sqrt"><span style="color: #003399; font-weight: bold;">sqrt</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />    xseq &lt;- <a href="http://inside-r.org/r-doc/base/seq"><span style="color: #003399; font-weight: bold;">seq</span></a><span style="color: #009900;">(</span>from=<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span>to=xsqrt<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/by"><span style="color: #003399; font-weight: bold;">by</span></a>=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><br />    <span style="color: black; font-weight: bold;">if</span> <span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/all"><span style="color: #003399; font-weight: bold;">all</span></a><span style="color: #009900;">(</span>x %% xseq !=<span style="color: #cc66cc;">0</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/return"><span style="color: #003399; font-weight: bold;">return</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">TRUE</span><span style="color: #009900;">)</span><br />    <span style="color: black; font-weight: bold;">else</span> <a href="http://inside-r.org/r-doc/base/return"><span style="color: #003399; font-weight: bold;">return</span></a><span style="color: #009900;">(</span><span style="color: black; font-weight: bold;">FALSE</span><span style="color: #009900;">)</span><br /><span style="color: #009900;">}</span><br />number &lt;- <span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">1000</span><br /><a href="http://inside-r.org/r-doc/utils/package.skeleton"><span style="color: #003399; font-weight: bold;">package.skeleton</span></a><span style="color: #009900;">(</span>name=<span style="color: blue;">"mypkg"</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">"findprime"</span><span style="color: #339933;">,</span><span style="color: blue;">"number"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span></pre></div></div>package.skeleton()是R自身提供的一个构建包的框架的函数。运行后在工作目录中就会有mypkg的子目录出现了。其中的DESCRIPTION为文本文档，是对包的整体描述。R目录中是函数代码文件，data目录中是内置的数据，man目录则是函数和数据的帮助文档。<br /><br />如果你是个很重视细节的人，可以去补充完善DESCRIPTION文件和man目录下的rd文件。因为帮助文档如同代码中的注释一样重要。如果你不拘小节也应该将各个rd文档中的title补充好。这样才能继续往下走。有时候你也可以直接将别人的包拿过来修改一下，这也是省事的法子。<br /><br />补充完整后，在命令行窗口中运行如下命令：<br />R CMD INSTALL --build mypkg<br /><br />一切顺利的话就会在工作目录下看到mypkg.zip文件了。最后就可以用R来安装这个zip文件。使用这个包只要library(mypkg)就OK了。是不是很简单。 <br /><div class="separator" style="clear: both; text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: justify;">如果你要编写的R包只有几个简单的函数，就可以使用上面的传统方法来做。但如果有几十个函数要编写维护，那么写这些函数的帮助文档就非常让人头疼。此时你就需要用到<a href="http://cos.name/tag/%E5%88%9B%E5%BB%BAr%E5%8C%85/">忍者的写包方法</a>了。</div><div class="separator" style="clear: both; text-align: justify;"><br /></div><div class="separator" style="clear: both; text-align: justify;">参考文档：</div><div class="separator" style="clear: both; text-align: justify;"><a href="http://yihui.name/cn/2007/11/steps-to-write-r-packages/">http://yihui.name/cn/2007/11/steps-to-write-r-packages/</a></div><div class="separator" style="clear: both; text-align: justify;"><a href="http://jliblog.com/archives/255">http://jliblog.com/archives/255</a></div><div class="separator" style="clear: both; text-align: justify;"><a href="http://pairach.com/2012/05/01/how-to-create-r-extensions-packages-resources/">http://pairach.com/2012/05/01/how-to-create-r-extensions-packages-resources/</a></div><div class="separator" style="clear: both; text-align: justify;"><br /></div>
