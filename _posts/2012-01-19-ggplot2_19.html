--- 
layout: post
name: ggplot2_19
title: "ggplot2\xE7\xBB\x98\xE5\x9B\xBE\xE5\x85\xA5\xE9\x97\xA8\xE7\xB3\xBB\xE5\x88\x97\xE4\xB9\x8B\xE4\xB8\x89\xEF\xBC\x9A\xE4\xBD\x8D\xE7\xBD\xAE\xE8\xB0\x83\xE6\x95\xB4\xE4\xB8\x8E\xE6\x9D\xA1\xE5\xBD\xA2\xE5\x9B\xBE"
date: 2012-01-19 09:26:00 +08:00
categories: 
- ggplot2
- "\xE7\xBB\x98\xE5\x9B\xBE"
permalink: /2012/01/ggplot2_19.html
---
位置调整（Position adjustments）是针对同一图层内元素的位置进行微调的方法。它包括五种设置，分别是stack、dodge、fill、identity、jitter。<br /><br />我们用条形图来展示其用法，仍使用mpg数据集，其中用到的变量是class，即生产汽车的类型，以及year生产年份。下面的条形图是将各类型的汽车数量进行汇集，并以年份作为分组变量。我们首先载入扩展包，然后用频数表对数据进行大致的了解，最后绘制了四种条形图。<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/with"><span style="color: #003399;">with</span></a><span style="color: #009900;">(</span>mpg<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/table"><span style="color: #003399;">table</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/class"><span style="color: #003399;">class</span></a><span style="color: #339933;">,</span>year<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=mpg<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x=<a href="http://inside-r.org/r-doc/base/class"><span style="color: #003399;">class</span></a><span style="color: #339933;">,</span>fill=<a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399;">factor</span></a><span style="color: #009900;">(</span>year<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p + geom_bar<span style="color: #009900;">(</span>position=<span style="color: blue;">'dodge'</span><span style="color: #009900;">)</span><br />p + geom_bar<span style="color: #009900;">(</span>position=<span style="color: blue;">'stack'</span><span style="color: #009900;">)</span><br />p + geom_bar<span style="color: #009900;">(</span>position=<span style="color: blue;">'fill'</span><span style="color: #009900;">)</span><br />p + geom_bar<span style="color: #009900;">(</span>position=<span style="color: blue;">'identity'</span><span style="color: #339933;">,</span>alpha=<span style="color: #cc66cc;">0.3</span><span style="color: #009900;">)</span><br /></span></pre></div></div>&nbsp;<a href="http://3.bp.blogspot.com/-FH9MzUVOKXg/Txdv9qzHrYI/AAAAAAAAAqU/u-lmOUq64KM/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" src="http://3.bp.blogspot.com/-FH9MzUVOKXg/Txdv9qzHrYI/AAAAAAAAAqU/u-lmOUq64KM/s1600/Rplot01.jpeg" /></a><br /><a name='more'></a><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-uxYworQxS2o/Txdv-S1zoLI/AAAAAAAAAqk/UX4ZoqSgmmI/s1600/Rplot03.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-uxYworQxS2o/Txdv-S1zoLI/AAAAAAAAAqk/UX4ZoqSgmmI/s1600/Rplot03.jpeg" /></a></div><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-EgwHPU6-2VY/Txdv-CrnaHI/AAAAAAAAAqc/sLjmKdMrhuw/s1600/Rplot02.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-EgwHPU6-2VY/Txdv-CrnaHI/AAAAAAAAAqc/sLjmKdMrhuw/s1600/Rplot02.jpeg" /></a></div><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-IevtbR22RyE/Txdv_PcjTzI/AAAAAAAAAqs/OhA1FCd0vPg/s1600/Rplot04.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-IevtbR22RyE/Txdv_PcjTzI/AAAAAAAAAqs/OhA1FCd0vPg/s1600/Rplot04.jpeg" /></a></div><br />可以看到dodge方式是将不同年份的数据并列放置；stack方式是将不同年份数据堆叠放置，这也是geom_bar的默认处理方式；fill方式和stack类似，但Y轴不再是计数，而是以百分比显示；identity方式是不做任何改变直接显示出来，所以需要设置透明度才能看得清楚。<br /><br />geom_bar是绘制条状几何对象，所以也可以用不经汇集的原始数据进行绘图。下面我们用2001到2010年间的美国GDP增长率举个例子。<br /><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;">y=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1.1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1.8</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2.5</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3.6</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3.1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2.7</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1.9</span><span style="color: #339933;">,</span>-<span style="color: #cc66cc;">0.1</span><span style="color: #339933;">,</span>-<span style="color: #cc66cc;">3.5</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3.0</span><span style="color: #009900;">)</span><br />x=<span style="color: #cc66cc;">2001</span>:<span style="color: #cc66cc;">2010</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399;">data.frame</span></a><span style="color: #009900;">(</span>x<span style="color: #339933;">,</span>y<span style="color: #009900;">)</span><br />p=<a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x<span style="color: #339933;">,</span>y<span style="color: #339933;">,</span>fill=y<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p+geom_bar<span style="color: #009900;">(</span>stat=<span style="color: blue;">"identity"</span><span style="color: #009900;">)</span>+ <br />    geom_abline<span style="color: #009900;">(</span>intercept = <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span> slope = <span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>size=<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span>colour=<span style="color: blue;">'gray'</span><span style="color: #009900;">)</span>+<br />    geom_text<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>label=y<span style="color: #009900;">)</span><span style="color: #339933;">,</span>hjust=<span style="color: #cc66cc;">0.5</span><span style="color: #339933;">,</span> vjust=-<span style="color: #cc66cc;">0.5</span> <span style="color: #009900;">)</span>+<br />    scale_y_continuous<span style="color: #009900;">(</span>limits=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span>-<span style="color: #cc66cc;">3.8</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">4.2</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span>+<br />    labs<span style="color: #009900;">(</span>x=<span style="color: blue;">'年份'</span><span style="color: #339933;">,</span> y=<span style="color: blue;">'GDP增长率%'</span><span style="color: #009900;">)</span>+<br />    opts<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/graphics/title"><span style="color: #003399;">title</span></a> = <span style="color: blue;">"美国GDP增长率"</span><span style="color: #009900;">)</span></span></pre><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-oxZXmqYeaOQ/Txdv9EIT35I/AAAAAAAAAqM/TUcnrGani78/s1600/Rplot.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-oxZXmqYeaOQ/Txdv9EIT35I/AAAAAAAAAqM/TUcnrGani78/s1600/Rplot.jpeg" /></a></div>
