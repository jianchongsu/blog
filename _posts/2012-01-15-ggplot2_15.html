--- 
layout: post
name: ggplot2_15
title: "ggplot2\xE7\xBB\x98\xE5\x9B\xBE\xE5\x85\xA5\xE9\x97\xA8\xE7\xB3\xBB\xE5\x88\x97\xE4\xB9\x8B\xE4\xBA\x8C\xEF\xBC\x9A\xE5\x9B\xBE\xE5\xB1\x82\xE6\x8E\xA7\xE5\x88\xB6\xE4\xB8\x8E\xE7\x9B\xB4\xE6\x96\xB9\xE5\x9B\xBE"
date: 2012-01-15 20:28:00 +08:00
categories: 
- ggplot2
- "\xE7\xBB\x98\xE5\x9B\xBE"
permalink: /2012/01/ggplot2_15.html
---
如<a href="http://xccds1977.blogspot.com/2012/01/ggplot2.html">前文</a>所述，ggplot2使用图层将各种图形元素逐步添加组合，从而形成最终结果。第一层必须是原始数据层，其中data参数控制数据来源，注意数据形式只能是数据框格式。aes参数控制了对哪些变量进行图形映射，以及映射方式，aes是Aesthetic的缩写。<br /><br />下面我们来绘制一个直方图作为示例。数据集仍采取mpg，对hwy变量绘制直方图。首先加载了扩展包，然后用ggplot函数建立了第一层，hwy数据映射到X轴上；使用+号增加了第二层，即直方图对象层。此时p被视为一种层对象，使用summary函数可得到关于它的更多信息，print(p)命令即可进行绘图。<br /><a name='more'></a><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br />p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><span style="color: #003399;"><a href="http://inside-r.org/r-doc/utils/data">data</a> </span>= mpg<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x = hwy<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p &lt;- p + geom_histogram<span style="color: #009900;">(</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399;">summary</span></a><span style="color: #009900;">(</span>p<span style="color: #009900;">)</span></span></pre><pre class="r geshifilter-R">data: manufacturer, model, displ, year, cyl, trans,<br />  drv, cty, hwy, fl, class [234x11]<br />mapping:  x = hwy<br />faceting: facet_grid(. ~ ., FALSE)<br />-----------------------------------<br />geom_histogram:<br />stat_bin:<br />position_stack: (width = NULL, height = NULL)</pre><pre class="r geshifilter-R"></pre></div></div>上面的信息告诉我们，p对象含有两层，第一层数据层描述了变量和映射方式，第二层是直方图对象（geom_histogram），geom表示几何对象，它是ggplot中重要的图层控制对象，因为它负责图形渲染的类型。geom_histogram是图形渲染类型的一种，其它类型可参见<a href="http://had.co.nz/ggplot2/">官网</a>。<br /><br />每个geom对象都需要有数据输入，数据可以从第一层中自动读取，也可以在aes参数中直接设置。而且每个geom还默认搭配某种统计变换（stat），geom_histogram的默认统计变换是stat_bin。它负责对数据进行分组计数。<br /><br />下面我们尝试两种更为复杂的直方图，首先将数据按照year这个变量划分为两组，用不同的颜色绘制直方图，而且用频率而非计数来刻画Y轴，并添加密度曲线。<br /><span style="font-family: 'Courier New', Courier, monospace;">p &lt;-&nbsp;</span><a href="http://inside-r.org/packages/cran/ggplot" style="font-family: 'Courier New', Courier, monospace;">ggplot</a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">mpg</span><span style="color: #339933; font-family: 'Courier New', Courier, monospace;">,</span><span style="font-family: 'Courier New', Courier, monospace;">aes</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">hwy</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><br /><span style="font-family: 'Courier New', Courier, monospace;">p + geom_histogram</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">position =&nbsp;</span><span style="color: blue; font-family: 'Courier New', Courier, monospace;">'identity'</span><span style="color: #339933; font-family: 'Courier New', Courier, monospace;">,</span><br /><span style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; alpha=</span><span style="color: #cc66cc; font-family: 'Courier New', Courier, monospace;">0.5</span><span style="color: #339933; font-family: 'Courier New', Courier, monospace;">,</span><br /><span style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; aes</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">y = ..density..</span><span style="color: #339933; font-family: 'Courier New', Courier, monospace;">,</span><br /><span style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; fill =&nbsp;</span><a href="http://inside-r.org/r-doc/base/factor" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">factor</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">year</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)&nbsp;</span><span style="font-family: 'Courier New', Courier, monospace;">+</span><br /><span style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; stat_density</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">geom =&nbsp;</span><span style="color: blue; font-family: 'Courier New', Courier, monospace;">'line'</span><span style="color: #339933; font-family: 'Courier New', Courier, monospace;">,</span><br /><span style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; position =&nbsp;</span><span style="color: blue; font-family: 'Courier New', Courier, monospace;">'identity'</span><span style="color: #339933; font-family: 'Courier New', Courier, monospace;">,</span><br /><span style="font-family: 'Courier New', Courier, monospace;">&nbsp; &nbsp; aes</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">colour =&nbsp;</span><a href="http://inside-r.org/r-doc/base/factor" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">factor</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">year</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-2yvGvTKEMHc/TxLEeWumZCI/AAAAAAAAAp8/hTPMTKE1Gik/s1600/Rplot.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-2yvGvTKEMHc/TxLEeWumZCI/AAAAAAAAAp8/hTPMTKE1Gik/s1600/Rplot.png" /></a></div><pre class="r geshifilter-R">如果想将两个直方图分开绘制，也可以使用facet_grid参数，结果如下图所示。<a href="http://3.bp.blogspot.com/-iqpFCmUOwiw/TxLEimJoUPI/AAAAAAAAAqE/sZjyLK0x53k/s1600/Rplot01.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" src="http://3.bp.blogspot.com/-iqpFCmUOwiw/TxLEimJoUPI/AAAAAAAAAqE/sZjyLK0x53k/s1600/Rplot01.png" /></a></pre><br />另：在win系统中用ggplot2绘制直方图，其底部有难看的缺口。但在linux系统中正常，不知原因何在，望知情人士不吝赐教。
