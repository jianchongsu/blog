--- 
layout: post
name: ggplot2
title: "ggplot2\xE7\xBB\x98\xE5\x9B\xBE\xE5\x85\xA5\xE9\x97\xA8\xE7\xB3\xBB\xE5\x88\x97\xE4\xB9\x8B\xE4\xB8\x80\xEF\xBC\x9A\xE5\xAF\xBC\xE8\xAE\xBA"
date: 2012-01-13 10:51:00 +08:00
categories: 
- ggplot2
- "\xE7\xBB\x98\xE5\x9B\xBE"
permalink: /2012/01/ggplot2.html
---
<b><span style="font-size: large;">1 什么是ggplot2</span></b><br />ggplot2是用于绘图的R语言扩展包，其理念根植于《Grammar of Graphics》一书。它将绘图视为一种映射，即从数学空间映射到图形元素空间。例如将不同的数值映射到不同的色彩或透明度。该绘图包的特点在于并不去定义具体的图形（如直方图，散点图），而是定义各种底层组件（如线条、方块）来合成复杂的图形，这使它能以非常简洁的函数构建各类图形，而且默认条件下的绘图品质就能达到出版要求。<br /><br /><b><span style="font-size: large;">2 与lattice包的比较</span></b><br />ggplot2和lattice都属于高级的格点绘图包，初学R语言的朋友可能会在二者选择上有所疑惑。从各自特点上来看，lattice入门较容易，作图速度较快，图形函数种类较多，比如它可以进行三维绘图，而ggplot2就不能。ggplot2需要一段时间的学习，但当你跨过这个门槛之后，就能体会到它的简洁和优雅，而且ggplot2可以通过底层组件构造前所未有的图形，你所受到的限制只是你的想象力。<br /><a name='more'></a><br /><br />建议两种绘图包都可以研究一下。如果时间紧张，需要在一两天之内为论文做一张图，那么推荐用lattice，如果时间充裕，推荐学习ggplot2。<br /><br /><b><span style="font-size: large;">3 基本概念</span></b><br /><br /><ul><li>图层（Layer）：如果你用过photoshop，那么对于图层一定不会陌生。一个图层好比是一张玻璃纸，包含有各种图形元素，你可以分别建立图层然后叠放在一起，组合成图形的最终效果。图层可以允许用户一步步的构建图形，方便单独对图层进行修改、增加统计量、甚至改动数据。</li><li>标度（Scale）：标度是一种函数，它控制了数学空间到图形元素空间的映射。一组连续数据可以映射到X轴坐标，也可以映射到一组连续的渐变色彩。一组分类数据可以映射成为不同的形状，也可以映射成为不同的大小。</li><li>坐标系统（Coordinate）：坐标系统控制了图形的坐标轴并影响所有图形元素，最常用的是直角坐标轴，坐标轴可以进行变换以满足不同的需要，如对数坐标。其它可选的还有极坐标轴。</li><li>位面（Facet）：很多时候需要将数据按某种方法分组，分别进行绘图。位面就是控制分组绘图的方法和排列形式。</li></ul><br /><b><span style="font-size: large;">4 一个例子</span></b><br />下面用ggplot2包内带的汽车测试数据（mpg）来举个例子，用到的三个变量分别是发动机容量(displ)、高速公路上的每加仑行驶里数(hwy)、汽缸数目(cyl)。首先加载ggplot2包，然后用ggplot定义第一层即数据来源。其中aes参数非常关键，它将displ映射到X轴，将hwy映射到Y轴，将cyl变为分类数据后映射为不同的颜色。然后使用+号添加了两个新的图层，第二层是加上了散点，第三层是加上了loess平滑曲线。<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br />p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=mpg<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x=displ<span style="color: #339933;">,</span>y=hwy<span style="color: #339933;">,</span>colour=<a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399;">factor</span></a><span style="color: #009900;">(</span>cyl<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p + geom_point<span style="color: #009900;">(</span><span style="color: #009900;">)</span> + geom_smooth<span style="color: #009900;">(</span><span style="color: #009900;">)</span></span></pre><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-wqbFkNn0g3w/Tw-ajUFkYxI/AAAAAAAAAps/uPB62uKWhBQ/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-wqbFkNn0g3w/Tw-ajUFkYxI/AAAAAAAAAps/uPB62uKWhBQ/s1600/Rplot01.jpeg" /></a></div><pre class="r geshifilter-R">上图是对几种不同汽缸的数据分别平滑，如果需要对整体数据进行平滑，可将colour参数设置在散点图层内而非第一层，这样第三层的平滑图形就不会受到colour参数的影响。</pre></div></div><span style="font-family: 'Courier New', Courier, monospace;">p &lt;- </span><a href="http://inside-r.org/packages/cran/ggplot" style="font-family: 'Courier New', Courier, monospace;">ggplot</a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">mpg</span><span style="color: #339933; font-family: 'Courier New', Courier, monospace;">,</span><span style="font-family: 'Courier New', Courier, monospace;">aes</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">x=displ</span><span style="color: #339933; font-family: 'Courier New', Courier, monospace;">,</span><span style="font-family: 'Courier New', Courier, monospace;">y=hwy</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><br /><span style="font-family: 'Courier New', Courier, monospace;">p + geom_point</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">aes</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">colour=</span><a href="http://inside-r.org/r-doc/base/factor" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">factor</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="font-family: 'Courier New', Courier, monospace;">cyl</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="font-family: 'Courier New', Courier, monospace;"> + geom_smooth</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-mEja3GuBzVE/Tw-anwWGe8I/AAAAAAAAAp0/_nUUiJ3g7o4/s1600/Rplot3.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-mEja3GuBzVE/Tw-anwWGe8I/AAAAAAAAAp0/_nUUiJ3g7o4/s1600/Rplot3.jpeg" /></a></div><pre class="r geshifilter-R">其它资源：</pre><a href="http://had.co.nz/ggplot2/">http://had.co.nz/ggplot2/</a>&nbsp;（官方主站）<br /><a href="http://xccds1977.blogspot.com/2011/12/qplot.html">http://xccds1977.blogspot.com/2011/12/qplot.html</a>&nbsp;（快速入门）<br /><a href="http://www.amazon.com/ggplot2-Elegant-Graphics-Data-Analysis/dp/0387981403/ref=sr_1_1?ie=UTF8&amp;qid=1326423004&amp;sr=8-1">ggplot2 Elegant Graphics for Data Analysis</a> （<a href="http://www.box.com/s/u88yodk6z3j623l7uzvu">下载</a>）
