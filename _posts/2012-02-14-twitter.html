--- 
layout: post
name: twitter
title: "\xE5\xA6\x82\xE4\xBD\x95\xE5\x88\x86\xE6\x9E\x90twitter\xE4\xB8\xAD\xE5\x8C\x85\xE5\x90\xAB\xE7\x9A\x84\xE6\x8A\x95\xE8\xB5\x84\xE8\x80\x85\xE6\x83\x85\xE7\xBB\xAA"
date: 2012-02-14 11:09:00 +08:00
categories: 
- twitter
permalink: /2012/02/twitter.html
---
<div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-F5aOQmX5cPo/TznOPbMFINI/AAAAAAAAAuM/IA_2ts9t4x4/s1600/111511hubpmmarkets_512x288.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><br /><img border="0" height="180" src="http://4.bp.blogspot.com/-F5aOQmX5cPo/TznOPbMFINI/AAAAAAAAAuM/IA_2ts9t4x4/s320/111511hubpmmarkets_512x288.jpg" width="320" /></a></div><b>投资者情绪(investor sentiment)</b>是反映投资者心理的重要因素，它是一种反映投资者的投资意愿或预期的市场人气指标，对证券市场的运行和发展有很大的影响。以往对投资者情绪指数的衡量主要通过两种方式，一个是通过问卷调查等方式直接测量，另一个是通过分析有关交易数据来间接测量。<br /><br />随着社会化媒体的盛行，Twitter上的推文也可以被看作是一种情绪指标。英国伦敦基金公司Derwent Capital Markets就利用Twitter上发表的推文，统计大众情绪来预测股市走势，在2011年全球市场低迷之中，还能维持1.85%报酬率，领先S&amp;P500指数。<br /><a name='more'></a><br />本例完全借助<a href="http://www.inside-r.org/howto/mining-twitter-airline-consumer-sentiment">Mining Twitter for Airing Consumer Sentiment</a>这篇文章（该文获得了最近的R商业应用大赛第二名）的代码和思想来衡量投资者对S&amp;P500的情绪。本例分析简单粗陋，并未考虑推文的时间因素，以及和股市的交互涟漪效应，Just for fun。<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;">#首先载入twitterR包，再以sp500为关键词搜索1500条推文</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/twitteR">twitteR</a><span style="color: #009900;">)</span><br />sp500 &lt;- searchTwitter<span style="color: #009900;">(</span><span style="color: blue;">'sp500'</span><span style="color: #339933;">,</span>n=<span style="color: #cc66cc;">1500</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#再加载plyr包，利用其中的向量化操作函数将所有的推文文本提取出来。</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/plyr">plyr</a><span style="color: #009900;">)</span><br />sp.text &lt;- laply<span style="color: #009900;">(</span>sp500<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399;">function</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399;">t</span></a><span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399;">t</span></a>$getText<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#从这个地址将包含正面和负面情绪词汇的文本包下载到本地 http://www.cs.uic.edu/~liub/FBS/opinion-lexicon-English.rar</span><br />pos &lt;- <a href="http://inside-r.org/r-doc/base/scan"><span style="color: #003399;">scan</span></a><span style="color: #009900;">(</span><span style="color: blue;">'d:/positive-words.txt'</span><span style="color: #339933;">,</span>what=<span style="color: blue;">'character'</span><span style="color: #339933;">,</span>comment.char=<span style="color: blue;">';'</span><span style="color: #009900;">)</span><br />neg &lt;- <a href="http://inside-r.org/r-doc/base/scan"><span style="color: #003399;">scan</span></a><span style="color: #009900;">(</span><span style="color: blue;">'d:/negative-words.txt'</span><span style="color: #339933;">,</span>what=<span style="color: blue;">'character'</span><span style="color: #339933;">,</span>comment.char=<span style="color: blue;">';'</span><span style="color: #009900;">)</span><br />pos.words &lt;- <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span>pos<span style="color: #339933;">,</span> <span style="color: blue;">'up'</span><span style="color: #339933;">,</span><span style="color: blue;">'bull'</span><span style="color: #009900;">)</span><br />neg.words &lt;- <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span>neg<span style="color: #339933;">,</span> <span style="color: blue;">'down'</span><span style="color: #339933;">,</span><span style="color: blue;">'bear'</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#最后利用score.sentiment函数将推文与情绪文本进行比对，结果存于result变量中，其中score保存着各推文出现代表不同情绪的词频数。score为正表示正面情绪，为负表示负面情绪。</span><br />result &lt;- score.sentiment<span style="color: #009900;">(</span>sp.text<span style="color: #339933;">,</span>pos.words<span style="color: #339933;">,</span>neg.words<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=result$score<br /><a href="http://inside-r.org/r-doc/base/table"><span style="color: #003399;">table</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399;">factor</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span></span></pre></div></div>-5 &nbsp;-3 &nbsp;-2 &nbsp;-1 &nbsp; 0 &nbsp; 1 &nbsp; 2 &nbsp; 3 &nbsp; 4 &nbsp; 5<br />4 &nbsp;13 &nbsp;38 113 813 120 &nbsp;34 &nbsp; 2 &nbsp; 3 &nbsp; 1<br />从上面的结果可以看到，基本上对于sp500的情绪持中性，没有太大的正面或负面情绪。当然Derwent系统则更为精密强悍，它随机追踪Twitter上10%的推文，也就是每天统计1亿则推文，然后采取两套方法整理数据：1. 比较正面评价和负面评价，2. 利用Google程序确定六种情绪，冷静、警觉、相信、活跃、友善和高兴。系统开发者Johan Bollen教授能准确预测道琼指数走势，准确率高达87.6%。<br /><br />想要利用“情绪指数”预测股市走势并不只有Derwent，彭博社和市场预测公司Wise Window也开始研究社群网站上的对话和股价的关系，不管是Twitter、Facebook、或是Blog全部都纳入研究，以“产业”为搜集信息的主题，例如搜集大家谈论“汽车”的观点，藉此预期福特或通用汽车的股市行情。WiseWindow执行长Sid Mohasseb表示，这项研究就是以“人”为主，当你能够抓住人们说：我想要这个、我不要那个的时候，就可以预期这些选择将会带来哪些公司的营收，我们做的就是加快分析。
