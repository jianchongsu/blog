--- 
layout: post
name: test_901
title: "\xE5\x88\xA9\xE7\x94\xA8googleVis\xE5\x8C\x85\xE5\xAE\x9E\xE7\x8E\xB0\xE7\x8E\xAF\xE5\xA2\x83\xE6\x95\xB0\xE6\x8D\xAE\xE5\x8F\xAF\xE8\xA7\x86\xE5\x8C\x96"
date: 2011-09-21 11:17:00 +08:00
categories: 
- "\xE5\x8F\xAF\xE8\xA7\x86\xE5\x8C\x96"
- google
permalink: /2011/09/test_901.html
---
本例的目的是按中国行政区划标注出每个省份所排放的生活废水，其结果与<a href="http://xccds1977.blogspot.com/2011/04/r_26.html">之前的一篇博文</a>类似，但利用的工具是googleVis包，此工具包将Google Visualisation API与R进行连接，直接用R中的数据生成交互的可视化图形，而不用再将数据上传到google。&nbsp; <br /><br />首先，从<a href="http://www.ipe.org.cn/">公众环境研究中心</a>得到各省的数据，然后在<a href="http://code.google.com/apis/adwords/docs/appendix/provincecodes.html#China">google网站</a>找到各省对应的地理位置编码，在excel中制成表格，然后读入到data.frame中。并载入googleVis包<br /><a name='more'></a><br /><blockquote>data=read.table('clipboard',T)&nbsp;</blockquote><blockquote>library(googleVis)&nbsp;</blockquote>数据框的部分数据如下显示：<br /><br />head(data)<br />&nbsp; &nbsp;province &nbsp;code country waste<br />1 &nbsp; &nbsp; Anhui CN-34 &nbsp; &nbsp; &nbsp;CN &nbsp;10.6<br />2 &nbsp; &nbsp;Fujian CN-35 &nbsp; &nbsp; &nbsp;CN &nbsp;10.3<br />3 &nbsp; &nbsp; Gansu CN-62 &nbsp; &nbsp; &nbsp;CN &nbsp; 3.3<br />4 Guangdong CN-44 &nbsp; &nbsp; &nbsp;CN &nbsp;49.9<br />5 &nbsp; Guangxi CN-45 &nbsp; &nbsp; &nbsp;CN &nbsp;14.4<br />6 &nbsp; Guizhou CN-52 &nbsp; &nbsp; &nbsp;CN &nbsp; 4.6<br /><br /><br />然后利用gvisGeoMap命令创建对象，其参数注意要在regioin处填写CN表示中国地区，locationvar表示地理位置，而numvar表示取值<br /><blockquote>&nbsp;G1 = gvisGeoMap(data, locationvar='code', numvar='waste','province'                  options=list(region='CN',dataMode="regions",width=600, height=300))&nbsp; </blockquote>然后即可绘制出相应图形<br /><blockquote>plot(G1) </blockquote>也可将图形对象导出成代码，然后复制到博客中显示如下<br /><blockquote>print(G1, 'chart')</blockquote><script src="http://www.google.com/jsapi" type="text/javascript"></script><script type="text/javascript">  // jsData  function gvisDataGeoMapID362d40ed () {   var data = new google.visualization.DataTable();   var datajson = [  [  "CN-34",        10.6, "Anhui"  ], [  "CN-35",        10.3, "Fujian"  ], [  "CN-62",         3.3, "Gansu"  ], [  "CN-44",        49.9, "Guangdong"  ], [  "CN-45",        14.4, "Guangxi"  ], [  "CN-52",         4.6, "Guizhou"  ], [  "CN-46",         1.4, "Hainan"  ], [  "CN-13",        13.5, "Hebei"  ], [  "CN-23",         7.6, "Heilongjiang"  ], [  "CN-41",        19.4, "Henan"  ], [  "CN-42",        17.4, "Hubei"  ], [  "CN-43",        16.4, "Hunan"  ], [  "CN-32",        26.6, "Jiangsu"  ], [  "CN-36",         8.5, "Jiangxi"  ], [  "CN-22",         7.2, "Jilin"  ], [  "CN-21",        14.2, "Liaoning"  ], [  "CN-15",         4.5, "NeiMonggol"  ], [  "CN-64",           2, "Ningxia"  ], [  "CN-63",         2.2, "Qinghai"  ], [  "CN-61",         6.2, "Shaanxi"  ], [  "CN-37",        20.4, "Shandong"  ], [  "CN-14",         6.6, "Shanxi"  ], [  "CN-51",        15.7, "Sichuan"  ], [  "CN-65",         5.3, "Xinjiang"  ], [  "CN-54",         0.3, "Xizang"  ], [  "CN-53",         5.5, "Yunnan"  ], [  "CN-33",        16.2, "Zhejiang"  ]  ]; data.addColumn('string','code'); data.addColumn('number','waste'); data.addColumn('string','province'); data.addRows(datajson); return(data); }   // jsDrawChart function drawChartGeoMapID362d40ed() {   var data = gvisDataGeoMapID362d40ed();   var options = {}; options["dataMode"] = "regions"; options["width"] =    600; options["height"] =    300; options["region"] = "CN";       var chart = new google.visualization.GeoMap(        document.getElementById('GeoMapID362d40ed')      );      chart.draw(data,options);       }      // jsDisplayChart  function displayChartGeoMapID362d40ed() {   google.load("visualization", "1", { packages:["geomap"] });    google.setOnLoadCallback(drawChartGeoMapID362d40ed); }   // jsChart  displayChartGeoMapID362d40ed()   <!-- jsFooter -->   //--></script>      <br /><div id="GeoMapID362d40ed" style="height: 400px; width: 800px;"></div>
