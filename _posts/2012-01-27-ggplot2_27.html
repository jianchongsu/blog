--- 
layout: post
name: ggplot2_27
title: "ggplot2\xE7\xBB\x98\xE5\x9B\xBE\xE5\x85\xA5\xE9\x97\xA8\xE7\xB3\xBB\xE5\x88\x97\xE4\xB9\x8B\xE5\x9B\x9B\xEF\xBC\x9A\xE5\x86\x8D\xE8\xAF\xB4\xE6\x95\xA3\xE7\x82\xB9\xE5\x9B\xBE"
date: 2012-01-27 10:58:00 +08:00
categories: 
- ggplot2
- "\xE7\xBB\x98\xE5\x9B\xBE"
permalink: /2012/01/ggplot2_27.html
---
在<a href="http://xccds1977.blogspot.com/2012/01/ggplot2.html">前文</a>中已初步介绍了散点图的绘制方法，本文介绍一些细节方面的参数设置。<br /><br /><span style="font-size: large;"><b>1 色彩和形状的控制</b></span><br />数据特征不仅可以用坐标来表示，也可以用不同的色彩或形状来表示。仍以mpg数据集为例，所用到的变量有cty（城市中行驶距离）,hwy（高速路行驶距离）,displ（排量大小）,year（生产年份）<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br />p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>mpg<span style="color: #339933;">,</span> aes<span style="color: #009900;">(</span>cty<span style="color: #339933;">,</span> hwy<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p1 &lt;- p + geom_point<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>colour = <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399;">factor</span></a><span style="color: #009900;">(</span>year<span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/packages/cran/shape">shape</a> = <a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399;">factor</span></a><span style="color: #009900;">(</span>year<span style="color: #009900;">)</span><span style="color: #339933;">,</span> size = displ<span style="color: #009900;">)</span><span style="color: #339933;">,</span> alpha = <span style="color: #cc66cc;">0.6</span><span style="color: #339933;">,</span> position = <span style="color: blue;">'jitter'</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/print"><span style="color: #003399;">print</span></a><span style="color: #009900;">(</span>p1<span style="color: #009900;">)</span><br /></span><a href="http://4.bp.blogspot.com/-KvNwvwG-yWU/TyIRDXxebyI/AAAAAAAAAq4/eIhaigTqgi0/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" src="http://4.bp.blogspot.com/-KvNwvwG-yWU/TyIRDXxebyI/AAAAAAAAAq4/eIhaigTqgi0/s1600/Rplot01.jpeg" /><a name='more'></a></a></pre></div></div>我们将1999年生产车型用红色圆形表示，2008年用兰色三角形表示，排量用图形的大小表示，并且设置了透明度和jitter以避免样本点之间的重叠。可观察到2008年生产的大排量车型较多，从而油耗较高，单位油耗行驶距离较短。<br /><br /><span style="font-size: large;"><b>2 坐标的控制</b></span><br />上图右上角数据点较为稀疏，这种情况下可用对数变换。为了演示ggplot2对图形坐标的控制，我们对X轴和Y轴均进行对数变换，然后对X轴的坐标显示加以限制，只显示X轴数据的均值，以及一倍标准差的坐标。<br /><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;">cty.mean=<a href="http://inside-r.org/r-doc/base/with"><span style="color: #003399;">with</span></a><span style="color: #009900;">(</span>mpg<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/mean"><span style="color: #003399;">mean</span></a><span style="color: #009900;">(</span>cty<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />cty.sd=<a href="http://inside-r.org/r-doc/base/with"><span style="color: #003399;">with</span></a><span style="color: #009900;">(</span>mpg<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/sd"><span style="color: #003399;">sd</span></a><span style="color: #009900;">(</span>cty<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p1 + scale_x_continuous<span style="color: #009900;">(</span>trans=<span style="color: blue;">'log'</span><span style="color: #339933;">,</span>breaks=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span>cty.mean-cty.sd<span style="color: #339933;">,</span>cty.mean<span style="color: #339933;">,</span>cty.mean+cty.sd<span style="color: #009900;">)</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/labels"><span style="color: #003399;">labels</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">"high"</span><span style="color: #339933;">,</span> <span style="color: blue;">"mean"</span><span style="color: #339933;">,</span> <span style="color: blue;">"low"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> + scale_y_continuous<span style="color: #009900;">(</span>trans=<span style="color: blue;">'log'</span><span style="color: #009900;">)</span></span></pre><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-4siZ85hNdOE/TyIRNHEj11I/AAAAAAAAArA/desrrAgp62E/s1600/Rplot02.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-4siZ85hNdOE/TyIRNHEj11I/AAAAAAAAArA/desrrAgp62E/s1600/Rplot02.jpeg" /></a></div><br /><b><span style="font-size: large;">3 文字说明</span></b><br />利用geom_text函数可添加文字说明以增强图形的可读性<br /><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;">p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/datasets/mtcars"><span style="color: #003399;">mtcars</span></a><span style="color: #339933;">,</span> aes<span style="color: #009900;">(</span>x=wt<span style="color: #339933;">,</span> y=mpg<span style="color: #339933;">,</span>colour=<a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399;">factor</span></a><span style="color: #009900;">(</span>cyl<span style="color: #009900;">)</span><span style="color: #339933;">,</span>label=<a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399;">rownames</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/datasets/mtcars"><span style="color: #003399;">mtcars</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <br />p + geom_text<span style="color: #009900;">(</span>hjust=<span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span>vjust=-<span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span>alpha=<span style="color: #cc66cc;">0.8</span><span style="color: #009900;">)</span>+ geom_point<span style="color: #009900;">(</span>size=<span style="color: #cc66cc;">3</span><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/shape">shape</a>=<a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399;">factor</span></a><span style="color: #009900;">(</span>cyl<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span></span></pre><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-5oxn8d-RLPc/TyIRRTMFyuI/AAAAAAAAArI/YeI8b_zu6Qg/s1600/Rplot03.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-5oxn8d-RLPc/TyIRRTMFyuI/AAAAAAAAArI/YeI8b_zu6Qg/s1600/Rplot03.jpeg" /></a></div><br /><b><span style="font-size: large;">4 矩阵散点图</span></b><br />ggplot2包中也提供了矩阵散点图函数<br /><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;">plotmatrix<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/datasets/USArrests"><span style="color: #003399;">USArrests</span></a><span style="color: #009900;">)</span>+geom_smooth<span style="color: #009900;">(</span><span style="color: #009900;">)</span></span></pre><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-ECAUGyMfmBM/TyIRZMfg50I/AAAAAAAAArQ/51Rid-9sRBY/s1600/Rplot04.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-ECAUGyMfmBM/TyIRZMfg50I/AAAAAAAAArQ/51Rid-9sRBY/s1600/Rplot04.jpeg" /></a></div><br />
