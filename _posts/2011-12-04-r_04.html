--- 
layout: post
name: r_04
title: "\xE5\x9C\xA8R\xE8\xAF\xAD\xE8\xA8\x80\xE4\xB8\xAD\xE7\x94\xA8\xE8\x87\xAA\xE5\x8A\xA9\xE6\xB3\x95\xE6\xB1\x82\xE7\xBB\x9F\xE8\xAE\xA1\xE9\x87\x8F\xE7\xBD\xAE\xE4\xBF\xA1\xE5\x8C\xBA\xE9\x97\xB4"
date: 2011-12-04 13:05:00 +08:00
categories: 
- "\xE8\x87\xAA\xE5\x8A\xA9\xE6\xB3\x95"
permalink: /2011/12/r_04.html
---
当样本不符合理论分布假设时，求样本统计量的置信区间就成为一个难题。而自助法(Bootstrap)的思路是对原始样本重复抽样产生多个新样本，针对每个样本求取统计量，然后得到它的经验分布，再通过求经验分布的分位数来得到统计量的置信区间，这种方法不需要对统计量有任何理论分布的假设。一般认为，只要样本具有代表性，采用自助法需要的原始样本只要20-30个,重复抽样1000次就能达到满意的结果。<br /><br />在R中进行自助法是利用boot扩展包，其流程如下：<br /><a name='more'></a><br /><ul><li>编写一个求取统计量的自定义函数</li><li>将上面的函数放入boot（）函数中进行运算，得到自助法的结果</li><li>用boot.ci()函数求取置信区间</li></ul>让我们用mtcars数据集来作为例子，我们可以将wt和disp作为自变量，mpg 作为因变量，进行回归后能得到一系列回归统计量。其中我们感兴趣的是判定系数R-square，希望用自助法求它的95%置信区间。<br /><br />首先定义求R-square的函数，注意其中的indices是必不可少的参数，另外一个参数代表样本数据<br />------------------------<br />rsq=function(data,indices){<br />&nbsp; d=data[indices,]<br />&nbsp; fit=lm(formula=mpg~wt+disp,data=d)<br />&nbsp; return(summary(fit)$r.square)<br />&nbsp; }<br />------------------------<br /><br />载入boot扩展包，将随机种子设为1234，以方便得到相同的结果，再利用boot函数得到结果results，其中R表示重复抽样得到1000个样本<br />------------------------<br />library(boot)<br />set.seed(1234)<br />results=boot(data=mtcars,statistic=rsq,R=1000)<br />print(results)<br />plot(results)<br />------------------------<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-ujWyZnpyatA/Ttr_v87CSoI/AAAAAAAAAkk/1QOd_NAi1cg/s1600/Rplot.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-ujWyZnpyatA/Ttr_v87CSoI/AAAAAAAAAkk/1QOd_NAi1cg/s1600/Rplot.jpeg" /></a></div><br />results这个数据结构中包括了原始样本的统计量(results$t0)和再抽样样本的统计量(results$t0)，上图左侧的直方图表示了再抽样样本的统计量的经验分布，其中的虚线表示了原始样本的统计量，从中可以观察到偏差。右侧QQ图有助于判断经验分布是否正态。下面我们用boot.ci函数从结果中提取置信区间。<br /><br />------------------------<br />boot.ci(results,conf=0.95,type=c('perc','bca'))<br />------------------------<br /><br />其中conf表示置信水平，type表示了用何种算法来求区间，perc即使用百分位方法，bca表示adjusted bootstrap percentile，即对偏差进行了调整。结果如下：<br /><span class="Apple-style-span" style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; border-collapse: separate; font-family: Arial;"><span class="Apple-style-span" style="font-family: 'Lucida Console'; font-size: 13px; line-height: 17px; text-align: -webkit-left; white-space: pre-wrap;"></span></span><br /><pre class="GD40030CLR" style="border-bottom-style: none; border-color: initial; border-left-style: none; border-right-style: none; border-top-style: none; border-width: initial; font-family: 'Lucida Console'; font-size: 10pt !important; line-height: 1.3; outline-color: initial; outline-style: none; outline-width: initial; white-space: pre-wrap !important;" tabindex="0">BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS<br />Based on 1000 bootstrap replicates<br /><br />CALL : <br />boot.ci(boot.out = results, conf = 0.95, type = c("perc", "bca"))<br /><br />Intervals : <br />Level     Percentile            BCa          <br />95%   ( 0.6838,  0.8833 )   ( 0.6344,  0.8549 )  </pre><br />
