--- 
layout: post
name: rjsonio
title: "\xE7\x94\xA8RJSONIO\xE5\x8C\x85\xE8\xB0\x83\xE7\x94\xA8\xE5\xA4\xA9\xE6\xB0\x94\xE6\x95\xB0\xE6\x8D\xAE"
date: 2012-05-01 18:21:00 +08:00
categories: 
- "\xE6\x95\xB0\xE6\x8D\xAE\xE5\xAF\xBC\xE5\x85\xA5"
- "\xE5\x85\xAC\xE5\xBC\x80\xE6\x95\xB0\xE6\x8D\xAE"
permalink: /2012/05/rjsonio.html
---
<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-l_rO2ZkB5uI/T5-33OKTQvI/AAAAAAAAA1g/A9CqyBxGbxc/s1600/weather.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="184" src="http://1.bp.blogspot.com/-l_rO2ZkB5uI/T5-33OKTQvI/AAAAAAAAA1g/A9CqyBxGbxc/s200/weather.jpg" width="200" /></a></div>JSON(JavaScript Object Notation)是一种轻量级的数据交换格式。易于阅读和编写，同时也易于机器解析和生成。 JSON采用完全独立于语言的文本格式，但是也使用了类似于C语言家族的习惯（包括C, C++, C#, Java, JavaScript, Perl, Python等）。这些特性使JSON成为理想的数据交换语言。目前有许多API服务提供了JSON的数据格式。<br /><br />如果我们要在R语言中处理json数据，可以采用的扩展包有rjson和rjsonio两个包。从本人感觉来看，rjsonio包要更为友好一些，读取之后可以直接转为简单的list格式，方便调用数据。rjson的话也可以转为list，但其中层次关系复杂，不大方便处理。下面我们用一个例子来看看如何用RJSONIO包调用数据。我们希望编一个函数从wunderground的API调用本地城市的天气预报。其基本步骤如下：<br /><ul><li>若用户未输入城市名，则根据本机IP地址来返回当地天气；</li><li>若用户输入了城市名，则先用google API得到城市经纬度；</li><li>再用经纬度作查询参数，来返回该城市天气。</li></ul><br /><a name='more'></a>运行函数的结果看起来就象下面这样：<br /><span class="Apple-style-span" style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; border-collapse: separate; font-family: Arial;"><span class="Apple-style-span" style="font-family: 'Lucida Console'; font-size: 13px; line-height: 17px; text-align: -webkit-left; white-space: pre-wrap;"></span></span><br /><pre class="GD40030CLR" style="border-bottom-style: none; border-color: initial; border-left-style: none; border-right-style: none; border-top-style: none; border-width: initial; font-family: 'Lucida Console'; font-size: 10pt !important; line-height: 1.3; outline-color: initial; outline-style: none; outline-width: initial; white-space: pre-wrap !important;" tabindex="0"><span class="GD40030COR ace_keyword" style="color: blue; white-space: pre;">&gt; </span><span class="GD40030CCR ace_keyword" style="color: blue;">getweather('wuhan')<br /></span>$城市<br />[1] "武漢市, Hubei"<br /><br />$当前<br />[1] "20°C 晴"<br /><br />$明天<br />[1] "27°C-18°C 可能有雨"</pre><br />Google也有提供天气预报的API，但是数据不是很丰富。<a href="http://www.wunderground.com/weather/api/d/documentation.html">wunderground</a>提供的数据则相当丰富，它的天气API也被<a href="http://xccds1977.blogspot.com/2012/04/30.html">数据源手册</a>所推荐。该API也可以采用城市名称作为输入，但有时候不大灵光，所以转而用经纬度作输入参数。使用这个API还要注意一点，其免费账户的限制是每分钟10次调用，超出会有警告邮件发出来。<br /><br />R代码如下：（RSS用户看不到代码，是因为代码存放在<a href="http://gist.github.com/">gist.github.com</a>上，然后以js形式放在博客中，你可以点<a href="https://gist.github.com/2550075">这里</a>观看。另外如果要运行这个程度，需要将yourkey换成你自己申请的key，输入的城市名两边要加引号）<br /><script src="https://gist.github.com/2550075.js">  </script>
