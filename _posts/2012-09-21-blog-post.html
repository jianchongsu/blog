--- 
layout: post
name: blog-post
title: "\xE6\x8A\x93\xE5\x8F\x96\xE7\xBD\x91\xE9\xA1\xB5\xE6\x95\xB0\xE6\x8D\xAE\xE7\x9A\x84\xE5\x87\xA0\xE7\xA7\x8D\xE5\xA5\x97\xE8\xB7\xAF"
date: 2012-09-21 08:06:00 +08:00
categories: 
- "\xE6\x95\xB0\xE6\x8D\xAE\xE9\xA2\x84\xE5\xA4\x84\xE7\x90\x86"
- "\xE6\x95\xB0\xE6\x8D\xAE\xE5\xAF\xBC\xE5\x85\xA5"
permalink: /2012/09/blog-post.html
---
<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-awC4m67P168/UFuuLKrWVVI/AAAAAAAABLA/wlhAHp4aQgc/s1600/scraper.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="253" src="http://3.bp.blogspot.com/-awC4m67P168/UFuuLKrWVVI/AAAAAAAABLA/wlhAHp4aQgc/s320/scraper.jpg" width="320" /></a></div>没有数据就没有乐趣。有的数据提供者心肠很好，会直接给出txt或是csv文档。这个时候我们可以直接在R里头用read.table()函数把数据读进来。<br /><br />有的时候我们需要的数据在网页上以一个表格呈现，例如前面文章遇到过的<a href="http://data.earthquake.cn/datashare/globeEarthquake_csn.html">地震数据</a>。此时可以用XML包中的readHTMLTable()函数读取数据，后续再配合一些字符串处理一般就OK了。<br /><br />如果你对R不大熟悉，抓取这些表格也有更方便的法子，就是利用Chrome的扩展。有两个扩展值得推荐使用：一个扩展叫作table capture，它会自动找出网页中的若干表格，你只需选择所需的那个将其拷贝到剪贴板即可，然后再用下面的命令就可以读入到R中。<br />data &lt;- read.table('clipboard',T)<br /><br />另一个扩展叫作scraper。先选择你所需要的部分内容，然后右键选择scraper similar也能抓取表格，不过它会存到一个google doc中去。在天朝这玩意儿不大方便。<br /><br />有些数据不是以表格方式出现的，例如用XML或是JSON方式储存的数据。在R中都有对应的包来处理。下面的示例即是用XML包来处理XML数据。在此之先你需要有一点关于XML和XPath的<a href="http://www.3wschool.com.cn/xml/xml_intro.htm">知识</a>，首先处理的对象是这样一个页面：http://www.w3schools.com/xml/plant_catalog.xml<br /><pre class="r geshifilter-R"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/XML">XML</a><span style="color: #009900;">)</span><br />xml.url &lt;- <span style="color: blue;">"http://www.w3schools.com/xml/plant_catalog.xml"</span><br /><span style="color: #666666; font-style: italic;"># 解析xml页面</span><br />xmlfile &lt;- xmlTreeParse<span style="color: #009900;">(</span>xml.url<span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 观察对象属性</span><br /><a href="http://inside-r.org/r-doc/base/class"><span style="color: #003399; font-weight: bold;">class</span></a><span style="color: #009900;">(</span>xmlfile<span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 获取根结点</span><br />xmltop &lt;- xmlRoot<span style="color: #009900;">(</span>xmlfile<span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 用xmlValue函数获取叶结点处的值</span><br />xmlValue<span style="color: #009900;">(</span>xmltop<span style="color: #009900;">[</span><span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span><span style="color: #009900;">[</span><span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />xmlValue<span style="color: #009900;">(</span>xmltop<span style="color: #009900;">[</span><span style="color: #009900;">[</span><span style="color: blue;">'PLANT'</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span><span style="color: #009900;">[</span><span style="color: #009900;">[</span><span style="color: blue;">'COMMON'</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># xmlSApply类似于sapply函数，取出第一个子结点中的所有叶结点值</span><br />xmlSApply<span style="color: #009900;">(</span>xmltop<span style="color: #009900;">[</span><span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span>xmlValue<span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 进一步可以取出所有子结点中的叶结点值</span><br />plantcat &lt;- xmlSApply<span style="color: #009900;">(</span>xmltop<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span> xmlSApply<span style="color: #009900;">(</span>x<span style="color: #339933;">,</span> xmlValue<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 将数据转为数据框</span><br />plantcat_df &lt;- <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/t"><span style="color: #003399; font-weight: bold;">t</span></a><span style="color: #009900;">(</span>plantcat<span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/row.names"><span style="color: #003399; font-weight: bold;">row.names</span></a>=<span style="color: black; font-weight: bold;">NULL</span><span style="color: #009900;">)</span><br />plantcat_df<span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">5</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">4</span><span style="color: #009900;">]</span></pre><pre class="r geshifilter-R">有时候会遇到更为复杂的XML页面，此时的节点内含有参数值。如果要获取这些数据则需要使用getNodeSet()函数配合xmlValue()函数。当遇到更为复杂的数据，那我们只能用readLines读进来，再用字符串函数配合正则表达式来加以处理了。</pre><pre class="r geshifilter-R"></pre><pre class="r geshifilter-R">参考资料：</pre><pre class="r geshifilter-R"><a href="http://www.omegahat.org/RSXML/Tour.pdf">http://www.omegahat.org/RSXML/Tour.pdf</a><br /><a href="http://www.stat.berkeley.edu/~statcur/Workshop2/Presentations/XML.pdf">http://www.stat.berkeley.edu/~statcur/Workshop2/Presentations/XML.pdf</a></pre><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"></pre></div></div>
