--- 
layout: post
name: r_6256
title: "R\xE8\xAF\xAD\xE8\xA8\x80\xE5\xA4\x9A\xE5\x85\x83\xE5\x88\x86\xE6\x9E\x90\xE7\xB3\xBB\xE5\x88\x97\xE4\xB9\x8B\xE4\xBA\x8C\xEF\xBC\x9A\xE6\x8E\xA2\xE7\xB4\xA2\xE6\x80\xA7\xE5\x9B\xA0\xE5\xAD\x90\xE5\x88\x86\xE6\x9E\x90"
date: 2011-12-20 16:05:00 +08:00
categories: 
- "\xE5\xA4\x9A\xE5\x85\x83\xE5\x88\x86\xE6\x9E\x90"
permalink: /2011/12/r_6256.html
---
<b>探索性因子分析（Exploratory Factor Analysis，EFA）</b>是一项用来找出多元观测变量的本质结构、并进行处理降维的技术。 因而EFA能够将具有错综复杂关系的变量综合为少数几个核心因子。EFA和PCA的区别在于：PCA中的主成分是原始变量的线性组合，而EFA中的原始变量是公共因子的线性组合，因子是影响变量的潜在变量，变量中不能被因子所解释的部分称为误差，因子和误差均不能直接观察到。进行EFA需要大量的样本，一般经验认为如何估计因子的数目为N，则需要有5N到10N的样本数目。<br /><br />虽然EFA和PCA有本质上的区别，但在分析流程上有相似之处。下面我们用ability.cov这个心理测量数据举例，其变量是对人的六种能力，例如阅读和拼写能力进行了测验，其数据是一个协方差矩阵而非原始数据。R语言中stats包中的factanal函数可以完成这项工作，但这里我们使用更为灵活的psych包。<br /><a name='more'></a><br /><br /><b><span style="font-size: large;">一、选择因子个数</span></b><br />一般选择因子个数可以根据相关系数矩阵的特征值，特征值大于0则可选择做为因子。我们仍使用平行分析法（parallel analysis）。该方法首先生成若干组与原始数据结构相同的随机矩阵，求出其特征值并进行平均，然后和真实数据的特征值进行比对，根据交叉点的位置来选择因子个数。根据下图我们可以观察到特征值与红线的关系，有两个因子都位于红线上方，显然应该选择两个因子。<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/psych">psych</a><span style="color: #009900;">)</span><br />covariances = <a href="http://inside-r.org/r-doc/datasets/ability.cov"><span style="color: #003399; font-weight: bold;">ability.cov</span></a>$cov<br />correlations = <a href="http://inside-r.org/r-doc/stats/cov2cor"><span style="color: #003399; font-weight: bold;">cov2cor</span></a><span style="color: #009900;">(</span>covariances<span style="color: #009900;">)</span><br />fa.parallel<span style="color: #009900;">(</span>correlations<span style="color: #339933;">,</span> n.obs=<span style="color: #cc66cc;">112</span><span style="color: #339933;">,</span> fa=<span style="color: blue;">"fa"</span><span style="color: #339933;">,</span> n.iter=<span style="color: #cc66cc;">100</span><span style="color: #339933;">,</span>show.legend=<span style="color: black; font-weight: bold;">FALSE</span><span style="color: #009900;">)</span></span></pre></div></div><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-TUWsSrr_Oio/TvBAdx4bhEI/AAAAAAAAAn8/QyjfCiLmvlk/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-TUWsSrr_Oio/TvBAdx4bhEI/AAAAAAAAAn8/QyjfCiLmvlk/s1600/Rplot01.jpeg" /></a></div><b><span style="font-size: large;">二、提取因子</span></b><br />psych包中是使用fa函数来提取因子，将nfactors参数设定因子数为2，rotate参数设定了最大化方差的因子旋转方法，最后的fm表示分析方法，由于极大似然方法有时不能收敛，所以此处设为迭代主轴方法。从下面的结果中可以观察到两个因子解释了60%的总方差。Reading和vocabulary这两个变量于第一项因子有关，而picture、blocks和maze变量与第二项因子有关，general变量于两个因子都有关系。<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R">fa = fa<span style="color: #009900; font-family: monospace;">(</span>correlations<span style="color: #339933; font-family: monospace;">,</span><a href="http://inside-r.org/packages/cran/nFactors" style="font-family: monospace;">nfactors</a>=<span style="color: #cc66cc; font-family: monospace;">2</span><span style="color: #339933; font-family: monospace;">,</span>rotate=<span style="color: blue; font-family: monospace;">"varimax"</span><span style="color: #339933; font-family: monospace;">,</span>fm=<span style="color: blue; font-family: monospace;">"pa"</span> <span style="color: #009900; font-family: monospace;">)</span></pre><pre class="r geshifilter-R"><span style="font-family: 'Lucida Console'; font-size: 10pt; line-height: 1.3; text-align: -webkit-left; white-space: pre-wrap;">         PA1  PA2   h2    u2</span></pre></div></div><pre class="GD40030CLR" style="border-bottom-style: none; border-color: initial; border-left-style: none; border-right-style: none; border-top-style: none; border-width: initial; font-family: 'DejaVu Sans Mono'; font-size: 11pt !important; line-height: 1.3; outline-color: initial; outline-style: none; outline-width: initial; white-space: pre-wrap !important;" tabindex="0"><span class="Apple-style-span" style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; border-collapse: separate; font-family: Arial; font-size: small; line-height: normal; white-space: normal;"><span class="Apple-style-span" style="font-family: 'Lucida Console'; font-size: 13px; line-height: 17px; text-align: -webkit-left; white-space: pre-wrap;"><pre class="GD40030CLR" style="border-bottom-style: none; border-color: initial; border-left-style: none; border-right-style: none; border-top-style: none; border-width: initial; font-family: 'Lucida Console'; font-size: 10pt !important; line-height: 1.3; outline-color: initial; outline-style: none; outline-width: initial; white-space: pre-wrap !important;" tabindex="0">general 0.49 0.57 0.57 0.432<br />picture 0.16 0.59 0.38 0.623<br />blocks  0.18 0.89 0.83 0.166<br />maze    0.13 0.43 0.20 0.798<br />reading 0.93 0.20 0.91 0.089<br />vocab   0.80 0.23 0.69 0.313<br /><br />                PA1  PA2<br />SS loadings    1.83 1.75<br />Proportion Var 0.30 0.29<br />Cumulative Var 0.30 0.60</pre></span></span></pre>如果采用基本函数factanal进行因子分析，那么函数形式应该是factanal(covmat=correlations,factors=2,rottion='varimax')，这会得到相同的结果。此外，我们还可以用图形来表示因子和变量之间的关系<br /><span style="font-family: 'Courier New', Courier, monospace;">factor.plot<span style="color: #009900;">(</span>fa<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/labels"><span style="color: #003399; font-weight: bold;">labels</span></a>=<a href="http://inside-r.org/r-doc/base/rownames"><span style="color: #003399; font-weight: bold;">rownames</span></a><span style="color: #009900;">(</span>fa$loadings<span style="color: #009900;">)</span><span style="color: #009900;">)</span></span><a href="http://4.bp.blogspot.com/-aFpfV5ugURY/TvBBg4sFQ5I/AAAAAAAAAoE/juMq_uJc6fc/s1600/Rplot02.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" src="http://4.bp.blogspot.com/-aFpfV5ugURY/TvBBg4sFQ5I/AAAAAAAAAoE/juMq_uJc6fc/s1600/Rplot02.jpeg" /></a><br /><b><span style="font-size: large;">三、因子得分</span></b><br />得到公共因子后，我们可以象主成分分析那样反过来考察每个样本的因子得分。如果输入的是原始数据，则可以在fa函数中设置score=T参数来获得因子得分。如果象上面例子那样输入的是相关矩阵，则需要根据因子得分系数来回归估计。<br />fa$weights<br /><span class="Apple-style-span" style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; border-collapse: separate; font-family: Arial;"><span class="Apple-style-span" style="font-family: 'Lucida Console'; font-size: 13px; line-height: 17px; text-align: -webkit-left; white-space: pre-wrap;"></span></span><br /><pre class="GD40030CLR" style="border-bottom-style: none; border-color: initial; border-left-style: none; border-right-style: none; border-top-style: none; border-width: initial; font-family: 'Lucida Console'; font-size: 10pt !important; line-height: 1.3; outline-color: initial; outline-style: none; outline-width: initial; white-space: pre-wrap !important;" tabindex="0">                 PA1         PA2<br />general  0.017702900  0.21504415<br />picture -0.007986044  0.09687725<br />blocks  -0.198309764  0.79392660<br />maze     0.019155930  0.03027495<br />reading  0.841777373 -0.22404221<br />vocab    0.190592536 -0.02040749</pre><br /><span style="color: #999999;">参考资料：R in Action</span><br /><div><br /></div>
