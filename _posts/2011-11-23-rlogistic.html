--- 
layout: post
name: rlogistic
title: "R\xE8\xAF\xAD\xE8\xA8\x80\xE5\x9F\xBA\xE7\xA1\x80\xE5\x85\xA5\xE9\x97\xA8\xE4\xB9\x8B\xE5\x85\xAD\xEF\xBC\x88\xE5\xAE\x8C\xEF\xBC\x89\xEF\xBC\x9ALogistic\xE5\x9B\x9E\xE5\xBD\x92"
date: 2011-11-23 22:24:00 +08:00
categories: 
- "logistic\xE5\x9B\x9E\xE5\xBD\x92"
- "\xE5\x85\xA5\xE9\x97\xA8\xE6\x95\x99\xE7\xA8\x8B"
permalink: /2011/11/rlogistic.html
---
让我们用logistic回归来结束本系列的内容吧，本文用例来自于<i>John Maindonald</i>所著的<a href="http://xccds1977.blogspot.com/p/r.html" target="_blank">《Data Analysis and Graphics Using R》</a>一书，其中所用的数据集是anesthetic，数据集来自于一组医学数据，其中变量conc表示麻醉剂的用量，move则表示手术病人是否有所移动，而我们用nomove做为因变量，因为研究的重点在于conc的增加是否会使nomove的概率增加。<br /><br />首先载入数据集并读取部分文件，为了观察两个变量之间关系，我们可以利cdplot函数来绘制条件密度图.<br /><a name='more'></a><br /><blockquote class="tr_bq">library(DAAG)<br />head(anesthetic)<br />cdplot(factor(nomove)~conc,data=anesthetic,main='条件密度图',ylab='病人移动',xlab='麻醉剂量')<a href="http://2.bp.blogspot.com/-jjpaeUOf98I/Ts0BnKla3UI/AAAAAAAAAjA/yuDtfzepd-o/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" src="http://2.bp.blogspot.com/-jjpaeUOf98I/Ts0BnKla3UI/AAAAAAAAAjA/yuDtfzepd-o/s1600/Rplot01.jpeg" /></a></blockquote><br />从图中可见，随着麻醉剂量加大，手术病人倾向于静止。下面利用logistic回归进行建模，得到intercept和conc的系数为-6.47和5.57，由此可见麻醉剂量超过1.16(6.47/5.57)时，病人静止概率超过50%。<br /><blockquote class="tr_bq">anes1=glm(nomove~conc,family=binomial(link='logit'),data=anesthetic)<br />summary(anes1)</blockquote>上面的方法是使用原始的0-1数据进行建模,即每一行数据均表示一个个体，另一种是使用汇总数据进行建模，先将原始数据按下面步骤进行汇总<br /><blockquote class="tr_bq">anestot=aggregate(anesthetic[,c('move','nomove')],by=list(conc=anesthetic$conc),FUN=sum)<br />anestot$conc=as.numeric(as.character(anestot$conc))<br />anestot$total=apply(anestot[,c('move','nomove')],1,sum)<br />anestot$prop=anestot$nomove/anestot$total</blockquote>得到汇总数据anestot如下所示<br /><blockquote class="tr_bq">&nbsp; conc move nomove total &nbsp; &nbsp; &nbsp;prop<br />1 &nbsp;0.8 &nbsp; &nbsp;6 &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; 7 0.1428571<br />2 &nbsp;1.0 &nbsp; &nbsp;4 &nbsp; &nbsp; &nbsp;1 &nbsp; &nbsp; 5 0.2000000<br />3 &nbsp;1.2 &nbsp; &nbsp;2 &nbsp; &nbsp; &nbsp;4 &nbsp; &nbsp; 6 0.6666667<br />4 &nbsp;1.4 &nbsp; &nbsp;2 &nbsp; &nbsp; &nbsp;4 &nbsp; &nbsp; 6 0.6666667<br />5 &nbsp;1.6 &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;4 &nbsp; &nbsp; 4 1.0000000<br />6 &nbsp;2.5 &nbsp; &nbsp;0 &nbsp; &nbsp; &nbsp;2 &nbsp; &nbsp; 2 1.0000000</blockquote>对于汇总数据，有两种方法可以得到同样的结果，一种是将两种结果的向量合并做为因变量，如anes2模型。另一种是将比率做为因变量，总量做为权重进行建模，如anes3模型。这两种建模结果是一样的。<br /><blockquote class="tr_bq">anes2=glm(cbind(nomove,move)~conc,family=binomial(link='logit'),data=anestot)<br />anes3=glm(prop~conc,family=binomial(link='logit'),weights=total,data=anestot)</blockquote>根据logistic模型，我们可以使用predict函数来预测结果，下面根据上述模型来绘图<br /><blockquote class="tr_bq">x=seq(from=0,to=3,length.out=30)<br />y=predict(anes1,data.frame(conc=x),type='response')<br />plot(prop~conc,pch=16,col='red',data=anestot,xlim=c(0.5,3),main='Logistic回归曲线图',ylab='病人静止概率',xlab='麻醉剂量')<br />lines(y~x,lty=2,col='blue')<a href="http://2.bp.blogspot.com/-Qyx1KsXW-Vc/Ts0B7omHbsI/AAAAAAAAAjI/oojcshGVX-E/s1600/Rplot2.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" src="http://2.bp.blogspot.com/-Qyx1KsXW-Vc/Ts0B7omHbsI/AAAAAAAAAjI/oojcshGVX-E/s1600/Rplot2.jpeg" /></a></blockquote><br /><br /><br /><br />
