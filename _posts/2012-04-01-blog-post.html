--- 
layout: post
name: blog-post
title: "\xE6\xB8\x85\xE6\x98\x8E\xE6\x97\xB6\xE8\x8A\x82\xE8\xAF\xB4\xE6\xAD\xBB\xE5\x88\x91"
date: 2012-04-01 14:25:00 +08:00
categories: 
- ggplot2
- "\xE5\x8F\xAF\xE8\xA7\x86\xE5\x8C\x96"
permalink: /2012/04/blog-post.html
---
<div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/wvA1UiuJ.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="230" src="http://thumbsnap.com/i/wvA1UiuJ.jpg" width="320" /></a></div>死刑是自人类社会发展以来就诞生的一种剥夺人生命的刑罚。死刑除了是对于不守规则的事件的惩罚外，也是对破坏规则的情况的一种极重度的威吓。这个史前就已有的制度，是对进行不容于社会的行为的严厉惩罚之一。世界上几乎每一个国家或地区都曾有过“死刑”这种刑罚制度，时至今日，仍有一些国家继续存有并继续执行死刑。然而多数国家已经废止了死刑，有些国家则是已经10年以上未执行过死刑，或是仅允许在战时使用死刑。<br /><br />在最近卫报的一则<a href="http://www.guardian.co.uk/news/datablog/2011/mar/29/death-penalty-countries-world#_">文章</a>中，根据从2007到2011年的死刑数据进行了一些可视化工作。特别是根据大赦国际最近公布的一份<a href="http://www.amnesty.org/en/death-penalty">报告</a>，给出了一份死刑执行情况的气泡地图。形象的说明了当今世界上还有哪些国家在判决与执行死刑。本文则是照猫画虎，以说明R语言中<b>googleVis包</b>和<b>ggplot2包</b>的使用方法。<br /><a name='more'></a><br /><script src="http://www.google.com/jsapi" type="text/javascript"></script><script type="text/javascript">  // jsData  function gvisDataGeoMapID7f054c8a () {   var data = new google.visualization.DataTable();   var datajson = [  [  "AF",         364, "AFGHANISTAN"  ], [  "DZ",         752, "ALGERIA"  ], [  "BS",           8, "BAHAMAS"  ], [  "BH",           8, "BAHRAIN"  ], [  "BD",         423, "BANGLADESH"  ], [  "BB",           1, "BARBADOS"  ], [  "BY",          12, "BELARUS"  ], [  "BJ",           6, "BENIN"  ], [  "BW",           7, "BOTSWANA"  ], [  "BN",           3, "BRUNEI DARUSSALAM"  ], [  "BF",           8, "BURKINA FASO"  ], [  "BI",           1, "BURUNDI"  ], [  "CM",           0, "CAMEROON"  ], [  "CF",          14, "CENTRAL AFRICAN REPUBLIC"  ], [  "TD",          13, "CHAD"  ], [  "CN",        8000, "CHINA"  ], [  "CD",          74, "CONGO (Democratic Republic)"  ], [  "EG",         704, "EGYPT"  ], [  "GQ",           4, "EQUATORIAL GUINEA"  ], [  "ET",          55, "ETHIOPIA"  ], [  "GM",          31, "GAMBIA"  ], [  "GH",          31, "GHANA"  ], [  "GT",           1, "GUATEMALA"  ], [  "GN",          19, "GUINEA"  ], [  "GY",           7, "GUYANA"  ], [  "IN",         435, "INDIA"  ], [  "ID",          35, "INDONESIA"  ], [  "IR",         156, "IRAN"  ], [  "IQ",        1420, "IRAQ"  ], [  "JM",           7, "JAMAICA"  ], [  "JP",         108, "JAPAN"  ], [  "JO",          67, "JORDAN"  ], [  "KE",          16, "KENYA"  ], [  "KP",           0, "KOREA (NORTH)"  ], [  "KR",          13, "KOREA (SOUTH)"  ], [  "KW",          31, "KUWAIT"  ], [  "LA",           6, "LAOS"  ], [  "LB",          24, "LEBANON"  ], [  "LR",          15, "LIBERIA"  ], [  "LY",           0, "LIBYA"  ], [  "MG",          14, "MADAGASCAR"  ], [  "MW",           4, "MALAWI"  ], [  "MY",         324, "MALAYSIA"  ], [  "MV",           1, "MALDIVES"  ], [  "ML",          41, "MALI"  ], [  "MR",          33, "MAURITANIA"  ], [  "MN",          45, "MONGOLIA"  ], [  "MA",          27, "MOROCCO"  ], [  "MM",          37, "MYANMAR"  ], [  "NE",           1, "NIGER"  ], [  "NG",         341, "NIGERIA"  ], [  "OM",           7, "OMAN"  ], [  "PK",        1497, "PAKISTAN"  ], [  "PS",          33, "PALESTINIAN AUTHORITY"  ], [  "PG",           8, "PAPUA NEW GUINEA"  ], [  "QA",           6, "QATAR"  ], [  "KN",           1, "SAINT KITTS & NEVIS"  ], [  "VC",           1, "SAINT VINCENT AND & THE GRENADINES"  ], [  "LC",           1, "SAINT LUCIA"  ], [  "SA",          54, "SAUDI ARABIA"  ], [  "SL",           7, "SIERRA LEONE"  ], [  "SG",          26, "SINGAPORE"  ], [  "SO",          57, "SOMALIA"  ], [  "LK",         120, "SRI LANKA"  ], [  "SD",         166, "SUDAN"  ], [  "SS",           1, "SUDAN (SOUTH)"  ], [  "SY",          34, "SYRIA"  ], [  "TW",          45, "TAIWAN"  ], [  "TZ",           5, "TANZANIA"  ], [  "TH",          56, "THAILAND"  ], [  "TT",          12, "TRINIDAD AND TOBAGO"  ], [  "TN",          27, "TUNISIA"  ], [  "UG",         134, "UGANDA"  ], [  "AE",          64, "UNITED ARAB EMIRATES"  ], [  "US",         504, "UNITED STATES"  ], [  "VN",         258, "VIETNAM"  ], [  "YE",         109, "YEMEN"  ], [  "ZM",          91, "ZAMBIA"  ], [  "ZW",          17, "ZIMBABWE"  ]  ]; data.addColumn('string','code'); data.addColumn('number','sentenced'); data.addColumn('string','country'); data.addRows(datajson); return(data); }   // jsDrawChart function drawChartGeoMapID7f054c8a() {   var data = gvisDataGeoMapID7f054c8a();   var options = {}; options["dataMode"] = "regions"; options["width"] =    600; options["height"] =    400; options["region"] = "world"; options["colors"] = [0xDCDCDC,0xEE2C2C,];       var chart = new google.visualization.GeoMap(        document.getElementById('GeoMapID7f054c8a')      );      chart.draw(data,options);       }      // jsDisplayChart  function displayChartGeoMapID7f054c8a() {   google.load("visualization", "1", { packages:["geomap"] });    google.setOnLoadCallback(drawChartGeoMapID7f054c8a); }   // jsChart  displayChartGeoMapID7f054c8a()   <!-- jsFooter -->   //--></script>      <br /><div id="GeoMapID7f054c8a" style="height: 400px; width: 600px;"></div>上图是利用卫报所提供的<a href="https://spreadsheets.google.com/ccc?key=0AonYZs4MzlZbdGJiUzRwTVhlM25DWDlPdjBmNURjOUE&amp;hl=en">数据</a>，将2007年到2011年所有判决死刑的数字按国别汇总。由于中国对该数据进行了保密，所以2009年后的数据没法得到。但仅基于前两年的数字，也有八千例左右的死刑判决，远超其它国家，所以可以从图上看到“红色的中国”。越是灰色的区域表示死刑判决越少，而白色的区域则是表示废除了死刑的国家，但俄罗斯应该是个例外，估计是缺乏数据的原因。大致来看，似乎社会经济发达的区域，死刑判决数较少。<br /><br />下图则是从1991年到2011年间，保留死刑的国家数目和废除死刑国家数目的条形图。蓝色条形表示废除死刑国家数目的多少。很容易从图中看到在未来的趋势。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/cYW083AJ.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://thumbsnap.com/i/cYW083AJ.jpg" width="640" /></a></div><br />R代码如下：<br /><div><br /></div><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;">data1 &lt;- <a href="http://inside-r.org/r-doc/utils/read.csv"><span style="color: #003399;">read.csv</span></a><span style="color: #009900;">(</span><span style="color: blue;">'d:/data.csv'</span><span style="color: #339933;">,</span>T<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399;">names</span></a><span style="color: #009900;">(</span>data1<span style="color: #009900;">)</span> &lt;- <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">'country'</span><span style="color: #339933;">,</span><span style="color: blue;">'code'</span><span style="color: #339933;">,</span><span style="color: blue;">'sentenced'</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span>googleVis<span style="color: #009900;">)</span><br />g1 &lt;- gvisGeoMap<span style="color: #009900;">(</span>data1<span style="color: #339933;">,</span> locationvar=<span style="color: blue;">'code'</span><span style="color: #339933;">,</span> numvar=<span style="color: blue;">'sentenced'</span><span style="color: #339933;">,</span><span style="color: blue;">'country'</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/options"><span style="color: #003399;">options</span></a>=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399;">list</span></a><span style="color: #009900;">(</span>region=<span style="color: blue;">'world'</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/grDevices/colors"><span style="color: #003399;">colors</span></a>=<span style="color: blue;">'[0xDCDCDC,0xEE2C2C,]'</span> <span style="color: #339933;">,</span>dataMode=<span style="color: blue;">"regions"</span><span style="color: #339933;">,</span>width=<span style="color: #cc66cc;">600</span><span style="color: #339933;">,</span> height=<span style="color: #cc66cc;">400</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> <br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399;">plot</span></a><span style="color: #009900;">(</span>g1<span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># print(g1, 'chart')</span><br />&nbsp;<br />data2 &lt;- <a href="http://inside-r.org/r-doc/utils/read.csv"><span style="color: #003399;">read.csv</span></a><span style="color: #009900;">(</span><span style="color: blue;">'d:/data2.csv'</span><span style="color: #339933;">,</span>T<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/names"><span style="color: #003399;">names</span></a><span style="color: #009900;">(</span>data2<span style="color: #009900;">)</span> &lt;- <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">'year'</span><span style="color: #339933;">,</span><span style="color: blue;">'executing'</span><span style="color: #339933;">,</span><span style="color: blue;">'abolitionist'</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/reshape"><span style="color: #003399;">reshape</span></a><span style="color: #009900;">)</span><br />data2.melt &lt;-melt<span style="color: #009900;">(</span>data2<span style="color: #339933;">,</span>measure=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">'executing'</span><span style="color: #339933;">,</span><span style="color: blue;">'abolitionist'</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br />p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>data2.melt<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x=<a href="http://inside-r.org/r-doc/base/factor"><span style="color: #003399;">factor</span></a><span style="color: #009900;">(</span>year<span style="color: #009900;">)</span><span style="color: #339933;">,</span>y=value<span style="color: #339933;">,</span>fill=variable<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p + geom_bar<span style="color: #009900;">(</span><span style="color: #009900;">)</span></span></pre></div></div><br />
