--- 
layout: post
name: twittertwitter
title: "\xE7\x94\xA8twitteR\xE5\x8C\x85\xE5\xAF\xB9\xE4\xB8\xAD\xE6\x96\x87\xE6\x8E\xA8\xE7\x89\xB9\xE7\x94\xA8\xE6\x88\xB7\xE7\x9A\x84\xE6\x8A\xBD\xE6\xA0\xB7\xE5\x88\x86\xE6\x9E\x90"
date: 2012-02-11 12:55:00 +08:00
categories: 
- twitter
permalink: /2012/02/twittertwitter.html
---
<div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-gZIAQft6clo/TzXxO3O6aHI/AAAAAAAAAtk/AAt2UfyiewA/s1600/%E4%B8%8B%E8%BD%BD.jpg" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><br /><img border="0" height="148" src="http://2.bp.blogspot.com/-gZIAQft6clo/TzXxO3O6aHI/AAAAAAAAAtk/AAt2UfyiewA/s200/%E4%B8%8B%E8%BD%BD.jpg" width="200" /></a></div>社会化媒体的信息量巨大，一向是数据分析的热门领域。Twitter作为最为火爆的微博网站吸引了大量用户，也蕴含了大量信息。Twitter的数据信息其实包括两个部分，一个是发推内容，一个是发推用户。本文希望对中文twitter用户的情况进行一些粗浅的分析，算是抛砖引玉。<br /><br />较早的时候就有人作过Twitter中文<a href="http://www.awflasher.com/blog/archives/1767">用户调查</a>，它是以问卷的形式收集了500人的数据，得出了一些有趣的结论。本例则是希望利用twitteR包获取更多中文Twitter用户样本加以分析。首先遇到的第一个问题就是如何分辨出中文用户，笔者是从<a href="http://www.r-bloggers.com/analyzing-twitter-data-in-r-%E2%80%93-part-1/?utm_source=feedburner&amp;utm_medium=feed&amp;utm_campaign=Feed%3A+RBloggers+%28R+bloggers%29">这篇博文</a>获得启发，思路就是先从一位中文推特界的大佬入手，那么其粉丝应该基本上就是中文用户了。本例中选择的对象是“连岳”（lianyue），他的粉丝数达到了八万人。可能会问为何不选有十二万粉丝的“艾未未”？因为他比较国际化一些，其粉丝有不少是外国友人。<br /><a name='more'></a><br /><br />我们首先加载twitteR包，然后获取“用户”对象，从lianyue的follower中抓取5000名粉丝。这一步要注意，如果你的位置正好在和谐社会内，那需要VPN翻墙才能抓到数据，而且得花点时间。之后将获得的数据转为数据框格式方便处理。<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/twitteR">twitteR</a><span style="color: #009900;">)</span><br />lianyue &lt;- getUser<span style="color: #009900;">(</span><span style="color: blue;">'lianyue'</span><span style="color: #009900;">)</span><br />follow.lian &lt;- lianyue$getFollowers<span style="color: #009900;">(</span>n=<span style="color: #cc66cc;">5000</span><span style="color: #009900;">)</span><br />df.lian &lt;- <a href="http://inside-r.org/r-doc/base/do.call"><span style="color: #003399;">do.call</span></a><span style="color: #009900;">(</span><span style="color: blue;">'rbind'</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/lapply"><span style="color: #003399;">lapply</span></a><span style="color: #009900;">(</span>follow.lian<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/as.data.frame"><span style="color: #003399;">as.data.frame</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /></span>在上面这个数据中有四个可用于研究的变量，分别是：</pre></div></div><ul><li>statusesCount 发推数</li><li>followersCount 粉丝数</li><li>friendsCount 朋友数</li><li>created 开户时间</li></ul>如果将上面的数据简单绘图观察就会发现存在异常点（例如个别话唠和大佬），当然你也可以对这个异常点做进一步研究。但本例只关注“乌合之众”，在去除异常点后仍有4989个样本，存入子集变量df.sub中。再将其中的开户时间转为两种方便处理的格式。<br /><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;">df.sub &lt;- <a href="http://inside-r.org/r-doc/base/subset"><span style="color: #003399;">subset</span></a><span style="color: #009900;">(</span>df.lian<span style="color: #339933;">,</span>friendsCount&lt;<span style="color: #cc66cc;">2300</span> &amp; followersCount&lt;<span style="color: #cc66cc;">3000</span> &amp; statusesCount&lt;<span style="color: #cc66cc;">10000</span><span style="color: #009900;">)</span><br />df.sub$time &lt;- <a href="http://inside-r.org/r-doc/base/as.Date"><span style="color: #003399;">as.Date</span></a><span style="color: #009900;">(</span>df.sub$created<span style="color: #009900;">)</span><br />df.sub$ntime &lt;- <a href="http://inside-r.org/r-doc/base/as.numeric"><span style="color: #003399;">as.numeric</span></a><span style="color: #009900;">(</span>df.sub$time<span style="color: #009900;">)</span></span></pre><br />对于手头的数据，我们跳过描述性统计，首先观察这些用户的开户时间是如何分布的。加载ggplot2包绘制条形图观察。可以看到在2011年下半年新开用户出现了飙升，是翻墙手段有突破？还是国家队大规模入驻？有兴趣的同学可以进一步挖掘其原因。<br /><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br />p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>df.sub<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x=<a href="http://inside-r.org/r-doc/stats/time"><span style="color: #003399;">time</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p + geom_bar<span style="color: #009900;">(</span>fill=<span style="color: blue;">'red'</span><span style="color: #339933;">,</span>colour=<span style="color: blue;">'black'</span><span style="color: #339933;">,</span>binwidth=<span style="color: #cc66cc;">30</span><span style="color: #009900;">)</span></span></pre><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-bsCXEtbpHQA/TzXyCPufupI/AAAAAAAAAts/y6lLgL_jYos/s1600/Rplot02.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-bsCXEtbpHQA/TzXyCPufupI/AAAAAAAAAts/y6lLgL_jYos/s1600/Rplot02.jpeg" /></a></div>第二个我们想绘制这些变量的散点图观察之间的关系。除了X和Y轴表示两个数值变量之外，点的大小表示了发推的数量，颜色的不同表示了开户时间，散点越大表示发推越多，颜色偏兰表示开户早，偏红表示开户晚。<br /><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;">p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=df.sub<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x=friendsCount<span style="color: #339933;">,</span>y=followersCount<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p + geom_point<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>size=statusesCount<span style="color: #339933;">,</span>colour=ntime<span style="color: #009900;">)</span><span style="color: #339933;">,</span>alpha=<span style="color: #cc66cc;">0.8</span><span style="color: #009900;">)</span></span></pre><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-qfyKK9I3HaI/TzXyQSQfwRI/AAAAAAAAAt0/p2PtYd4CdAo/s1600/Rplot03.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-qfyKK9I3HaI/TzXyQSQfwRI/AAAAAAAAAt0/p2PtYd4CdAo/s1600/Rplot03.jpeg" /></a></div>从上图中可以观察到大部分用户聚集在左下角，有较多粉丝的用户似乎多半是发推较多，或是开户较早。为了验证这一点我们使用加性模型试一下。关于加性模型可以参照笔者之前的一篇<a href="http://xccds1977.blogspot.com/2011/12/additive-modelr.html">博文</a>。<br /><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/mgcv/mgcv"><span style="color: #003399;">mgcv</span></a><span style="color: #009900;">)</span><br />model &lt;- <a href="http://inside-r.org/r-doc/mgcv/gam"><span style="color: #003399;">gam</span></a><span style="color: #009900;">(</span>followersCount~<a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399;">s</span></a><span style="color: #009900;">(</span>friendsCount<span style="color: #009900;">)</span>+<a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399;">s</span></a><span style="color: #009900;">(</span>statusesCount<span style="color: #009900;">)</span>+<a href="http://inside-r.org/r-doc/mgcv/s"><span style="color: #003399;">s</span></a><span style="color: #009900;">(</span>ntime<span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a>=df.sub<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/graphics/par"><span style="color: #003399;">par</span></a><span style="color: #009900;">(</span>mfrow=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399;">plot</span></a><span style="color: #009900;">(</span>model<span style="color: #339933;">,</span>se=T<span style="color: #009900;">)</span></span></pre><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-OJKGXhTkR-4/TzXypfPClZI/AAAAAAAAAt8/MUj-TPKfaXI/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-OJKGXhTkR-4/TzXypfPClZI/AAAAAAAAAt8/MUj-TPKfaXI/s1600/Rplot01.jpeg" /></a></div>我们来看最后的结果，第一个图显示你fo的人越多，那么被fo的可能性也越大，不过也有例外。第二个图显示你发推越多，被fo的可能性也越大，但没人喜欢话唠，话太多就会被unfo掉，关键还是要看发推质量。第三个图大致显示开户较早的被fo的较多。估计第一批用twitter的都是黄埔一期的精英吧。<br /><br />本文只抽取了数千个数据的样本来分析中文twitter用户，抽样方法不一定科学，所以其样本不一定具有代表性。有兴趣的同学对于这些样本还可以划分细类做进一步分析，或是利用聚类分析等其它方法得出更有趣的结论。如果你觉得这篇博文有所启发，请来fo我吧(<a href="https://twitter.com/#!/xccds">@xccds</a>)。
