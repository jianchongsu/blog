--- 
layout: post
name: r_27
title: "\xE7\x94\xA8R\xE6\x9D\xA5\xE8\xBF\x9B\xE8\xA1\x8C\xE5\xB8\x83\xE4\xB8\xB0\xE6\x8A\x95\xE9\x92\x88\xE5\xAE\x9E\xE9\xAA\x8C"
date: 2012-03-27 14:54:00 +08:00
categories: 
- "\xE7\xBC\x96\xE7\xA8\x8B"
- "\xE6\xA8\xA1\xE6\x8B\x9F"
permalink: /2012/03/r_27.html
---
<div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/mp4WJrTh.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="195" src="http://thumbsnap.com/i/mp4WJrTh.jpg" width="200" /></a></div>在3月14日也就圆周率日那一天，果壳网推出一篇文章<a href="http://www.guokr.com/article/12719/">《圆周率日特献：π究竟牛B在哪里？》</a>。其中就提到了布丰（Buffon）用投针实验来计算π的近似值。不过这篇文章并没有详细说明如何用软件来做这个实验，也看到网上有朋友在问具体的过程。所以本文尝试用R来实现这个实验，算是狗尾续貂以作消遣。另外，<a href="http://www.matrix67.com/blog/archives/2494">Maxtrix67</a>和<a href="http://cos.name/2009/11/a-brief-talk-on-buffon-throwing-needle-problems/">魏太云</a>都对这个问题有过精彩的论述，有兴趣的朋友可以参考一下。<br /><br />简单来讲，投针实验是指假设有两根平行的线，它们之间的距离是1。随意抛掷一根长度为0.5的针，那么投针便有机会与平行线相交。如果总的投掷次数为N，发生相交的次数为X，那么可以用N/X来估计π的值。具体的故事和公式还可以参考<a href="http://math.cersp.com/qwsx/TJYGL/200708/5256.html">这个文章</a>。<br /><br /><a name='more'></a>为了在R中实现这个实验过程，我们先绘制出一个空的图形，再加两根平行线。可以只考虑针与一条线的相交情况，我们用一个while循环来进行反复投针，其中用随机数来模拟投针的坐标和角度，并绘制在图形中。如果发现相交则增加变量cross的计数，同时用cat函数显示实验次数和估计值。下图是根据上述假设编写代码所绘制的图形。如果你自己在R语言中运行代码，可以按空格来反复投针，用y来结束实验，可以观察到当试验次数增加，估计值也随之接近真值。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/sMgWeVyI.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://thumbsnap.com/i/sMgWeVyI.jpg" /></a></div><b>R代码如下：</b><br /><a href="http://inside-r.org/r-doc/base/rm" style="color: #003399; font-family: 'Courier New', Courier, monospace;">rm</a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><a href="http://inside-r.org/r-doc/base/list" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">list</span></a><span style="font-family: 'Courier New', Courier, monospace;">=</span><a href="http://inside-r.org/r-doc/base/ls" style="font-family: 'Courier New', Courier, monospace;"><span style="color: #003399;">ls</span></a><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">(</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><span style="color: #009900; font-family: 'Courier New', Courier, monospace;">)</span><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;"># 绘制空白图形</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399;">plot</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>type=<span style="color: blue;">'n'</span><span style="color: #339933;">,</span>main=<span style="color: blue;">'布丰投针实验'</span><span style="color: #339933;">,</span>xlab=<span style="color: blue;">'X'</span><span style="color: #339933;">,</span>ylab=<span style="color: blue;">'Y'</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 增加平行线</span><br /><a href="http://inside-r.org/r-doc/graphics/abline"><span style="color: #003399;">abline</span></a><span style="color: #009900;">(</span>h=<span style="color: #cc66cc;">0.5</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/graphics/abline"><span style="color: #003399;">abline</span></a><span style="color: #009900;">(</span>h=<span style="color: #cc66cc;">1.5</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399;">col</span></a>=<span style="color: blue;">'red'</span><span style="color: #009900;">)</span><br />finished &lt;- <span style="color: black;">FALSE</span><br /><span style="color: #666666; font-style: italic;"># trial为实验次数，cross为交叉次数</span><br />trial &lt;- <span style="color: #cc66cc;">0</span><br />cross &lt;- <span style="color: #cc66cc;">0</span><br /><span style="color: black;">while</span> <span style="color: #009900;">(</span>!finished<span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    <span style="color: #666666; font-style: italic;"># Dist为针的中心距离红线的垂直距离</span><br />    <span style="color: #666666; font-style: italic;"># Theta为针的角度</span><br />    Dist &lt;- <a href="http://inside-r.org/r-doc/stats/runif"><span style="color: #003399;">runif</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/min"><span style="color: #003399;">min</span></a>=<span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/max"><span style="color: #003399;">max</span></a>=<span style="color: #cc66cc;">1</span>/<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><br />    Theta &lt;- <a href="http://inside-r.org/r-doc/stats/runif"><span style="color: #003399;">runif</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: black;">pi</span><span style="color: #009900;">)</span><br />    <span style="color: #666666; font-style: italic;"># central.x为针中心点的横坐标</span><br />    <span style="color: #666666; font-style: italic;"># central.y为针中心点的纵坐标</span><br />    central.x &lt;- <a href="http://inside-r.org/r-doc/stats/runif"><span style="color: #003399;">runif</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0.5</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1.5</span><span style="color: #009900;">)</span><br />    central.y &lt;- Dist +<span style="color: #cc66cc;">1</span><br />    <span style="color: #666666; font-style: italic;"># 计算针两端的坐标</span><br />    y1 &lt;- <a href="http://inside-r.org/r-doc/base/sin"><span style="color: #003399;">sin</span></a><span style="color: #009900;">(</span>Theta<span style="color: #009900;">)</span>/<span style="color: #cc66cc;">4</span> + central.y<br />    x1 &lt;- <a href="http://inside-r.org/r-doc/base/cos"><span style="color: #003399;">cos</span></a><span style="color: #009900;">(</span>Theta<span style="color: #009900;">)</span>/<span style="color: #cc66cc;">4</span> + central.x<br />    y2 &lt;- <a href="http://inside-r.org/r-doc/base/sin"><span style="color: #003399;">sin</span></a><span style="color: #009900;">(</span>Theta+<span style="color: black;">pi</span><span style="color: #009900;">)</span>/<span style="color: #cc66cc;">4</span> + central.y<br />    x2 &lt;- <a href="http://inside-r.org/r-doc/base/cos"><span style="color: #003399;">cos</span></a><span style="color: #009900;">(</span>Theta+<span style="color: black;">pi</span><span style="color: #009900;">)</span>/<span style="color: #cc66cc;">4</span> + central.x<br />    trial &lt;- trial +<span style="color: #cc66cc;">1</span><br />    <span style="color: #666666; font-style: italic;"># 计数交叉次数</span><br />    cross &lt;- cross + <a href="http://inside-r.org/r-doc/base/ifelse"><span style="color: #003399;">ifelse</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0.25</span>*<a href="http://inside-r.org/r-doc/base/sin"><span style="color: #003399;">sin</span></a><span style="color: #009900;">(</span>Theta<span style="color: #009900;">)</span>&gt;=Dist<span style="color: #339933;">,</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #009900;">)</span><br />    <span style="color: #666666; font-style: italic;"># 绘制针的线型和中心点</span><br />    <a href="http://inside-r.org/r-doc/graphics/lines"><span style="color: #003399;">lines</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span>x1<span style="color: #339933;">,</span>x2<span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span>y1<span style="color: #339933;">,</span>y2<span style="color: #009900;">)</span><span style="color: #339933;">,</span>lty=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><br />    <a href="http://inside-r.org/r-doc/graphics/points"><span style="color: #003399;">points</span></a><span style="color: #009900;">(</span>central.x<span style="color: #339933;">,</span>central.y<span style="color: #339933;">,</span>pch=<span style="color: #cc66cc;">16</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/col"><span style="color: #003399;">col</span></a>=<span style="color: blue;">'grey'</span><span style="color: #009900;">)</span><br />    <a href="http://inside-r.org/r-doc/base/cat"><span style="color: #003399;">cat</span></a><span style="color: #009900;">(</span><span style="color: blue;">'trial='</span><span style="color: #339933;">,</span>trial<span style="color: #339933;">,</span><span style="color: blue;">'cross='</span><span style="color: #339933;">,</span>cross<span style="color: #339933;">,</span><span style="color: blue;">'PI='</span><span style="color: #339933;">,</span>trial/cross<span style="color: #339933;">,</span><span style="color: blue;">'<span style="color: #000099;">\n</span>'</span><span style="color: #009900;">)</span><br />    <span style="color: #666666; font-style: italic;">#continue?</span><br />    input &lt;- <a href="http://inside-r.org/r-doc/base/readline"><span style="color: #003399;">readline</span></a><span style="color: #009900;">(</span><span style="color: blue;">'stop?'</span><span style="color: #009900;">)</span><br />    <span style="color: #666666; font-style: italic;"># 若输入y，则结束实验</span><br />    <span style="color: black;">if</span> <span style="color: #009900;">(</span>input ==<span style="color: blue;">'y'</span><span style="color: #009900;">)</span> finished &lt;- <span style="color: black;">TRUE</span><br /><span style="color: #009900;">}</span></span></pre></div></div>
