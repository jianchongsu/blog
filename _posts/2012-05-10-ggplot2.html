--- 
layout: post
name: ggplot2
title: "\xE7\x94\xA8ggplot2\xE5\x8C\x85\xE6\x9D\xA5\xE7\xBB\x98\xE5\x88\xB6\xE5\x9C\xB0\xE5\x9B\xBE"
date: 2012-05-10 21:35:00 +08:00
categories: 
- ggplot2
- "\xE5\x8F\xAF\xE8\xA7\x86\xE5\x8C\x96"
permalink: /2012/05/ggplot2.html
---
<div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-NgdlO-eVm5U/T6vClzGGkbI/AAAAAAAAA3s/P7hIMhm8pAU/s1600/Rplot.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><br /><img border="0" src="http://4.bp.blogspot.com/-NgdlO-eVm5U/T6vClzGGkbI/AAAAAAAAA3s/P7hIMhm8pAU/s1600/Rplot.jpeg" /></a></div>自从四月份进行重大升级之后，0.90版的ggplot2包更新了很多新功能。之前的<a href="http://xccds1977.blogspot.com/2012/03/ggplot2.html">博文</a>谈到了升级版的二维直方图。今天我们要谈的是绘制地图的新功能。其图形元素主要是通过geom_map来实现，在它的帮助文档中只描述了如何绘制美国地图，而美国地图是系统内maps包所自带的地图数据。其它图家地图数据则要从外部导入，本文则尝试从 <a href="http://gadm.org/">GADM</a>&nbsp;获取中国行政区域数据，然后用ggplot2包进行绘图。<a href="http://gadm.org/">GADM</a>是世界行政区域（或行政区域界线）位置的空间数据库，可以用于地理信息系统和类似软件。这个数据库也提供了R语言数据格式。<br /><br />本例的目的是结合地理数据和水资源数据，以说明中国人均水资源拥有量的分布情况。基本步骤是先导入地理信息数据，将其转为ggplot2可以处理的数据框格式，将水资源数据整合进来，最后绘制成图。在下图中，红色代表了人均水资源拥有量较低的地区，黄绿色代表较高的地区。多年以来，华北地区都是有名的缺水地区，而长江以南水资源相对较为丰富，这一点很容易观察出来。而西藏、青海人口数量少，使人均水资源偏高。此外，根据全国水资源公报的数字，全国平均的人均水资源量是2200立方米。我们可以根据这一数字，将低于平均数的省份单独显示出来。顺便说下，公鸡的另一只腿可不是我吃了，数据原本如此。<br /><a name='more'></a><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-TikrfH9RE5s/T6vCwb8LYkI/AAAAAAAAA30/HlksdUtJ9rA/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-TikrfH9RE5s/T6vCwb8LYkI/AAAAAAAAA30/HlksdUtJ9rA/s1600/Rplot01.jpeg" /></a></div>R代码如下：<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;"># 加载所需扩展包</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/gpclib">gpclib</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/maptools">maptools</a><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 读取地理信息数据</span><br /><a href="http://inside-r.org/r-doc/base/load"><span style="color: #003399;">load</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/url"><span style="color: #003399;">url</span></a><span style="color: #009900;">(</span><span style="color: blue;">"http://gadm.org/data/rda/CHN_adm1.RData"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 人均水资源量</span><br />water &lt;- <a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1085</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">325</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1473</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3524</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1079</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2935</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3989</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2790</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">4147</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">358</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2046</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">434</span><br /><span style="color: #339933;">,</span><span style="color: #cc66cc;">1652</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2490</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">451</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3362</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1467</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">871</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2145</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">182</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1000</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">12278</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">448</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">377</span><span style="color: #339933;">,</span><br /><span style="color: #cc66cc;">182</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">1221</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">3135</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">152</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">4976</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">10000</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">5298</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2005</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 将数据转为数据框</span><br />gpclibPermit<span style="color: #009900;">(</span><span style="color: #009900;">)</span><br />china.map &lt;- fortify<span style="color: #009900;">(</span>gadm<span style="color: #339933;">,</span>region=<span style="color: blue;">'ID_1'</span><span style="color: #009900;">)</span><br />vals &lt;- <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399;">data.frame</span></a><span style="color: #009900;">(</span>id =<a href="http://inside-r.org/r-doc/base/unique"><span style="color: #003399;">unique</span></a><span style="color: #009900;">(</span>china.map$id<span style="color: #009900;">)</span><span style="color: #339933;">,</span>val=water<span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 用ggplot命令绘图</span><br /><a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>vals<span style="color: #339933;">,</span> aes<span style="color: #009900;">(</span>map_id = id<span style="color: #009900;">)</span><span style="color: #009900;">)</span> + <br />    geom_map<span style="color: #009900;">(</span>aes<span style="color: #009900;">(</span>fill = val<span style="color: #009900;">)</span><span style="color: #339933;">,</span> map =china.map<span style="color: #009900;">)</span> +<br />    expand_limits<span style="color: #009900;">(</span>x = china.map$long<span style="color: #339933;">,</span> y = china.map$lat<span style="color: #009900;">)</span> +<br />    scale_fill_continuous<span style="color: #009900;">(</span>low = <span style="color: blue;">'red2'</span><span style="color: #339933;">,</span>high =<span style="color: blue;">'yellowgreen'</span><span style="color: #339933;">,</span><br />        guide = <span style="color: blue;">"colorbar"</span><span style="color: #009900;">)</span> + <br />    opts<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/graphics/title"><span style="color: #003399;">title</span></a>=<span style="color: blue;">'中国人均年水资源拥有量'</span><span style="color: #339933;">,</span><br />       axis.line=theme_blank<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>axis.text.x=theme_blank<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />       axis.text.y=theme_blank<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>axis.ticks=theme_blank<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />       axis.title.x=theme_blank<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><br />       axis.title.y=theme_blank<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span> +<br />    xlab<span style="color: #009900;">(</span><span style="color: blue;">""</span><span style="color: #009900;">)</span> + ylab<span style="color: #009900;">(</span><span style="color: blue;">""</span><span style="color: #009900;">)</span></span></pre></div></div><br />
