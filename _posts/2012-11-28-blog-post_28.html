--- 
layout: post
name: blog-post_28
title: "\xE5\x86\xB3\xE7\xAD\x96\xE6\xA0\x91\xE4\xB9\x8B\xE4\xB8\x89\xE5\x9B\xBD\xE4\xBA\x89\xE9\x9C\xB8"
date: 2012-11-28 18:03:00 +08:00
categories: 
- "\xE5\x86\xB3\xE7\xAD\x96\xE6\xA0\x91"
- "\xE6\x95\xB0\xE6\x8D\xAE\xE6\x8C\x96\xE6\x8E\x98"
permalink: /2012/11/blog-post_28.html
---
<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-UrBBDJW32bk/ULXfPDzvYVI/AAAAAAAABSI/IN2U7Z_6U4c/s1600/04071410331973.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="240" src="http://1.bp.blogspot.com/-UrBBDJW32bk/ULXfPDzvYVI/AAAAAAAABSI/IN2U7Z_6U4c/s320/04071410331973.jpg" width="320" /></a></div>决策树是一种简洁实用的数据挖掘方法。在R中通常可以用rpart包和party包来实现<a href="http://xccds1977.blogspot.com/2012/05/rpartparty.html">两种算法的决策树</a>。最近著名的C4.5决策树算法的升级版本<a href="http://en.wikipedia.org/wiki/C4.5_algorithm">C5.0</a>已经可以在官网下载到。对于这三种决策树算法，本文来做一个预测效果的简单对比。<br /><br />对比用的数据集是C50包中自带的churn数据，它是用来预测顾客流失的数据集，其中样本量为3333个，变量数为20个。为不平衡数据，没有缺失值存在。对比基本步骤是用10重交叉检验，将数据随机分为10份，用9份训练决策树，用1份来检验结果。循环后求出10个预测准确度的均值。然后在外面再套一个100次大循环，产生三个决策树算法各100个准确率。最后绘制为提琴图，从图中可以观察到C5.0的表现最好，而party次之，rpart的效果最差。在本例实验中最大的差距虽然不过0.02，但如果放在kaggle的数据挖掘比赛中，就相当于是一百位名次的差距了。<br /><a name='more'></a><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-gA0XgVDVxNM/ULXgqprak6I/AAAAAAAABSQ/1ImKiTRBLHI/s1600/three.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="394" src="http://2.bp.blogspot.com/-gA0XgVDVxNM/ULXgqprak6I/AAAAAAAABSQ/1ImKiTRBLHI/s640/three.png" width="640" /></a></div>生成代码如下：<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span>C50<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/rpart/rpart"><span style="color: #003399; font-weight: bold;">rpart</span></a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/party">party</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span>reshape2<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a><span style="color: #009900;">(</span>churn<span style="color: #009900;">)</span><br />rate.c &lt;- rate.r &lt;-rate.p&lt;-  <a href="http://inside-r.org/r-doc/base/rep"><span style="color: #003399; font-weight: bold;">rep</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">100</span><span style="color: #009900;">)</span><br /><span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span>j <span style="color: black; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">100</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />    num &lt;- <a href="http://inside-r.org/r-doc/base/sample"><span style="color: #003399; font-weight: bold;">sample</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">10</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/nrow"><span style="color: #003399; font-weight: bold;">nrow</span></a><span style="color: #009900;">(</span>churnTrain<span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/replace"><span style="color: #003399; font-weight: bold;">replace</span></a>=T<span style="color: #009900;">)</span><br />    res.c &lt;- res.r  &lt;-res.p&lt;- <a href="http://inside-r.org/r-doc/base/array"><span style="color: #003399; font-weight: bold;">array</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/dim"><span style="color: #003399; font-weight: bold;">dim</span></a>=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">10</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />    <span style="color: black; font-weight: bold;">for</span> <span style="color: #009900;">(</span> i <span style="color: black; font-weight: bold;">in</span> <span style="color: #cc66cc;">1</span>:<span style="color: #cc66cc;">10</span><span style="color: #009900;">)</span> <span style="color: #009900;">{</span><br />        train &lt;- churnTrain<span style="color: #009900;">[</span>num!=i<span style="color: #339933;">,</span> <span style="color: #009900;">]</span><br />        test &lt;- churnTrain<span style="color: #009900;">[</span>num==i<span style="color: #339933;">,</span> <span style="color: #009900;">]</span><br />&nbsp;<br />        model.c &lt;- C5.0<span style="color: #009900;">(</span>churn~.<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=train<span style="color: #009900;">)</span><br />        pre &lt;- <a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">(</span>model.c<span style="color: #339933;">,</span>test<span style="color: #009900;">[</span><span style="color: #339933;">,</span>-<span style="color: #cc66cc;">20</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />        res.c<span style="color: #009900;">[</span><span style="color: #339933;">,,</span>i<span style="color: #009900;">]</span> &lt;- <a href="http://inside-r.org/r-doc/base/as.matrix"><span style="color: #003399; font-weight: bold;">as.matrix</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/table"><span style="color: #003399; font-weight: bold;">table</span></a><span style="color: #009900;">(</span>pre<span style="color: #339933;">,</span>test<span style="color: #009900;">[</span> <span style="color: #339933;">,</span><span style="color: #cc66cc;">20</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />&nbsp;<br />        model.p &lt;-ctree<span style="color: #009900;">(</span>churn~.<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=train<span style="color: #009900;">)</span><br />        pre &lt;- <a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">(</span>model.p<span style="color: #339933;">,</span>test<span style="color: #009900;">[</span><span style="color: #339933;">,</span>-<span style="color: #cc66cc;">20</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />        res.p<span style="color: #009900;">[</span><span style="color: #339933;">,,</span>i<span style="color: #009900;">]</span> &lt;- <a href="http://inside-r.org/r-doc/base/as.matrix"><span style="color: #003399; font-weight: bold;">as.matrix</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/table"><span style="color: #003399; font-weight: bold;">table</span></a><span style="color: #009900;">(</span>pre<span style="color: #339933;">,</span>test<span style="color: #009900;">[</span> <span style="color: #339933;">,</span><span style="color: #cc66cc;">20</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />&nbsp;<br />        model.r &lt;- <a href="http://inside-r.org/r-doc/rpart/rpart"><span style="color: #003399; font-weight: bold;">rpart</span></a><span style="color: #009900;">(</span>churn~.<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a>=train<span style="color: #009900;">)</span><br />        pre &lt;- <a href="http://inside-r.org/r-doc/stats/predict"><span style="color: #003399; font-weight: bold;">predict</span></a><span style="color: #009900;">(</span>model.r<span style="color: #339933;">,</span>test<span style="color: #009900;">[</span><span style="color: #339933;">,</span>-<span style="color: #cc66cc;">20</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span>type=<span style="color: blue;">'class'</span><span style="color: #009900;">)</span><br />        res.r<span style="color: #009900;">[</span><span style="color: #339933;">,,</span>i<span style="color: #009900;">]</span> &lt;- <a href="http://inside-r.org/r-doc/base/as.matrix"><span style="color: #003399; font-weight: bold;">as.matrix</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/table"><span style="color: #003399; font-weight: bold;">table</span></a><span style="color: #009900;">(</span>pre<span style="color: #339933;">,</span>test<span style="color: #009900;">[</span> <span style="color: #339933;">,</span><span style="color: #cc66cc;">20</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />    <span style="color: #009900;">}</span><br />    table.c &lt;- <a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">(</span>res.c<span style="color: #339933;">,</span>MARGIN=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">)</span><br />    rate.c<span style="color: #009900;">[</span>j<span style="color: #009900;">]</span> &lt;- <a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/diag"><span style="color: #003399; font-weight: bold;">diag</span></a><span style="color: #009900;">(</span>table.c<span style="color: #009900;">)</span><span style="color: #009900;">)</span>/sum<span style="color: #009900;">(</span>table.c<span style="color: #009900;">)</span><br />&nbsp;<br />    table.p &lt;- <a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">(</span>res.p<span style="color: #339933;">,</span>MARGIN=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">)</span><br />    rate.p<span style="color: #009900;">[</span>j<span style="color: #009900;">]</span> &lt;- <a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/diag"><span style="color: #003399; font-weight: bold;">diag</span></a><span style="color: #009900;">(</span>table.p<span style="color: #009900;">)</span><span style="color: #009900;">)</span>/sum<span style="color: #009900;">(</span>table.p<span style="color: #009900;">)</span><br />&nbsp;<br />    table.r &lt;- <a href="http://inside-r.org/r-doc/base/apply"><span style="color: #003399; font-weight: bold;">apply</span></a><span style="color: #009900;">(</span>res.r<span style="color: #339933;">,</span>MARGIN=<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">)</span><br />    rate.r<span style="color: #009900;">[</span>j<span style="color: #009900;">]</span> &lt;- <a href="http://inside-r.org/r-doc/base/sum"><span style="color: #003399; font-weight: bold;">sum</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/diag"><span style="color: #003399; font-weight: bold;">diag</span></a><span style="color: #009900;">(</span>table.r<span style="color: #009900;">)</span><span style="color: #009900;">)</span>/sum<span style="color: #009900;">(</span>table.r<span style="color: #009900;">)</span><br /><span style="color: #009900;">}</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a> &lt;- <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>c50=rate.c<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/rpart/rpart"><span style="color: #003399; font-weight: bold;">rpart</span></a>=rate.r<span style="color: #339933;">,</span><a href="http://inside-r.org/packages/cran/party">party</a>=rate.p<span style="color: #009900;">)</span><br />data.melt &lt;- melt<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399; font-weight: bold;">data</span></a><span style="color: #009900;">)</span><br />&nbsp;<br />p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span>data.melt<span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>variable<span style="color: #339933;">,</span>value<span style="color: #339933;">,</span>color=variable<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p + geom_point<span style="color: #009900;">(</span>position=<span style="color: blue;">'jitter'</span><span style="color: #009900;">)</span>+<br />    geom_violin<span style="color: #009900;">(</span>alpha=<span style="color: #cc66cc;">0.4</span><span style="color: #009900;">)</span></pre></div></div><br />C5.0算法相对于C4.5有如下几点改进：<br /><ul><li>速度显著加快</li><li>内存使用减少</li><li>生成树模型更为简洁</li><li>支持boosting方法</li><li>支持加权和成本矩阵</li><li>支持变量筛选</li></ul>此外C50包中也有丰富的设置参数：包括设置boost次数、全局剪枝和模糊阀值设置。有兴趣的朋友不妨一试。<br /><br />
