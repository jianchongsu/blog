--- 
layout: post
name: test
title: "\xE5\x9C\xA8R\xE8\xAF\xAD\xE8\xA8\x80\xE4\xB8\xAD\xE5\xAE\x9E\xE7\x8E\xB0google-motion-charts"
date: 2011-07-19 09:49:00 +08:00
categories: 
- "\xE5\x8F\xAF\xE8\xA7\x86\xE5\x8C\x96"
- "\xE5\x85\xAC\xE5\xBC\x80\xE6\x95\xB0\xE6\x8D\xAE"
- google
permalink: /2011/07/test.html
---
本例希望比较20国集团过去若干年的发展轨迹，用谷歌提供的动态视图API在R中进行绘图。我们从世界银行数据库中选取三个变量，分别反映GDP，CO2排放和期望寿命在2001到2007年之间变化。<br /><br /><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">首先安装必要的程序包，然后用WDI命令从世界银行数据库中加载数据。</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;"></div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">install.packages("googleVis")</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">library(googleVis)</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">library(WDI)</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">DF &lt;- WDI(country=c("CN","RU","BR","ZA","IN",'DE','AU','CA','FR','IT','JP','MX','GB','US','ID','AR','KR','SA','TR'), indicator=c("NY.GDP.MKTP.CD", 'SP.DYN.LE00.IN', 'EN.ATM.CO2E.KT'), start=2000, end=2010</div><div style="margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px;">M &lt;- gvisMotionChart(DF, idvar="country", timevar="year")<br /><a name='more'></a></div>数据存入变量DF后利用gvisMotionChart函数得到动态图变量，对于该变量我们可以直接用绘图命令plot(M)得到图形。也可以将代码存到文档上，代码可复制到博客中实现动态交互效果<br /><br />cat(M$html$chart, file="tmp.html") <script src="http://www.google.com/jsapi" type="text/javascript"></script><br /><script type="text/javascript">  // jsData  function gvisDataMotionChartID491c440d () {   var data = new google.visualization.DataTable();   var datajson = [  [  "Argentina",   2000, "AR", 2.842e+11, 73.755, 1.4096e+05  ], [  "Argentina",   2001, "AR", 2.687e+11, 73.965, 1.4036e+05  ], [  "Argentina",   2002, "AR", 1.0204e+11, 74.171, 1.313e+05  ], [  "Argentina",   2003, "AR", 1.296e+11, 74.374, 1.4309e+05  ], [  "Argentina",   2004, "AR", 1.5313e+11, 74.573, 1.5532e+05  ], [  "Argentina",   2005, "AR", 1.8319e+11, 74.768, 1.5831e+05  ], [  "Argentina",   2006, "AR", 2.1407e+11, 74.959, 1.7146e+05  ], [  "Argentina",   2007, "AR", 2.6079e+11, 75.148, 1.8358e+05  ], [  "Argentina",   2008, "AR", 3.2658e+11, 75.334, null  ], [  "Argentina",   2009, "AR", 3.0716e+11, 75.518, null  ], [  "Argentina",   2010, "AR", null, null, null  ], [  "Australia",   2000, "AU", 4.1692e+11, 79.234, 3.2881e+05  ], [  "Australia",   2001, "AU", 3.8043e+11, 79.634, 3.2216e+05  ], [  "Australia",   2002, "AU", 3.9724e+11, 79.937, 3.359e+05  ], [  "Australia",   2003, "AU", 4.6847e+11, 80.239, 3.395e+05  ], [  "Australia",   2004, "AU", 6.1528e+11,  80.49, 3.4033e+05  ], [  "Australia",   2005, "AU", 6.9603e+11, 80.841, 3.6397e+05  ], [  "Australia",   2006, "AU", 7.4932e+11, 81.041, 3.7147e+05  ], [  "Australia",   2007, "AU", 8.5682e+11, 81.293, 3.7374e+05  ], [  "Australia",   2008, "AU", 1.0394e+12, 81.395, null  ], [  "Australia",   2009, "AU", 9.2484e+11, 81.544, null  ], [  "Australia",   2010, "AU", null, null, null  ], [  "Brazil",   2000, "BR", 6.447e+11, 70.186, 3.2986e+05  ], [  "Brazil",   2001, "BR", 5.5358e+11, 70.504, 3.3962e+05  ], [  "Brazil",   2002, "BR", 5.0422e+11, 70.806, 3.3491e+05  ], [  "Brazil",   2003, "BR", 5.5247e+11, 71.096, 3.2449e+05  ], [  "Brazil",   2004, "BR", 6.6376e+11, 71.376, 3.4089e+05  ], [  "Brazil",   2005, "BR", 8.8219e+11, 71.645, 3.4968e+05  ], [  "Brazil",   2006, "BR", 1.0889e+12, 71.906, 3.5225e+05  ], [  "Brazil",   2007, "BR", 1.366e+12, 72.158, 3.6802e+05  ], [  "Brazil",   2008, "BR", 1.6526e+12, 72.402, null  ], [  "Brazil",   2009, "BR", 1.5945e+12, 72.641, null  ], [  "Brazil",   2010, "BR", null, null, null  ], [  "Canada",   2000, "CA", 7.2492e+11, 79.237, 5.3696e+05  ], [  "Canada",   2001, "CA", 7.1542e+11, 79.488, 5.267e+05  ], [  "Canada",   2002, "CA", 7.3466e+11,  79.59, 5.2141e+05  ], [  "Canada",   2003, "CA", 8.6587e+11, 79.839, 5.5421e+05  ], [  "Canada",   2004, "CA", 9.9223e+11, 80.141, 5.5347e+05  ], [  "Canada",   2005, "CA", 1.1338e+12, 80.293, 5.5938e+05  ], [  "Canada",   2006, "CA", 1.2786e+12, 80.644, 5.4679e+05  ], [  "Canada",   2007, "CA", 1.4241e+12, 80.804, 5.5688e+05  ], [  "Canada",   2008, "CA", 1.4991e+12, 80.965, null  ], [  "Canada",   2009, "CA", 1.3361e+12, 81.221, null  ], [  "Canada",   2010, "CA", null, null, null  ], [  "China",   2000, "CN", 1.1985e+12, 71.304, 3.4023e+06  ], [  "China",   2001, "CN", 1.3248e+12, 71.612, 3.4845e+06  ], [  "China",   2002, "CN", 1.4538e+12, 71.893, 3.691e+06  ], [  "China",   2003, "CN", 1.641e+12, 72.147, 4.3432e+06  ], [  "China",   2004, "CN", 1.9316e+12, 72.374, 5.0906e+06  ], [  "China",   2005, "CN", 2.2569e+12, 72.577, 5.6095e+06  ], [  "China",   2006, "CN", 2.713e+12, 72.764, 6.1083e+06  ], [  "China",   2007, "CN", 3.4941e+12, 72.943, 6.533e+06  ], [  "China",   2008, "CN", 4.5218e+12, 73.125, null  ], [  "China",   2009, "CN", 4.9855e+12, 73.311, null  ], [  "China",   2010, "CN", null, null, null  ], [  "Germany",   2000, "DE", 1.9002e+12, 77.927, 8.3142e+05  ], [  "Germany",   2001, "DE", 1.891e+12, 78.329, 8.5506e+05  ], [  "Germany",   2002, "DE", 2.0169e+12, 78.229, 8.3023e+05  ], [  "Germany",   2003, "DE", 2.4422e+12,  78.38, 8.3497e+05  ], [  "Germany",   2004, "DE", 2.7452e+12,  78.68, 8.2784e+05  ], [  "Germany",   2005, "DE", 2.7884e+12, 78.932, 8.0893e+05  ], [  "Germany",   2006, "DE", 2.9186e+12, 79.132, 8.1122e+05  ], [  "Germany",   2007, "DE", 3.3291e+12, 79.534, 7.8729e+05  ], [  "Germany",   2008, "DE", 3.6345e+12, 79.737, null  ], [  "Germany",   2009, "DE", 3.33e+12, 79.937, null  ], [  "Germany",   2010, "DE", null, null, null  ], [  "France",   2000, "FR", 1.328e+12, 78.959, 3.6526e+05  ], [  "France",   2001, "FR", 1.3398e+12, 79.059, 3.8549e+05  ], [  "France",   2002, "FR", 1.4573e+12, 79.261, 3.8014e+05  ], [  "France",   2003, "FR", 1.8e+12, 79.263, 3.873e+05  ], [  "France",   2004, "FR", 2.0614e+12, 80.163, 3.8985e+05  ], [  "France",   2005, "FR", 2.1465e+12, 80.115, 3.9191e+05  ], [  "France",   2006, "FR", 2.2661e+12, 80.515, 3.8058e+05  ], [  "France",   2007, "FR", 2.594e+12, 80.815, 3.7145e+05  ], [  "France",   2008, "FR", 2.8542e+12, 80.868, null  ], [  "France",   2009, "FR", 2.6494e+12, 81.068, null  ], [  "France",   2010, "FR", null, null, null  ], [  "UnitedKingdom",   2000, "GB", 1.4776e+12, 77.741, 5.4398e+05  ], [  "UnitedKingdom",   2001, "GB", 1.4709e+12, 77.993, 5.519e+05  ], [  "UnitedKingdom",   2002, "GB", 1.6121e+12, 78.144, 5.3154e+05  ], [  "UnitedKingdom",   2003, "GB", 1.8608e+12, 78.446, 5.4234e+05  ], [  "UnitedKingdom",   2004, "GB", 2.2025e+12, 78.746, 5.4489e+05  ], [  "UnitedKingdom",   2005, "GB", 2.2801e+12, 79.049, 5.4327e+05  ], [  "UnitedKingdom",   2006, "GB", 2.4394e+12, 79.249, 5.5357e+05  ], [  "UnitedKingdom",   2007, "GB", 2.799e+12, 79.449, 5.3918e+05  ], [  "UnitedKingdom",   2008, "GB", 2.6627e+12,   79.6, null  ], [  "UnitedKingdom",   2009, "GB", 2.1745e+12, 80.051, null  ], [  "UnitedKingdom",   2010, "GB", null, null, null  ], [  "Indonesia",   2000, "ID", 1.6502e+11, 67.371, 2.5791e+05  ], [  "Indonesia",   2001, "ID", 1.6045e+11, 67.872, 2.8883e+05  ], [  "Indonesia",   2002, "ID", 1.9566e+11, 68.347, 3.0326e+05  ], [  "Indonesia",   2003, "ID", 2.3477e+11, 68.802, 3.0582e+05  ], [  "Indonesia",   2004, "ID", 2.5684e+11, 69.239, 3.335e+05  ], [  "Indonesia",   2005, "ID", 2.8587e+11, 69.658, 3.4081e+05  ], [  "Indonesia",   2006, "ID", 3.6457e+11, 70.057, 3.4255e+05  ], [  "Indonesia",   2007, "ID", 4.3211e+11, 70.435, 3.9682e+05  ], [  "Indonesia",   2008, "ID", 5.105e+11, 70.793, null  ], [  "Indonesia",   2009, "ID", 5.4027e+11, 71.182, null  ], [  "Indonesia",   2010, "ID", null, null, null  ], [  "India",   2000, "IN", 4.6018e+11, 61.285, 1.1857e+06  ], [  "India",   2001, "IN", 4.7785e+11, 61.592, 1.2029e+06  ], [  "India",   2002, "IN", 5.0719e+11, 61.893, 1.2258e+06  ], [  "India",   2003, "IN", 5.9946e+11, 62.188, 1.2809e+06  ], [  "India",   2004, "IN", 7.2157e+11, 62.482, 1.3455e+06  ], [  "India",   2005, "IN", 8.3404e+11, 62.777, 1.41e+06  ], [  "India",   2006, "IN", 9.5134e+11,  63.08, 1.5031e+06  ], [  "India",   2007, "IN", 1.2424e+12, 63.394, 1.611e+06  ], [  "India",   2008, "IN", 1.216e+12, 63.718, null  ], [  "India",   2009, "IN", 1.3773e+12, 64.052, null  ], [  "India",   2010, "IN", null, null, null  ], [  "Italy",   2000, "IT", 1.0973e+12, 79.427, 4.4702e+05  ], [  "Italy",   2001, "IT", 1.1174e+12, 79.829, 4.4736e+05  ], [  "Italy",   2002, "IT", 1.2189e+12, 79.978, 4.4969e+05  ], [  "Italy",   2003, "IT", 1.5072e+12, 79.932, 4.6517e+05  ], [  "Italy",   2004, "IT", 1.7278e+12, 80.729, 4.6706e+05  ], [  "Italy",   2005, "IT", 1.7777e+12,  80.58, 4.6791e+05  ], [  "Italy",   2006, "IT", 1.8634e+12, 81.132, 4.6484e+05  ], [  "Italy",   2007, "IT", 2.1162e+12, 81.285, 4.5605e+05  ], [  "Italy",   2008, "IT", 2.2966e+12, 81.234, null  ], [  "Italy",   2009, "IT", 2.1128e+12, 81.437, null  ], [  "Italy",   2010, "IT", null, null, null  ], [  "Japan",   2000, "JP", 4.6674e+12, 81.076, 1.2288e+06  ], [  "Japan",   2001, "JP", 4.0955e+12, 81.417, 1.2214e+06  ], [  "Japan",   2002, "JP", 3.9183e+12, 81.563, 1.2367e+06  ], [  "Japan",   2003, "JP", 4.2291e+12,  81.76, 1.2582e+06  ], [  "Japan",   2004, "JP", 4.6059e+12,  82.03, 1.2635e+06  ], [  "Japan",   2005, "JP", 4.5522e+12, 81.925, 1.2414e+06  ], [  "Japan",   2006, "JP", 4.3626e+12, 82.322, 1.235e+06  ], [  "Japan",   2007, "JP", 4.3779e+12, 82.507, 1.2535e+06  ], [  "Japan",   2008, "JP", 4.887e+12, 82.588, null  ], [  "Japan",   2009, "JP", 5.069e+12, 82.931, null  ], [  "Japan",   2010, "JP", null, null, null  ], [  "Korea,Rep.",   2000, "KR", 5.3338e+11, 75.855, 4.4168e+05  ], [  "Korea,Rep.",   2001, "KR", 5.0459e+11, 76.338, 4.4882e+05  ], [  "Korea,Rep.",   2002, "KR", 5.7593e+11, 76.824, 4.7416e+05  ], [  "Korea,Rep.",   2003, "KR", 6.4376e+11,  77.26, 4.7443e+05  ], [  "Korea,Rep.",   2004, "KR", 7.2198e+11, 77.847, 4.9018e+05  ], [  "Korea,Rep.",   2005, "KR", 8.4486e+11, 78.433, 4.6268e+05  ], [  "Korea,Rep.",   2006, "KR", 9.5177e+11, 78.969, 4.7023e+05  ], [  "Korea,Rep.",   2007, "KR", 1.0492e+12,  79.32, 5.0291e+05  ], [  "Korea,Rep.",   2008, "KR", 9.314e+11, 79.833, null  ], [  "Korea,Rep.",   2009, "KR", 8.3251e+11, 80.276, null  ], [  "Korea,Rep.",   2010, "KR", null, null, null  ], [  "Mexico",   2000, "MX", 5.8143e+11, 73.961, 3.8977e+05  ], [  "Mexico",   2001, "MX", 6.2209e+11, 74.193, 4.0423e+05  ], [  "Mexico",   2002, "MX", 6.4908e+11, 74.329, 3.9903e+05  ], [  "Mexico",   2003, "MX", 7.0032e+11, 74.411, 4.1485e+05  ], [  "Mexico",   2004, "MX", 7.5978e+11, 74.434, 4.1737e+05  ], [  "Mexico",   2005, "MX", 8.4895e+11, 74.447, 4.4056e+05  ], [  "Mexico",   2006, "MX", 9.526e+11, 74.471, 4.4737e+05  ], [  "Mexico",   2007, "MX", 1.0256e+12, 74.906, 4.7107e+05  ], [  "Mexico",   2008, "MX", 1.0899e+12, 75.065, null  ], [  "Mexico",   2009, "MX", 8.7481e+11, 75.295, null  ], [  "Mexico",   2010, "MX", null, null, null  ], [  "RussianFederation",   2000, "RU", 2.5971e+11, 65.341, 1.4425e+06  ], [  "RussianFederation",   2001, "RU", 3.066e+11, 65.488, 1.4414e+06  ], [  "RussianFederation",   2002, "RU", 3.4511e+11, 65.085, 1.4319e+06  ], [  "RussianFederation",   2003, "RU", 4.3035e+11, 65.008, 1.4807e+06  ], [  "RussianFederation",   2004, "RU", 5.9102e+11, 65.421, 1.4988e+06  ], [  "RussianFederation",   2005, "RU", 7.64e+11,  65.47, 1.5143e+06  ], [  "RussianFederation",   2006, "RU", 9.8993e+11, 66.643, 1.5634e+06  ], [  "RussianFederation",   2007, "RU", 1.2997e+12, 67.498, 1.5361e+06  ], [  "RussianFederation",   2008, "RU", 1.667e+12, 67.849, null  ], [  "RussianFederation",   2009, "RU", 1.2319e+12, 68.858, null  ], [  "RussianFederation",   2010, "RU", null, null, null  ], [  "SaudiArabia",   2000, "SA", 1.8844e+11, 71.337, 2.9751e+05  ], [  "SaudiArabia",   2001, "SA", 1.8301e+11, 71.551, 2.956e+05  ], [  "SaudiArabia",   2002, "SA", 1.8855e+11, 71.764, 3.2319e+05  ], [  "SaudiArabia",   2003, "SA", 2.1457e+11, 71.978, 3.2343e+05  ], [  "SaudiArabia",   2004, "SA", 2.5034e+11,   72.2, 3.4576e+05  ], [  "SaudiArabia",   2005, "SA", 3.1558e+11, 72.427, 3.6677e+05  ], [  "SaudiArabia",   2006, "SA", 3.5663e+11, 72.659, 3.8407e+05  ], [  "SaudiArabia",   2007, "SA", 3.8489e+11, 72.891, 4.0212e+05  ], [  "SaudiArabia",   2008, "SA", 4.763e+11, 73.119, null  ], [  "SaudiArabia",   2009, "SA", 3.7577e+11, 73.427, null  ], [  "SaudiArabia",   2010, "SA", null, null, null  ], [  "Turkey",   2000, "TR", 2.6657e+11, 69.973, 2.1597e+05  ], [  "Turkey",   2001, "TR", 1.9601e+11, 70.345, 1.9438e+05  ], [  "Turkey",   2002, "TR", 2.3253e+11, 70.671, 2.0551e+05  ], [  "Turkey",   2003, "TR", 3.0301e+11,  70.95, 2.1833e+05  ], [  "Turkey",   2004, "TR", 3.9217e+11, 71.189, 2.2522e+05  ], [  "Turkey",   2005, "TR", 4.8298e+11, 71.392, 2.3717e+05  ], [  "Turkey",   2006, "TR", 5.309e+11,  71.57, 2.6136e+05  ], [  "Turkey",   2007, "TR", 6.4716e+11, 71.734, 2.8844e+05  ], [  "Turkey",   2008, "TR", 7.3034e+11, 71.892, null  ], [  "Turkey",   2009, "TR", 6.146e+11, 72.053, null  ], [  "Turkey",   2010, "TR", null, null, null  ], [  "UnitedStates",   2000, "US", 9.8988e+12, 77.034, 5.7372e+06  ], [  "UnitedStates",   2001, "US", 1.0234e+13, 77.034, 5.6243e+06  ], [  "UnitedStates",   2002, "US", 1.059e+13, 77.237, 5.6897e+06  ], [  "UnitedStates",   2003, "US", 1.1089e+13, 77.141, 5.6836e+06  ], [  "UnitedStates",   2004, "US", 1.1812e+13, 77.425, 5.7932e+06  ], [  "UnitedStates",   2005, "US", 1.258e+13, 77.737, 5.8365e+06  ], [  "UnitedStates",   2006, "US", 1.3336e+13, 77.985, 5.7531e+06  ], [  "UnitedStates",   2007, "US", 1.4062e+13, 78.176, 5.8322e+06  ], [  "UnitedStates",   2008, "US", 1.4369e+13, 78.439, null  ], [  "UnitedStates",   2009, "US", 1.4119e+13, 78.659, null  ], [  "UnitedStates",   2010, "US", null, null, null  ], [  "SouthAfrica",   2000, "ZA", 1.3288e+11, 55.786, 3.6831e+05  ], [  "SouthAfrica",   2001, "ZA", 1.1848e+11, 54.709, 3.6245e+05  ], [  "SouthAfrica",   2002, "ZA", 1.111e+11, 53.725, 3.474e+05  ], [  "SouthAfrica",   2003, "ZA", 1.6822e+11, 52.885, 3.8055e+05  ], [  "SouthAfrica",   2004, "ZA", 2.1909e+11, 52.224, 4.1387e+05  ], [  "SouthAfrica",   2005, "ZA", 2.4706e+11, 51.767, 4.0789e+05  ], [  "SouthAfrica",   2006, "ZA", 2.6101e+11, 51.517, 4.034e+05  ], [  "SouthAfrica",   2007, "ZA", 2.863e+11, 51.433, 4.3317e+05  ], [  "SouthAfrica",   2008, "ZA", 2.7645e+11, 51.477, null  ], [  "SouthAfrica",   2009, "ZA", 2.8537e+11, 51.625, null  ], [  "SouthAfrica",   2010, "ZA", null, null, null  ]  ]; data.addColumn('string','country'); data.addColumn('number','year'); data.addColumn('string','iso2c'); data.addColumn('number','NY.GDP.MKTP.CD'); data.addColumn('number','SP.DYN.LE00.IN'); data.addColumn('number','EN.ATM.CO2E.KT'); data.addRows(datajson); return(data); }   // jsDrawChart function drawChartMotionChartID491c440d() {   var data = gvisDataMotionChartID491c440d()   var chart = new google.visualization.MotionChart(    document.getElementById('MotionChartID491c440d')   );   var options ={}; options["width"] =    600; options["height"] =    500;   chart.draw(data,options); }   // jsDisplayChart  function displayChartMotionChartID491c440d() {   google.load("visualization", "1", { packages:["motionchart"] });    google.setOnLoadCallback(drawChartMotionChartID491c440d); }   // jsChart  displayChartMotionChartID491c440d()   <!-- jsFooter -->   //--></script><br /><br /><br /><div id="MotionChartID491c440d" style="height: 500px; width: 600px;"></div><br /><br /><br />特别是比较美国与中国的发展可以看出，中国几乎是横着走，为经济发展而排放了大量的CO2，而美国是向上爬，轨迹明显不同。（横轴为CO2排放，纵轴为GDP）<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-Zv8HFN-zFCo/TiT-Dlg2i8I/AAAAAAAAAVI/eVSOen7s8ps/s1600/test.JPG" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="358" src="http://4.bp.blogspot.com/-Zv8HFN-zFCo/TiT-Dlg2i8I/AAAAAAAAAVI/eVSOen7s8ps/s400/test.JPG" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"></div><div style="text-align: -webkit-auto;">参考：</div><div style="text-align: -webkit-auto;"><a href="http://code.google.com/p/google-motion-charts-with-r/wiki/GadgetExamples">http://code.google.com/p/google-motion-charts-with-r/wiki/GadgetExamples</a></div><div style="text-align: -webkit-auto;"><a href="http://code.google.com/p/google-motion-charts-with-r/">http://code.google.com/p/google-motion-charts-with-r/</a></div><div style="text-align: -webkit-auto;"><a href="http://blog.revolutionanalytics.com/2011/01/create-motion-charts-in-r-with-the-googlevis-package.html">http://blog.revolutionanalytics.com/2011/01/create-motion-charts-in-r-with-the-googlevis-package.html</a></div>
