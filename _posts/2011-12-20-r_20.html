--- 
layout: post
name: r_20
title: "R\xE8\xAF\xAD\xE8\xA8\x80\xE5\xA4\x9A\xE5\x85\x83\xE5\x88\x86\xE6\x9E\x90\xE7\xB3\xBB\xE5\x88\x97\xE4\xB9\x8B\xE4\xB8\x80\xEF\xBC\x9A\xE4\xB8\xBB\xE6\x88\x90\xE5\x88\x86\xE5\x88\x86\xE6\x9E\x90"
date: 2011-12-20 10:15:00 +08:00
categories: 
- "\xE5\xA4\x9A\xE5\x85\x83\xE5\x88\x86\xE6\x9E\x90"
permalink: /2011/12/r_20.html
---
<b>主成分分析（principal components analysis， PCA）</b>是一种分析、简化数据集的技术。它把原始数据变换到一个新的坐标系统中，使得任何数据投影的第一大方差在第一个坐标（称为第一主成分）上，第二大方差在第二个坐标（第二主成分）上，依次类推。主成分分析经常用减少数据集的维数，同时保持数据集的对方差贡献最大的特征。这是通过保留低阶主成分，忽略高阶主成分做到的。这样低阶成分往往能够保留住数据的最重要方面。但是在处理观测数目小于变量数目时无法发挥作用，例如基因数据。<br /><br />R语言中进行主成分分析可以采用基本的princomp函数，将结果输入到summary和plot函数中可分别得到分析结果和碎石图。但psych扩展包更具灵活性。<br /><a name='more'></a><br /><br /><b><span style="font-size: large;">1 选择主成分个数</span></b><br />选择主成分个数通常有如下几种评判标准：<br /><ul><li>根据经验与理论进行选择</li><li>根据累积方差贡献率&nbsp;，例如选择使累积方差贡献率达到80%的主成分个数。</li><li>根据相关系数矩阵的特征值，选择特征值大于1的主成分。</li></ul>另一种较为先进的方法是<b>平行分析</b>（parallel analysis）。该方法首先生成若干组与原始数据结构相同的随机矩阵，求出其特征值并进行平均，然后和真实数据的特征值进行比对，根据交叉点的位置来选择主成分个数。我们选择USJudgeRatings数据集举例，首先加载psych包，然后使用fa.parallel函数绘制下图，从图中可见第一主成分位于红线上方，第二主成分位于红线下方，因此主成分数目选择1。<br /><br /><span style="font-family: 'Courier New', Courier, monospace;">fa.parallel<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/datasets/USJudgeRatings"><span style="color: #003399; font-weight: bold;">USJudgeRatings</span></a><span style="color: #009900;">[</span><span style="color: #339933;">,</span>-<span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span>&nbsp;fa=<span style="color: blue;">"pc"</span><span style="color: #339933;">,</span> n.iter=<span style="color: #cc66cc;">100</span><span style="color: #339933;">,</span>&nbsp;show.legend=<span style="color: black; font-weight: bold;">FALSE</span><span style="color: #009900;">)</span></span><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-SzZ9gEp4Njg/Tu_tSOeaYJI/AAAAAAAAAns/imCiHLCenBI/s1600/Rplot.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-SzZ9gEp4Njg/Tu_tSOeaYJI/AAAAAAAAAns/imCiHLCenBI/s1600/Rplot.jpeg" /></a></div><b><span style="font-size: large;">2 提取主成分</span></b><br /><span style="font-family: 'Courier New', Courier, monospace;">pc=principal<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/datasets/USJudgeRatings"><span style="color: #003399; font-weight: bold;">USJudgeRatings</span></a><span style="color: #009900;">[</span><span style="color: #339933;">,</span>-<span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span><a href="http://inside-r.org/packages/cran/nFactors">nfactors</a>=<span style="color: #cc66cc;">1</span><span style="color: #009900;">)</span></span><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"></pre><pre class="r geshifilter-R" style="font-family: monospace;"><span class="Apple-style-span" style="-webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; border-collapse: separate; font-family: Arial; white-space: normal;"><span class="Apple-style-span" style="font-family: 'Lucida Console'; font-size: 13px; line-height: 17px; text-align: -webkit-left; white-space: pre-wrap;"><pre class="GD40030CLR" style="border-bottom-style: none; border-color: initial; border-left-style: none; border-right-style: none; border-top-style: none; border-width: initial; font-family: 'Lucida Console'; font-size: 10pt !important; line-height: 1.3; outline-color: initial; outline-style: none; outline-width: initial; white-space: pre-wrap !important;" tabindex="0">    PC1   h2     u2<br />1  0.92 0.84 0.1565<br />2  0.91 0.83 0.1663<br />3  0.97 0.94 0.0613<br />4  0.96 0.93 0.0720<br />5  0.96 0.92 0.0763<br />6  0.98 0.97 0.0299<br />7  0.98 0.95 0.0469<br />8  1.00 0.99 0.0091<br />9  0.99 0.98 0.0196<br />10 0.89 0.80 0.2013<br />11 0.99 0.97 0.0275<br /><br />                 PC1<br />SS loadings    10.13<br />Proportion Var  0.92</pre></span></span></pre></div></div>从上面的结果观察到，PC1即观测变量与主成分之间的相关系数，h2是变量能被主成分解释的比例，u2则是不能解释的比例。主成分解释了92%的总方差。注意此结果与princomp函数结果不同，princomp函数返回的是主成分的线性组合系数，而principal函数返回原始变量与主成分之间的相关系数，这样就和因子分析的结果意义相一致。<br /><br /><b><span style="font-size: large;">3 旋转主成分</span></b><br />旋转是在保持累积方差贡献率不变条件下，将主成分负荷进行变换，以方便解释。成分旋转这后各成分的方差贡献率将重新分配，此时就不可再称之为“主成分”而仅仅是“成分”。旋转又可分为正交旋转和斜交旋转。正交旋转的流行方法是方差最大化，需要在principal中增加rotate='varimax'参数加以实现。也有观点认为主成分分析一般不需要进行旋转。<br /><br /><b><span style="font-size: large;">4 计算主成分得分</span></b><br />主成分得分是各变量的线性组合，在计算出主成分得分之后，还可以将其进行回归等做进一步分析处理。但注意如果输入数据不是原始数据时，则无法计算主成分得分。我们需要在principal中增加score=T的参数设置，结果将存放在结果的score元素中。<br /><br /><div><span style="color: #999999;">参考资料：R in Action</span></div>
