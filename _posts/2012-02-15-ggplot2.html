--- 
layout: post
name: ggplot2
title: "\xE7\x94\xA8ggplot2\xE5\x8C\x85\xE7\xBB\x98\xE5\x88\xB6\xE9\xA3\x8E\xE5\x90\x91\xE9\xA3\x8E\xE9\x80\x9F\xE7\x8E\xAB\xE7\x91\xB0\xE5\x9B\xBE"
date: 2012-02-15 10:26:00 +08:00
categories: 
- ggplot2
- "\xE7\xBB\x98\xE5\x9B\xBE"
permalink: /2012/02/ggplot2.html
---
<a href="http://en.wikipedia.org/wiki/Wind_rose">风向风速玫瑰图</a>（wind rose）是气象学家常用的图形工具，描述了在一个特定的地点，其风速和风向是如何分布的。风向风速图实际上是一种条形图的扩展，它使用网格化的极坐标系统，用不同的方位来汇集风向及其频数，频率最大的方位，表示该风向出现次数最多。并且还用不同的颜色带来区别风速的大小。在本例中我们首先使用ggplot2包来绘制如下的风向风速图，再用专门工具进行示例。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-y34iwYe-XpE/TzsWy66wLFI/AAAAAAAAAuc/jS3Qf1Tnv7k/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-y34iwYe-XpE/TzsWy66wLFI/AAAAAAAAAuc/jS3Qf1Tnv7k/s1600/Rplot01.jpeg" /></a></div><a name='more'></a><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;">#首先加载ggplot2扩展包</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/set.seed"><span style="color: #003399;">set.seed</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">1234</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#随机生成100次风向，并汇集到16个区间内</span><br /><a href="http://inside-r.org/r-doc/base/dir"><span style="color: #003399;">dir</span></a> &lt;- cut_interval<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/runif"><span style="color: #003399;">runif</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">100</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">360</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>n=<span style="color: #cc66cc;">16</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#随机生成100次风速，并划分成4种强度</span><br />mag &lt;- cut_interval<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/rgamma"><span style="color: #003399;">rgamma</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">100</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">15</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">4</span><span style="color: #009900;">)</span> <br /><a href="http://inside-r.org/r-doc/base/sample"><span style="color: #003399;">sample</span></a> &lt;- <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399;">data.frame</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/dir"><span style="color: #003399;">dir</span></a>=<a href="http://inside-r.org/r-doc/base/dir"><span style="color: #003399;">dir</span></a><span style="color: #339933;">,</span>mag=mag<span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;">#将风向映射到X轴，频数映射到Y轴，风速大小映射到填充色，生成条形图后再转为极坐标形式即可</span><br />p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/sample"><span style="color: #003399;">sample</span></a><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x=<a href="http://inside-r.org/r-doc/base/dir"><span style="color: #003399;">dir</span></a><span style="color: #339933;">,</span>y=..count..<span style="color: #339933;">,</span>fill=mag<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p + geom_bar<span style="color: #009900;">(</span><span style="color: #009900;">)</span>+ coord_polar<span style="color: #009900;">(</span><span style="color: #009900;">)</span></span></pre></div></div>在R中绘制风向风速图也有两种专门的工具，一个是circular包中的windrose函数，另一个是climatol包中的rosavent函数。<br /><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/circular">circular</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/dir"><span style="color: #003399;">dir</span></a> &lt;- <a href="http://inside-r.org/packages/cran/circular">circular</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/runif"><span style="color: #003399;">runif</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">100</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">0</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">360</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/units"><span style="color: #003399;">units</span></a>=<span style="color: blue;">'degrees'</span><span style="color: #009900;">)</span><br />mag &lt;- <a href="http://inside-r.org/r-doc/stats/rgamma"><span style="color: #003399;">rgamma</span></a><span style="color: #009900;">(</span><span style="color: #cc66cc;">100</span><span style="color: #339933;">,</span><span style="color: #cc66cc;">15</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/sample"><span style="color: #003399;">sample</span></a> &lt;- <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399;">data.frame</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/dir"><span style="color: #003399;">dir</span></a>=<a href="http://inside-r.org/r-doc/base/dir"><span style="color: #003399;">dir</span></a><span style="color: #339933;">,</span>mag=mag<span style="color: #009900;">)</span><br />res &lt;- windrose<span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/sample"><span style="color: #003399;">sample</span></a><span style="color: #339933;">,</span>template=<span style="color: blue;">'geographics'</span><span style="color: #009900;">)</span></span></pre><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-oCy-mfB57sI/TzsXbCexzCI/AAAAAAAAAuk/0HPx0uUnj3Q/s1600/Rplot02.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://4.bp.blogspot.com/-oCy-mfB57sI/TzsXbCexzCI/AAAAAAAAAuk/0HPx0uUnj3Q/s400/Rplot02.jpeg" width="400" /></a></div><br /><br /><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/climatol">climatol</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">(</span>windfr<span style="color: #009900;">)</span><br />rosavent<span style="color: #009900;">(</span>windfr<span style="color: #339933;">,</span> <span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span> <span style="color: #cc66cc;">4</span><span style="color: #339933;">,</span> ang=-<span style="color: #cc66cc;">3</span>*pi/<span style="color: #cc66cc;">16</span><span style="color: #339933;">,</span> main=<span style="color: blue;">"Annual windrose"</span><span style="color: #009900;">)</span></span></pre><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-7oJruQ2snxg/TzsXk-XiDVI/AAAAAAAAAus/-hK2PhT_hqI/s1600/Rplot03.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://3.bp.blogspot.com/-7oJruQ2snxg/TzsXk-XiDVI/AAAAAAAAAus/-hK2PhT_hqI/s400/Rplot03.jpeg" width="400" /></a></div><br />
