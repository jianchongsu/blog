--- 
layout: post
name: ggplot2
title: "ggplot2\xE7\x9A\x84\xE6\x96\xB0\xE7\x89\xB9\xE6\x80\xA7\xEF\xBC\x9A\xE5\x8D\x87\xE7\xBA\xA7\xE7\x89\x88\xE7\x9A\x84\xE4\xBA\x8C\xE7\xBB\xB4\xE7\x9B\xB4\xE6\x96\xB9\xE5\x9B\xBE"
date: 2012-03-18 16:04:00 +08:00
categories: 
- ggplot2
permalink: /2012/03/ggplot2.html
---
<div class="separator" style="clear: both; text-align: center;"></div><a href="http://cran.r-project.org/web/packages/ggplot2/ggplot2.pdf">ggplot2包</a>可称得上是R语言中最为复杂和炫目的绘图包了。本博客也用了<a href="http://xccds1977.blogspot.com/search/label/ggplot2">一系列文章</a>对该包进行了介绍。在最近的3月初，其版本从0.89升级到了0.90，升级后的新版本提供了许多新的功能。其中之一是加强了对二元变量统计指标的显示能力。在之前的版本中，只能在图形中显示一元变量的统计指标(stat_summary)。对于二元变量只能显示简单的计数指标(stat_bin2d)。新版本相当于在二者基础上的升级，其主函数为stat_summary2d或者stat_summary_hex。下面我们先来熟悉下老版本中的两个函数，再介绍新函数。还有一点要注意的是，R内核需要升级到2.14以上才能使用新的ggplpot2。<br /><br />本文的例子是R中内置的钻石数据(diamonds)，其中用到的变量包括价格(price)，重量(carat)以及某种尺寸指标(depth)。先绘制carat和price之间的散点图来了解二者关系，从下图可见，由于数据量过大，尽管使用了透明度参数，散点仍非常密集。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/ukplmTpc.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="253" src="http://thumbsnap.com/i/ukplmTpc.jpg" width="400" /></a></div><a name='more'></a><br />为了简化数据，我们可以对同一重量的钻石求价格均值，从下图来就简洁了许多。当然另一种简化方法就将carat进行区间分组，然后用箱线图来表现。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/h4pkgfPd.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="253" src="http://thumbsnap.com/i/h4pkgfPd.jpg" width="400" /></a></div>如果要同时考虑carat和depth两个变量，我们可以绘制如下的二元直方图。可观察到当carat较低，同时depth在60左右时，数据样本最多。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/L9pJOeXv.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="253" src="http://thumbsnap.com/i/L9pJOeXv.jpg" width="400" /></a></div>如果要加入price变量一并考查的话，就需要使用最新的stat_summary2d函数。从下图可观察到carat越大，price越高。而且给定carat条件下，depth在60左右的价格相对较高。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/46QTE4qr.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="253" src="http://thumbsnap.com/i/46QTE4qr.jpg" width="400" /></a></div>stat_summary2d函数允许将任一个函数值映射到矩形的颜色上，比如说想观察price的变异系数在不同区块的变化情况，我们可以从下图到得直观的显示。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/l2M29rQv.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="253" src="http://thumbsnap.com/i/l2M29rQv.jpg" width="400" /></a></div>相关代码如下：<br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;"># 第一张图，简单的散点图</span><br />d &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/diamonds">diamonds</a><span style="color: #339933;">,</span> aes<span style="color: #009900;">(</span>x=carat<span style="color: #339933;">,</span> y=price<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />d + geom_point<span style="color: #009900;">(</span>alpha=<span style="color: #cc66cc;">0.3</span><span style="color: #339933;">,</span>colour=<span style="color: blue;">'lightskyblue4'</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 第二张图，展示stat_summary的功能</span><br />d + stat_summary<span style="color: #009900;">(</span>fun.y=<span style="color: blue;">'mean'</span><span style="color: #339933;">,</span>geom=<span style="color: blue;">'point'</span><span style="color: #339933;">,</span>colour=<span style="color: blue;">'lightskyblue4'</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 第三张图，展示stat_bin2d的功能</span><br />d &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/diamonds">diamonds</a><span style="color: #339933;">,</span> aes<span style="color: #009900;">(</span>x=carat<span style="color: #339933;">,</span> y=<a href="http://inside-r.org/packages/cran/depth">depth</a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />d + stat_bin2d<span style="color: #009900;">(</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 第四张图，展示stat_summary2d的功能</span><br />d &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/diamonds">diamonds</a><span style="color: #339933;">,</span> aes<span style="color: #009900;">(</span>x=carat<span style="color: #339933;">,</span> y=<a href="http://inside-r.org/packages/cran/depth">depth</a><span style="color: #339933;">,</span> z=price<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />d + stat_summary2d<span style="color: #009900;">(</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 第五张图</span><br />d + stat_summary2d<span style="color: #009900;">(</span>fun = <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/stats/sd"><span style="color: #003399;">sd</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span>/mean<span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><span style="color: #009900;">)</span></span></pre></div></div>
