--- 
layout: post
name: optim
title: "\xE5\x88\xA9\xE7\x94\xA8optim\xE6\x9C\x80\xE4\xBC\x98\xE5\x8C\x96\xE5\x87\xBD\xE6\x95\xB0\xE8\xBF\x9B\xE8\xA1\x8C\xE6\x9B\xB2\xE7\xBA\xBF\xE6\x8B\x9F\xE5\x90\x88"
date: 2011-09-11 21:45:00 +08:00
categories: 
- "\xE6\x9C\x80\xE4\xBC\x98\xE5\x8C\x96"
- "\xE6\x9B\xB2\xE7\xBA\xBF\xE6\x8B\x9F\xE5\x90\x88"
permalink: /2011/09/optim.html
---
R语言中对函数求极值有两种命令，较简单的是optimize函数，在确定搜索范围后可对一元函数求极值，例如：<br /><blockquote>f = function(x) 3*x^4 − 2*x^3 + 3*x^2 − 4*x + 5<br />optimize(f, lower=-20, upper=20)<br />$minimum<br />[1] 0.5972778<br />$objective<br />[1] 3.636756</blockquote>在对多元函数求极值时，则需利用到更强大的optim函数，本例来自于《Introduction to Scientific Programming and Simulation Using R》，其中数据可从spuRs包中获得。本例的目标是对树木体积进行建模，自变量为树龄，函数形式为指数形式，其中包括了三个待定参数。<br /><a name='more'></a><br />首先建立模型函数<br /><br /><blockquote>richards = function(t, theta){<br />theta[1]*(1 - exp(-theta[2]*t))^theta[3]}</blockquote><br />再利用最小二乘建立误差函数<br /><blockquote>&nbsp;loss = function(theta, age, vol){<br />&nbsp;sum((vol - richards(age, theta))^2)}</blockquote><br />读入数据<br /><blockquote>&nbsp;trees = read.table('clipboard',T)<br />&nbsp;tree = trees[trees$ID=="1.3.11", 2:3]</blockquote><br />确定搜寻参数起始点<br /><blockquote>&nbsp;theta0 &lt;- c(1000, 0.1, 3)</blockquote><br />求使误差最小化的参数值，optim命令中第一项为起始点，第二项为目标函数，后面的是所需数据变量，optim命令的默认方法是Nelder-Mead算法，它是求多维函数极值的一种算法，由Nelder和Mead提出，又叫单纯形算法，但和线性规划中的单纯形算法是不同的，由于未利用任何求导运算，算法比较简单，但收敛速度较慢，适合变量数不是很多的方程求极值<br /><br /><blockquote>&nbsp;theta.L &lt;- optim(theta0, loss, age=tree$Age, vol=tree$Vol)</blockquote><br />绘制拟合图形<br /><blockquote>&nbsp;plot(tree$Age, tree$Vol, xlab="Age", ylab="Volume", main='Tree 1.3.11')<br />&nbsp;lines(tree$Age, richards(tree$Age, theta.L$par), col="blue")</blockquote><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-22pVqvYyryM/Tmy7ODVyDzI/AAAAAAAAAaM/p2fo2pAbcco/s1600/Rplot01.jpeg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="362" src="http://1.bp.blogspot.com/-22pVqvYyryM/Tmy7ODVyDzI/AAAAAAAAAaM/p2fo2pAbcco/s400/Rplot01.jpeg" width="400" /></a></div><br /><br />观察拟合结果，若convergence取0则表明收敛成功，可以看到本例的最小误差为2773，而par则是三个最佳参数。<br /><br /><blockquote>theta.L2<br />$convergence<br />[1] 0<br />$par<br />[1] 3.596401e+03 1.541453e-02 2.779727e+00<br />$value<br />[1] 2773.842</blockquote>
