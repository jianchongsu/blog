--- 
layout: post
name: blog-post_07
title: "\xE4\xBB\x80\xE4\xB9\x88\xE6\xA0\xB7\xE7\x9A\x84\xE4\xBA\xBA\xE8\x83\xBD\xE9\x80\x83\xE7\xA6\xBB\xE6\xB3\xB0\xE5\x9D\xA6\xE5\xB0\xBC\xE5\x85\x8B\xE5\x8F\xB7\xEF\xBC\x9F"
date: 2012-04-07 18:02:00 +08:00
categories: 
- other
permalink: /2012/04/blog-post_07.html
---
<div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/IfOZQTDz.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://thumbsnap.com/i/IfOZQTDz.jpg" /></a></div>1912年4月15日，英国皇家邮轮泰坦尼克号（RMS Titanic）在北大西洋撞上冰山沉没，1500多名乘客遇难，成为和平时期死亡人数最多的海难之一。这个沉船故事不断地为作家、电影制作人和歌曲作者提供创作灵感。1997年末，大导演詹姆斯·卡梅隆耗资2.5亿美元打造的《泰坦尼克号》在全球各地掀起观影狂潮，影片运用最先进的数字技术在银幕上逼真还原了泰坦尼克号沉没的全过程，搭配上男女主人公杰克与露丝生死不渝的伟大爱情，令无数观众如痴如醉，狂揽18亿美元的全球票房，成为影史至尊。2012年4月，在泰坦尼克号沉船事件百年之际，全新打造的3D《泰坦尼克号》将在全球各地重映。<br /><br />当时搭乘泰坦尼克号的乘客都留下了详细的资料，本文试图利用这个资料来建立各种图表，以回答这样一个问题：<b>在当时什么样的人存活率最高？</b>涉及的数据集中包括了四个变量：是否获救Survived，所在舱Class，年龄Age，性别Sex。我们首先从网络上读取数据文件，进行简单的统计描述。<br /><br /><table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse; width: 431px;"> <colgroup><col style="mso-width-alt: 3168; mso-width-source: userset; width: 74pt;" width="99"></col> <col style="mso-width-alt: 3744; mso-width-source: userset; width: 88pt;" width="117"></col> <col style="mso-width-alt: 4576; mso-width-source: userset; width: 107pt;" width="143"></col> <col style="width: 54pt;" width="72"></col> </colgroup><tbody><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt; width: 74pt;" width="99">Class   &nbsp;</td>  <td class="xl65" style="width: 88pt;" width="117">Age &nbsp;</td>  <td class="xl65" style="width: 107pt;" width="143">Sex</td>  <td class="xl65" style="width: 54pt;" width="72">Survived</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">Crew:885 &nbsp;</td>  <td class="xl65">Adult:2092 &nbsp;</td>  <td class="xl65">Female:470 &nbsp;</td>  <td class="xl65">No:1490</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">First:325 &nbsp;</td>  <td class="xl65">Child:109 &nbsp;</td>  <td class="xl65">Male:1731 &nbsp;</td>  <td class="xl65">Yes:711</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">Second:285<br />Third:706</td><td class="xl65"><br /></td><td class="xl65"><br /></td><td class="xl65"><br /></td></tr></tbody></table><br /><a name='more'></a>从上面的结果可以看到，三等舱和船员所占人数较多，儿童人数很少，女性和男性比例大约为1:3.5，整体存活率在30%左右。下一步我们用ggplot2包绘制条形图，以观察性别和所在舱对存活的影响。从下图可以看到，就整体而言女性的存活率高于男性。这一点证实了当时“让妇女和孩子先走”的援救原则。如果将舱位因素考虑进来。一、二等舱的女性存活率都相当高，在船员中的少量女性也得以存活，但是三等舱的女性相对而言存活率较低。因此，虽然同为女性，<b>但舱位的差别仍然决定了生死的命运。</b><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/s3jKnjHL.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://thumbsnap.com/i/s3jKnjHL.jpg" /></a></div>我们还可以用马赛克图来表现各分类变量的影响。下图中不同的矩形代表了不同的群体人数，每个矩形又根据是否存活划分为黑白两个部分。从中还可以观察到一些有趣结论，例如男性船员的存活率低于三等舱的女性，但在绝对值上则占优。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/G8oU8PyV.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://thumbsnap.com/i/G8oU8PyV.jpg" width="400" /></a></div>为了精确的得到各个群体的存活率，我们将原始数据汇总得到下表。观察到存活率最高的是一、二等舱的儿童。但同时也看到三等舱的儿童存活率则低于50%。其中的原因值得我们思考。存活率居次的是女性，但三等舱的女性存活率几乎只有二等舱的一半。这同样说明了地位的差别。存活率居后的是男性群体，但一等舱的男性存活率仍相对较高，最惨的则是二等舱的男性，只有8%的存活率。<br /><div style="text-align: center;"></div><table border="0" cellpadding="0" cellspacing="0" style="border-collapse: collapse; width: 432px;"> <colgroup><col span="6" style="width: 54pt;" width="72"></col> </colgroup><tbody><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt; width: 54pt;" width="72">级别</td>  <td class="xl65" style="width: 54pt;" width="72">性别</td>  <td class="xl65" style="width: 54pt;" width="72">年龄</td>  <td class="xl65" style="width: 54pt;" width="72">人数</td>  <td class="xl65" style="width: 54pt;" width="72">获救数</td>  <td class="xl65" style="width: 54pt;" width="72">存活率</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">First</td>  <td class="xl65">Female</td>  <td class="xl65">Child</td>  <td class="xl65">1</td>  <td class="xl65">1</td>  <td class="xl66">100.00%</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">Second</td>  <td class="xl65">Female</td>  <td class="xl65">Child</td>  <td class="xl65">13</td>  <td class="xl65">13</td>  <td class="xl66">100.00%</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">First</td>  <td class="xl65">Male</td>  <td class="xl65">Child</td>  <td class="xl65">5</td>  <td class="xl65">5</td>  <td class="xl66">100.00%</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">Second</td>  <td class="xl65">Male</td>  <td class="xl65">Child</td>  <td class="xl65">11</td>  <td class="xl65">11</td>  <td class="xl66">100.00%</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">First</td>  <td class="xl65">Female</td>  <td class="xl65">Adult</td>  <td class="xl65">144</td>  <td class="xl65">140</td>  <td class="xl66">97.00%</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">Crew</td>  <td class="xl65">Female</td>  <td class="xl65">Adult</td>  <td class="xl65">23</td>  <td class="xl65">20</td>  <td class="xl66">87.00%</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">Second</td>  <td class="xl65">Female</td>  <td class="xl65">Adult</td>  <td class="xl65">93</td>  <td class="xl65">80</td>  <td class="xl66">86.00%</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">Third</td>  <td class="xl65">Female</td>  <td class="xl65">Adult</td>  <td class="xl65">165</td>  <td class="xl65">76</td>  <td class="xl66">46.00%</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">Third</td>  <td class="xl65">Female</td>  <td class="xl65">Child</td>  <td class="xl65">31</td>  <td class="xl65">14</td>  <td class="xl66">45.00%</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">First</td>  <td class="xl65">Male</td>  <td class="xl65">Adult</td>  <td class="xl65">175</td>  <td class="xl65">57</td>  <td class="xl66">33.00%</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">Third</td>  <td class="xl65">Male</td>  <td class="xl65">Child</td>  <td class="xl65">48</td>  <td class="xl65">13</td>  <td class="xl66">27.00%</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">Crew</td>  <td class="xl65">Male</td>  <td class="xl65">Adult</td>  <td class="xl65">862</td>  <td class="xl65">192</td>  <td class="xl66">22.00%</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">Third</td>  <td class="xl65">Male</td>  <td class="xl65">Adult</td>  <td class="xl65">462</td>  <td class="xl65">75</td>  <td class="xl66">16.00%</td> </tr><tr height="18" style="height: 13.5pt;">  <td class="xl65" height="18" style="height: 13.5pt;">Second</td>  <td class="xl65">Male</td>  <td class="xl65">Adult</td>  <td class="xl65">168</td>  <td class="xl65">14</td>  <td class="xl66">8.00%</td> </tr></tbody></table><br />下面我们用决策树模型来观察哪个因素对存活率最为重要。决策树将根据最重要的变量将数据进行划分，从下图看到“性别”是最重要的影响因素，如果你是女性，那么决定存活的因素为舱位，如果你是男性，那么决定存活的因素变为年龄。<br /><div class="separator" style="clear: both; text-align: center;"><a href="http://thumbsnap.com/i/YYSLebYF.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="332" src="http://thumbsnap.com/i/YYSLebYF.jpg" width="400" /></a></div><b>结论：如果你不幸穿越到了100年前的Titanic上，你应该变身为女性或小正太，同时藏身于一等舱中，这样你的存活率会大大的提升。</b>从上面的图表可以了解到，妇女和孩子的确得到了一定的优先援救，但舱位也是决定存活率的重要因素。为什么三等舱的存活率低？这是因为船舱裂口在三等舱吗？还是什么其它原因，这就留待各位挖掘了。<br /><br /><b>R代码：</b><br /><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R"><span style="font-family: 'Courier New', Courier, monospace;"><span style="color: #666666; font-style: italic;"># 获取数据</span><br /><a href="http://inside-r.org/r-doc/base/url"><span style="color: #003399;">url</span></a> &lt;- <span style="color: blue;">'http://stats.math.uni-augsburg.de/Mondrian/Data/Titanic.txt'</span><br /><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a> &lt;- <a href="http://inside-r.org/r-doc/utils/read.table"><span style="color: #003399;">read.table</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/url"><span style="color: #003399;">url</span></a><span style="color: #339933;">,</span>T<span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/summary"><span style="color: #003399;">summary</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 绘制条形图</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/ggplot2">ggplot2</a><span style="color: #009900;">)</span><br />p &lt;- <a href="http://inside-r.org/packages/cran/ggplot">ggplot</a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #339933;">,</span>aes<span style="color: #009900;">(</span>x=<a href="http://inside-r.org/packages/cran/class">Class</a><span style="color: #339933;">,</span>fill=Survived<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />p + geom_bar<span style="color: #009900;">(</span>position=<span style="color: blue;">'stack'</span><span style="color: #009900;">)</span>+ coord_flip<span style="color: #009900;">(</span><span style="color: #009900;">)</span> + facet_wrap<span style="color: #009900;">(</span>~Sex<span style="color: #009900;">)</span> <br /><span style="color: #666666; font-style: italic;"># 绘制mosaic图</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/vcd">vcd</a><span style="color: #009900;">)</span><br />mosaic<span style="color: #009900;">(</span>Survived~ <a href="http://inside-r.org/packages/cran/class">Class</a>+Sex<span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a> = <a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #339933;">,</span>shade=T<span style="color: #339933;">,</span> highlighting_direction = <span style="color: blue;">"right"</span><span style="color: #009900;">)</span><br /><span style="color: #666666; font-style: italic;"># 建立存活率表</span><br />fx &lt;- <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span> <a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399;">length</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">[</span>x==<span style="color: blue;">'Yes'</span><span style="color: #009900;">]</span><span style="color: #009900;">)</span><br />table1 &lt;- <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399;">data.frame</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/with"><span style="color: #003399;">with</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/aggregate"><span style="color: #003399;">aggregate</span></a><span style="color: #009900;">(</span>x=Survived<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/by"><span style="color: #003399;">by</span></a>=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399;">list</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/class">Class</a><span style="color: #339933;">,</span>Sex<span style="color: #339933;">,</span>Age<span style="color: #009900;">)</span><span style="color: #339933;">,</span>FUN=<a href="http://inside-r.org/r-doc/base/length"><span style="color: #003399;">length</span></a><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />table2 &lt;- <a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399;">data.frame</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/base/with"><span style="color: #003399;">with</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/stats/aggregate"><span style="color: #003399;">aggregate</span></a><span style="color: #009900;">(</span>x=Survived<span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/base/by"><span style="color: #003399;">by</span></a>=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399;">list</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/class">Class</a><span style="color: #339933;">,</span>Sex<span style="color: #339933;">,</span>Age<span style="color: #009900;">)</span><span style="color: #339933;">,</span>FUN=fx<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />table1$y &lt;- table2$x<br />table1$survived &lt;- <a href="http://inside-r.org/r-doc/base/round"><span style="color: #003399;">round</span></a><span style="color: #009900;">(</span>table1$y /table1$x<span style="color: #339933;">,</span>digits=<span style="color: #cc66cc;">2</span><span style="color: #009900;">)</span><br />table1<span style="color: #009900;">[</span><a href="http://inside-r.org/r-doc/base/order"><span style="color: #003399;">order</span></a><span style="color: #009900;">(</span>table1$survived<span style="color: #339933;">,</span>decreasing=T<span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: #009900;">]</span><br /><span style="color: #666666; font-style: italic;"># 建立决策树模型</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/rpart/rpart"><span style="color: #003399;">rpart</span></a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/stats/formula"><span style="color: #003399;">formula</span></a> &lt;- Survived~ <a href="http://inside-r.org/packages/cran/class">Class</a>+Sex+Age<br />fit &lt;- <a href="http://inside-r.org/r-doc/rpart/rpart"><span style="color: #003399;">rpart</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/stats/formula"><span style="color: #003399;">formula</span></a><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/data"><span style="color: #003399;">data</span></a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/maptree">maptree</a><span style="color: #009900;">)</span><br />draw.tree<span style="color: #009900;">(</span>fit<span style="color: #009900;">)</span></span></pre></div></div><br />参考资料：生活中的统计学--从铁达尼号沉船资料谈起
